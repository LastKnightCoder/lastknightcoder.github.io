---
authors: xiongtao
tags:
  - Github Actions
  - VuePress
date: 2021-05-31
---

éšç€æˆ‘ `VuePress` åšå®¢ä¸­çš„ä¸œè¥¿è¶Šæ¥è¶Šå¤šï¼Œæ¯æ¬¡æˆ‘æ‰“åŒ…å¥½é¡¹ç›®ç„¶åä¸Šä¼ åˆ° `Github` ä¸Šéœ€è¦å¥½ä¸€ä¼šå„¿æ—¶é—´ï¼Œä¹‹å‰åœ¨ä¸€äº›æ–‡ç« ä¸­çŸ¥é“ `Github Actions` å¯ä»¥å¸®æˆ‘è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®ï¼Œæ­£å¥½ä»Šå¤©å°è¯•å°è¯•ã€‚

åœ¨ä½¿ç”¨ `Github Actions` ä»¥å‰ï¼Œéƒ¨ç½²è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š

- å†™æ–‡ç« 
- ç”Ÿæˆé™æ€æ–‡ä»¶
- å°†é™æ€æ–‡ä»¶éƒ¨ç½²åˆ° `Github Page` ä¸Š

 ä½¿ç”¨äº† `Github Actions` åï¼Œè¿‡ç¨‹å˜ä¸ºäº†ï¼š

- å†™æ–‡ç« 
- æäº¤æ–‡ç« åˆ° `Github` ä¸Š

<!--truncate-->

## é…ç½®æ–‡ä»¶

æ¥ç€æˆ‘ä»¬ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™ä¸€åˆ©å™¨ã€‚é¦–å…ˆä½ éœ€è¦åœ¨ä½ çš„é¡¹ç›®ä¸‹æ–°å»º `.github/workflows/` æ–‡ä»¶å¤¹ï¼Œæ¥ç€åœ¨ `workflows` æ–‡ä»¶å¤¹ä¸‹æ–°å¢ `xxx.yml` æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åéšæ„ï¼Œä½†æ˜¯å¿…é¡»æ˜¯ `YAML` æ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘æ–°å¢æ–‡ä»¶åä¸º `deploy.yml`ï¼Œç»™å‡ºæˆ‘çš„é…ç½®å†…å®¹(å»æ‰äº†ä¸€äº›ä¸ªæ€§åŒ–çš„é…ç½®)

```yaml
name: Build and Deploy
on:
  push:
    branches:
      - master
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2.3.1

      - name: Install and Build ğŸ”§ 
        run: |
          npm install
          npm run build

      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@4.1.3
        with:
          BRANCH: gh-pages
          FOLDER: docs/.vuepress/dist
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
```

å½“ä½ å‘ `Github` æäº¤ä»£ç æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨çš„æ£€æµ‹ `.github/workflows/` ç›®å½•ï¼Œå¦‚æœæœ‰é…ç½®çš„è¯ï¼Œå°±ä¼šæ ¹æ®ä½ çš„é…ç½® `workflow` è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®ã€‚

ä»ä¸Šé¢çš„é…ç½®çœ‹ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨é—¨ï¼š

- `name`ï¼šè¿™ä¸ª `workflow` çš„åç§°ï¼Œè‡ªå·±éšä¾¿å–

- `on`ï¼šè§¦å‘æ¡ä»¶

  ```yaml
  on:
    push:
      branches:
        - master
  ```

  ä¸Šè¿°è¡¨ç¤ºå½“æˆ‘ä»¬å‘ `master` åˆ†æ”¯ `push` æ—¶å°±ä¼šè§¦å‘è¯¥ `workflow`

- `jobs`ï¼šè§„å®šè¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¾‹å¦‚ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä»»åŠ¡ `build-and-deploy`ï¼Œæ¯ä¸ªä»»åŠ¡åŒ…å«å¦‚ä¸‹é…ç½®

  - `runs-on`ï¼šè¿è¡Œæ‰€éœ€è¦çš„è™šæ‹Ÿæœºç¯å¢ƒï¼Œ`Github` ä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹ç¯å¢ƒ

    - `ubuntu-latest`ï¼Œ`ubuntu-18.04`æˆ–`ubuntu-16.04`
    - `windows-latest`ï¼Œ`windows-2019`æˆ–`windows-2016`
    - `macOS-latest`æˆ–`macOS-10.14`

    è¿™é‡Œæˆ‘ä»¬é€‰æ‹©äº† `ubuntu-latest`

  - `steps`ï¼šä»»åŠ¡è¿è¡Œçš„æ­¥éª¤

æ¥ç€æˆ‘ä»¬å¯¹æˆ‘ä»¬è¿è¡Œçš„æ­¥éª¤è¿›è¡Œè¯´æ˜ï¼Œæˆ‘ä»¬çš„æ­¥éª¤åŒ…å«ä¸‰æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯æ‹‰å–ä¸»åˆ†æ”¯çš„ä»£ç 

```yaml
- name: Checkout ğŸ›ï¸
  uses: actions/checkout@v2.3.1
```

ç¬¬äºŒæ­¥ï¼Œè¿è¡Œä¸¤ä¸ªå‘½ä»¤ `npm install` ä¸ `npm run build`

```yaml
- name: Install and Build ğŸ”§ 
  run: |
    npm install
    npm run build
```

ç¬¬ä¸‰æ­¥ï¼Œå°† ç”Ÿæˆçš„é™æ€æ–‡ä»¶å¤¹éƒ¨ç½²åˆ° `gh-pages` åˆ†æ”¯ä¸Š

```yaml
- name: Deploy ğŸš€
  uses: JamesIves/github-pages-deploy-action@4.1.3
  with:
    BRANCH: gh-pages
    FOLDER: docs/.vuepress/dist
    ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
```

## é…ç½®å¯†é’¥

ä½¿ç”¨ `Github Actions` æ˜¯éœ€è¦ `ACCESS-TOKEN`ï¼Œæ—¢ç„¶éƒ½å·²ç»ä¼šä½¿ç”¨ `Github` äº†ï¼Œå°±è‚¯å®šçŸ¥é“è¿™ä¸ªä¸œè¥¿æ€ä¹ˆç”Ÿæˆäº†ï¼Œå¦‚æœä¸ä¼šï¼Œè¯·æ±‚å‚ç…§[å®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token)ã€‚

æˆ‘ä»¬éœ€è¦åœ¨ä»“åº“çš„ `Setting` ä¸­é€‰æ‹© `Secrets`

<img src="https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting2/20210531185034.png" alt="image-20210531185033956"  />

ç‚¹å‡»å³ä¸Šæ–¹çš„ `New repository secret`

<img src="https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting2/20210531185129.png" alt="image-20210531185129280"  />

`Name` å¿…é¡»å†™ä¸º `ACCESS_TOKEN`ï¼Œ`Value` å°±æ˜¯ä½ çš„ `token`ï¼Œå¡«å†™å®Œæ¯•ç‚¹å‡» `Add secret`ï¼Œå¦‚æœå¡«å†™æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œç‚¹å‡»ä¹‹åå°±ä¼šæç¤ºæ·»åŠ æˆåŠŸã€‚

æ¯æ¬¡å½“ä½ å°† `Vuepress` é¡¹ç›®æäº¤åˆ° `Github` ä¸Šçš„æ—¶å€™ï¼Œ`Github` å°±ä¼šè‡ªåŠ¨å¸®ä½ éƒ¨ç½²é¡¹ç›®ã€‚

<img src="https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting2/20210531185615.png" alt="image-20210531185615412"  />

åœ¨ `Actions` çš„è¿™ä¸ªé€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°é¡¹ç›®çš„éƒ¨ç½²æƒ…å†µï¼Œä¸Šé¢å¯ä»¥çœ‹åˆ°æˆ‘å°è¯•äº†ä¸‰æ¬¡ï¼Œç¬¬ä¸‰æ¬¡æˆåŠŸäº†ï¼Œå‰ä¸¤æ¬¡æ˜¯è¸©å‘ï¼Œä¸‹é¢å°±ä»‹ç»äº†æˆ‘è¸©çš„ä¸¤æ¬¡å‘ã€‚

## è¸©å‘

åœ¨ `VuePress` å®˜ç½‘ä¸Šé¢ï¼Œç»™å‡ºçš„æ„å»ºè„šæœ¬å‘½ä»¤æ˜¯

```bash
npm run docs:build
```

æˆ‘è§‰å¾—éº»çƒ¦ï¼Œæ”¹ä¸ºäº† `npm run build`ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œå°±æç¤ºæˆ‘æ²¡æœ‰è¿™ä¸ªè„šæœ¬

<img src="https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting2/20210531190036.png" alt="image-20210531190036475"  />

æˆ‘æ”¹è¿‡æ¥äº†ï¼Œæ‰€ä»¥å¦‚æœä½ æ„å»ºçš„è„šæœ¬å‘½ä»¤å’Œæˆ‘çš„ä¸ä¸€è‡´çš„è¯ï¼Œè¿˜æ˜¯è¦æ”¹çš„ã€‚

å¦ä¸€ä¸ªå‘ï¼Œä¸Šé¢é…ç½®å¥½äº†ä»¥åï¼Œæˆ‘å°†æˆ‘çš„ `VuePress` åšå®¢æäº¤åˆ° `Github`ï¼Œä½†æ˜¯è¿è¡Œä¸€æ®µæ—¶é—´ä¹‹åçˆ†å‡ºäº†é”™è¯¯

<img src="https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting2/20210531190224.png" alt="image-20210531190224283"  />

ä»é”™è¯¯çš„ç±»å‹çœ‹å¥½åƒæ˜¯è¶…å†…å­˜äº†ï¼Œç„¶åç»è¿‡æˆ‘çš„æœç´¢ï¼Œåœ¨ `Github` çš„ä¸€ä¸ª `issue` ä¸­æ‰¾åˆ°äº†[è§£å†³åŠæ³•](https://github.com/ScaCap/action-surefire-report/issues/17#issuecomment-677015255)ï¼Œæ·»åŠ ä¸‹é¢çš„ç¯å¢ƒå˜é‡

```yaml
env:
  NODE_OPTIONS: '--max_old_space_size=4096'
```

æ›´æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹

```yaml {17-18}
name: Build and Deploy
on:
  push:
    branches:
      - master
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2.3.1

      - name: Install and Build ğŸ”§ 
        run: |
          npm install
          npm run build
        env:
          NODE_OPTIONS: '--max_old_space_size=4096'

      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@4.1.3
        with:
          BRANCH: gh-pages
          FOLDER: docs/.vuepress/dist
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
```

