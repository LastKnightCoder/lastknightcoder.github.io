"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[2221],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,b=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(b,o(o({ref:t},c),{},{components:n})):a.createElement(b,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294),r=n(6010);const i="tabItem_Ymn6";function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i,o),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(7462),r=n(7294),i=n(6010),o=n(2389),l=n(7392),s=n(7094),p=n(2466);const c="tabList__CuJ",d="tabItem_LNqP";function u(e){var t;const{lazy:n,block:o,defaultValue:u,values:m,groupId:b,className:k}=e,v=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),N=m??v.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),g=(0,l.l)(N,((e,t)=>e.value===t.value));if(g.length>0)throw new Error(`Docusaurus error: Duplicate values "${g.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const h=null===u?u:u??(null==(t=v.find((e=>e.props.default)))?void 0:t.props.value)??v[0].props.value;if(null!==h&&!N.some((e=>e.value===h)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${h}" but none of its children has the corresponding value. Available values are: ${N.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:C,setTabGroupChoices:y}=(0,s.U)(),[T,O]=(0,r.useState)(h),f=[],{blockElementScrollPositionUntilNextRender:M}=(0,p.o5)();if(null!=b){const e=C[b];null!=e&&e!==T&&N.some((t=>t.value===e))&&O(e)}const x=e=>{const t=e.currentTarget,n=f.indexOf(t),a=N[n].value;a!==T&&(M(t),O(a),null!=b&&y(b,String(a)))},j=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=f.indexOf(e.currentTarget)+1;n=f[t]??f[0];break}case"ArrowLeft":{const t=f.indexOf(e.currentTarget)-1;n=f[t]??f[f.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,i.Z)("tabs-container",c)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":o},k)},N.map((e=>{let{value:t,label:n,attributes:o}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,key:t,ref:e=>f.push(e),onKeyDown:j,onFocus:x,onClick:x},o,{className:(0,i.Z)("tabs__item",d,null==o?void 0:o.className,{"tabs__item--active":T===t})}),n??t)}))),n?(0,r.cloneElement)(v.filter((e=>e.props.value===T))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},v.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==T})))))}function m(e){const t=(0,o.Z)();return r.createElement(u,(0,a.Z)({key:String(t)},e))}},605:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>d});var a=n(7462),r=(n(7294),n(3905)),i=n(5488),o=n(5162);const l={slug:"MutationObserver",tags:["MutationObserver","DOM"],authors:"xiongtao",date:new Date("2022-10-11T00:00:00.000Z")},s=void 0,p={permalink:"/blog/MutationObserver",editUrl:"https://github.com/LastKnightCoder/lastknightcoder/tree/master/blog/2022-10-11-MutationObserver.mdx",source:"@site/blog/2022-10-11-MutationObserver.mdx",title:"MutationObserver",description:"\u5728\u590d\u6742\u7684\u7f51\u9875\u5e94\u7528\u4e2d\uff0cDOM \u7ed3\u6784\u4f1a\u9891\u7e41\u7684\u53d1\u751f\u53d8\u5316\uff0c\u6709\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u6839\u636e\u53d8\u5316\u6765\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\uff0c\u4ee5\u5f80\u901a\u8fc7 Mutation Events \u6765\u76d1\u542c DOM \u7684\u53d8\u5316\uff0c\u76ee\u524d\u5b83\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u88ab MutationObserver \u6240\u53d6\u4ee3\u3002MutationObserver \u7684\u517c\u5bb9\u6027\u5f88\u597d\uff0c\u53ef\u4ee5\u653e\u5fc3\u5927\u80c6\u7684\u4f7f\u7528\u3002",date:"2022-10-11T00:00:00.000Z",formattedDate:"2022\u5e7410\u670811\u65e5",tags:[{label:"MutationObserver",permalink:"/blog/tags/mutation-observer"},{label:"DOM",permalink:"/blog/tags/dom"}],readingTime:16.795,hasTruncateMarker:!0,authors:[{name:"\u718a\u6ed4",title:"\u524d\u7aef\u5de5\u7a0b\u5e08 @ \u9ad8\u5fb7",url:"https://github.com/LastKnightCoder",imageURL:"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/wallhaven-8opwwy.3cbn7rc981c0.webp",key:"xiongtao"}],frontMatter:{slug:"MutationObserver",tags:["MutationObserver","DOM"],authors:"xiongtao",date:"2022-10-11T00:00:00.000Z"},prevItem:{title:"\u79fb\u52a8\u7aef\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u65b9\u6848",permalink:"/blog/mobile-text-middle"},nextItem:{title:"IntersectionObserver",permalink:"/blog/IntersectionObserver"}},c={authorsImageUrls:[void 0]},d=[{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:2},{value:"\u901a\u8fc7 <code>childList</code> \u6765\u76d1\u542c\u5b50\u5143\u7d20\u7684\u53d8\u5316",id:"\u901a\u8fc7-childlist-\u6765\u76d1\u542c\u5b50\u5143\u7d20\u7684\u53d8\u5316",level:2},{value:"childList",id:"childlist",level:3},{value:"subtree",id:"subtree",level:3},{value:"\u901a\u8fc7 <code>attributes</code> \u6765\u76d1\u542c\u5c5e\u6027\u7684\u53d8\u5316",id:"\u901a\u8fc7-attributes-\u6765\u76d1\u542c\u5c5e\u6027\u7684\u53d8\u5316",level:2},{value:"attributes",id:"attributes",level:3},{value:"attributeOldValue",id:"attributeoldvalue",level:3},{value:"attributeFilter",id:"attributefilter",level:3},{value:"subtree",id:"subtree-1",level:3},{value:"\u901a\u8fc7 <code>characterData</code> \u6765\u76d1\u542c\u6587\u672c\u7684\u53d8\u5316",id:"\u901a\u8fc7-characterdata-\u6765\u76d1\u542c\u6587\u672c\u7684\u53d8\u5316",level:2},{value:"characterData",id:"characterdata",level:3},{value:"subtree",id:"subtree-2",level:3},{value:"characterDataOldValue",id:"characterdataoldvalue",level:3},{value:"\u901a\u8fc7 <code>takeRecords</code> \u62e6\u622a\u53d8\u5316",id:"\u901a\u8fc7-takerecords-\u62e6\u622a\u53d8\u5316",level:2},{value:"\u76d1\u542c\u591a\u4e2a\u5143\u7d20",id:"\u76d1\u542c\u591a\u4e2a\u5143\u7d20",level:2}],u={toc:d};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u5728\u590d\u6742\u7684\u7f51\u9875\u5e94\u7528\u4e2d\uff0cDOM \u7ed3\u6784\u4f1a\u9891\u7e41\u7684\u53d1\u751f\u53d8\u5316\uff0c\u6709\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u6839\u636e\u53d8\u5316\u6765\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\uff0c\u4ee5\u5f80\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"Mutation Events")," \u6765\u76d1\u542c DOM \u7684\u53d8\u5316\uff0c\u76ee\u524d\u5b83\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u88ab ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver")," \u6240\u53d6\u4ee3\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver")," \u7684\u517c\u5bb9\u6027\u5f88\u597d\uff0c\u53ef\u4ee5\u653e\u5fc3\u5927\u80c6\u7684\u4f7f\u7528\u3002"),(0,r.kt)("img",{src:"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/image.70ve24867iw.webp",style:{zoom:"50%"}}),(0,r.kt)("h2",{id:"\u57fa\u672c\u7528\u6cd5"},"\u57fa\u672c\u7528\u6cd5"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver")," \u7684\u57fa\u672c\u7528\u6cd5\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const observer = new MutationObserver(mutations => {\n\n});\nobserver.observe(element, options);\n")),(0,r.kt)("p",null,"\u6211\u4eec\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"new MutationObserver()")," \u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver")," \u5bf9\u8c61\uff0c\u6784\u9020\u51fd\u6570\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\uff0c\u5f53\u88ab\u76d1\u542c\u7684\u5143\u7d20 DOM \u53d1\u751f\u53d8\u5316\u65f6\uff0c\u8be5\u56de\u8c03\u51fd\u6570\u5c06\u4f1a\u6267\u884c\u3002"),(0,r.kt)("p",null,"\u56de\u8c03\u51fd\u6570\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u8be5\u53c2\u6570\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5176\u4e2d\u5143\u7d20\u7c7b\u578b\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationRecord"),"\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"MutationRecord")," \u5305\u542b\u5982\u4e0b\u5c5e\u6027\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{\n    type: 'attributes',\n    target: div#container,\n    addedNodes: [],\n    removeNodes: [],\n    previousSibling: null,\n    nextSibling: null,\n    attributeName: '',\n    attributeNamespace: null,\n    oldValue: ''\n}\n")),(0,r.kt)("p",null,"\u5728\u540e\u7eed\u5185\u5bb9\u4e2d\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u6bcf\u4e2a\u5b57\u6bb5\u7684\u4f5c\u7528\u3002"),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"observe(element, options)")," \u5bf9\u5143\u7d20 ",(0,r.kt)("inlineCode",{parentName:"p"},"element")," \u8fdb\u884c\u76d1\u542c\uff0c\u9664\u4e86\u9700\u8981\u4f20\u5165\u8981\u76d1\u542c\u7684\u5143\u7d20\u4ee5\u5916\uff0c\u8fd8\u9700\u8981\u4f20\u9012\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," \u5bf9\u8c61\uff0c\u5b83\u5305\u62ec\u5982\u4e0b\u5b57\u6bb5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{\n    childList: true,\n    attributes: true,\n    attributeFilter: ['class', 'style'],\n    attributeOldValue: true,\n    characterData: true,\n    characterDataOldValue: true,\n    subtree: true\n}\n")),(0,r.kt)("p",null,"\u8fd9\u91cc\u4e3a\u4e86\u5b8c\u6574\u6027\u5c06\u53ef\u8bbe\u7f6e\u7684\u6240\u6709\u53c2\u6570\u5217\u4e86\u51fa\u6765\uff0c\u5b9e\u9645\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," \u53c2\u6570\u5e76\u4e0d\u9700\u8981\u6307\u5b9a\u6bcf\u4e00\u4e2a\u5c5e\u6027\u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u89c2\u5bdf\u5230\u9664\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"attributeFilter")," \u5c5e\u6027\u5916\uff0c\u5176\u5b83\u5c5e\u6027\u90fd\u662f\u5e03\u5c14\u503c\uff0c\u4e5f\u5c31\u8bf4\u8fd9\u4e9b\u5c5e\u6027\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5f00\u5173\uff0c\u8bbe\u7f6e\u67d0\u4e2a\u5c5e\u6027\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," \u5c31\u76f8\u5f53\u4e8e\u5f00\u542f\u67d0\u4e2a\u7279\u6027\uff0c\u540e\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u6bcf\u4e2a\u5c5e\u6027\u7684\u4f5c\u7528\u3002"),(0,r.kt)("admonition",{title:"note",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"\u867d\u7136\u4e0d\u9700\u8981\u6307\u5b9a\u6bcf\u4e00\u4e2a\u5c5e\u6027\uff0c\u4f46\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"childList"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"attributes"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"characterData")," \u8fd9\u4e09\u4e2a\u5c5e\u6027\u5fc5\u987b\u6709\u4e00\u4e2a\u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\u3002")),(0,r.kt)("p",null,"\u5982\u679c\u4e0d\u518d\u9700\u8981\u76d1\u542c DOM \u7684\u53d8\u5316\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"observer.disconnect()")," \u65b9\u6cd5\u505c\u6b62\u76d1\u542c\u3002"),(0,r.kt)("p",null,"\u6765\u770b\u4e00\u4e2a\ud83c\udf30\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="container">\n  <p>\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</p>\n</div>\n<button id="btn">\u5220\u9664\u5143\u7d20</button>\n'))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const observer = new MutationObserver(mutations => {\n  console.log(mutations);\n});\nobserver.observe(document.getElementById('container'), {\n  childList: true\n});\n\nconst btn = document.getElementById('btn');\nbtn.addEventListener('click', () => {\n  document.getElementById('container').removeChild(\n    document.querySelector('#container p')\n  );\n});\n")))),(0,r.kt)("p",null,"\u9875\u9762\u4e2d\u6709\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u7684\u5143\u7d20\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\uff0c ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u4e2d\u5176\u4e2d\u5305\u542b\u4e00\u4e9b\u6587\u5b57\u3002\u9875\u9762\u4e2d\u8fd8\u6709\u4e00\u4e2a\u6309\u94ae\uff0c\u5f53\u70b9\u51fb\u6309\u94ae\u65f6\uff0c\u4f1a\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u4ece ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u4e2d\u79fb\u9664\u3002"),(0,r.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver"),"\uff0c\u5e76\u76d1\u542c\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u5143\u7d20\uff0c\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," \u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"childList")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\uff0c\u8868\u793a\u5f53 ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u7684\u5b50\u8282\u70b9\u53d1\u751f\u53d8\u5316\u65f6\uff08\u65b0\u589e\u6216\u5220\u9664\uff09\uff0c\u5c06\u4f1a\u88ab\u76d1\u542c\u5230\uff0c\u4ece\u800c\u89e6\u53d1\u56de\u8c03\u51fd\u6570\u7684\u6267\u884c\u3002\u5728\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u53ea\u662f\u7b80\u5355\u7684\u6253\u5370\u4e86\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u5f53\u6211\u4eec\u5220\u9664 ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u65f6\uff0c\u63a7\u5236\u53f0\u6253\u5370\u4e86\u5185\u5bb9\uff0c\u8868\u793a ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u7684\u53d8\u5316\u88ab\u76d1\u542c\u5230\u4e86\u3002"),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-base.mp4"}),(0,r.kt)("admonition",{title:"info",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver")," \u53ef\u4ee5\u76d1\u89c6\u5230\u4e09\u79cd DOM \u53d8\u5316\uff1a"),(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},"\u5b50\u5143\u7d20\u53d1\u751f\u53d8\u5316\uff08\u65b0\u589e\u6216\u5220\u9664\uff09"),(0,r.kt)("li",{parentName:"ol"},"\u5c5e\u6027\u53d1\u751f\u53d8\u5316"),(0,r.kt)("li",{parentName:"ol"},"\u5305\u542b\u7684\u6587\u672c\u53d1\u751f\u53d8\u5316")),(0,r.kt)("p",{parentName:"admonition"},"\u53ef\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationRecord")," \u5bf9\u8c61\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," \u5c5e\u6027\u6765\u533a\u5206\u662f\u4f55\u79cd\u53d8\u5316\uff0c\u5b83\u6709\u4e09\u4e2a\u503c\u5206\u522b\u4e0e\u4e0a\u8ff0\u53d8\u5316\u5bf9\u5e94\uff1a"),(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"childList")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"attributes")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"characterData")))),(0,r.kt)("h2",{id:"\u901a\u8fc7-childlist-\u6765\u76d1\u542c\u5b50\u5143\u7d20\u7684\u53d8\u5316"},"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"h2"},"childList")," \u6765\u76d1\u542c\u5b50\u5143\u7d20\u7684\u53d8\u5316"),(0,r.kt)("h3",{id:"childlist"},"childList"),(0,r.kt)("p",null,"\u5f53 ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," \u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"childList")," \u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," \u65f6\uff0c\u8868\u793a\u76d1\u542c\u5b50\u5143\u7d20\u7684\u53d8\u5316\uff0c\u5373\u5b50\u5143\u7d20\u7684\u65b0\u589e\u4e0e\u5220\u9664\u3002"),(0,r.kt)("p",null,"\u540c\u6837\u5728\u9875\u9762\u4e0a\u5b58\u5728\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u5143\u7d20\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\uff1b\u9875\u9762\u4e0a\u540c\u65f6\u5b58\u5728\u4e00\u4e2a\u6309\u94ae\uff0c\u5f53\u70b9\u51fb\u6309\u94ae\u65f6\u4f1a\u5220\u9664 ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u6216\u8005\u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="container">\n  <p>\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</p>\n</div>\n<button id="btn">\u5220\u9664/\u65b0\u589e</button>\n'))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  console.log(mutations);\n});\nobserver.observe(container, {\n  childList: true\n});\n\nconst btn = document.querySelector('#btn');\nbtn.addEventListener('click', () => {\n  const p = container.querySelector('p');\n  if (p) {\n    container.removeChild(p);\n  } else {\n    container.innerHTML = '<p>\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</p>';\n  }\n});\n")))),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-childList1.mp4"}),(0,r.kt)("p",null,"\u4ece\u89c6\u9891\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u7684\u5220\u9664\u4e0e\u65b0\u589e\u65f6\uff0c\u5747\u4f1a\u89e6\u53d1\u56de\u8c03\u51fd\u6570\u7684\u6267\u884c\u3002"),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationRecord")," \u5bf9\u8c61\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"addedNodes")," \u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"removedNodes")," \u5c5e\u6027\u53ef\u4ee5\u8bbf\u95ee\u5230\u6dfb\u52a0\u7684\u8282\u70b9\u4ee5\u53ca\u5220\u9664\u7684\u8282\u70b9\u3002\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"nextSibling")," \u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"prevSibling")," \u53ef\u4ee5\u83b7\u5f97\u88ab\u5220\u9664\u6216\u65b0\u589e\u8282\u70b9\u7684\u524d\u540e\u5144\u5f1f\u8282\u70b9\uff08\u5982\u679c\u4e0d\u5b58\u5728\u5219\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"null"),"\uff09\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const observer = new MutationObserver(mutations => {\n  mutations.forEach(mutation => {\n    console.log(mutation.addedNodes);\n    console.log(mutation.removedNodes);\n  })\n});\nobserver.observe(container, {\n  childList: true\n});\n")),(0,r.kt)("video",{src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-childList3.mp4",controls:!0}),(0,r.kt)("h3",{id:"subtree"},"subtree"),(0,r.kt)("p",null,"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"childList")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\uff0c\u53ea\u80fd\u76d1\u542c",(0,r.kt)("strong",{parentName:"p"},"\u76f4\u63a5\u5b50\u5143\u7d20"),"\u7684\u65b0\u589e\u4e0e\u5220\u9664\uff0c\u5bf9\u4e8e\u66f4\u6df1\u5c42\u6b21\u7684\u5b50\u5143\u7d20\u7684\u53d8\u5316\u65e0\u6cd5\u76d1\u542c\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="container">\n  <div id="inner-container">\n    <p>\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</p>\n  </div>\n</div>\n<button id="btn">\u5220\u9664/\u65b0\u589e</button>\n'))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  console.log(mutations);\n});\nobserver.observe(container, {\n  childList: true\n});\n    \nconst btn = document.querySelector('#btn');\nbtn.addEventListener('click', () => {\n  const innerContainer = document.querySelector('#inner-container');\n  const p = innerContainer.querySelector('p');\n  if (p) {\n    innerContainer.removeChild(p);\n  } else {\n    innerContainer.innerHTML = '<p>\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</p>';\n  }\n});\n")))),(0,r.kt)("p",null,"\u76f8\u6bd4\u4e8e\u4e0a\u4f8b\uff0c\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u4e4b\u95f4\u6dfb\u52a0\u4e86\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"inner-container")," \u5143\u7d20\uff0c\u6211\u4eec\u8fd8\u662f\u76d1\u542c ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u5143\u7d20\uff0c\u70b9\u51fb\u6309\u94ae\u65f6\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u8fdb\u884c\u79fb\u9664\u6216\u8005\u6dfb\u52a0\u3002"),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-childList2.mp4"}),(0,r.kt)("p",null,"\u56e0\u4e3a\u53ea\u80fd\u76d1\u542c\u76f4\u63a5\u5b50\u5143\u7d20\uff0c\u800c ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u5e76\u4e0d\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u7684 \u76f4\u63a5\u5b50\u5143\u7d20\uff0c\u6240\u4ee5 ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u7684\u5220\u9664\u4e0e\u65b0\u589e\u65e0\u6cd5\u88ab\u76d1\u542c\u5230\uff0c\u6240\u4ee5\u56de\u8c03\u51fd\u6570\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u63a7\u5236\u53f0\u4e0d\u4f1a\u6709\u4efb\u4f55\u7684\u8f93\u51fa\u3002"),(0,r.kt)("p",null,"\u90a3\u6709\u6ca1\u6709\u529e\u6cd5\u8fdb\u884c\u6df1\u5c42\u6b21\u7684\u76d1\u542c\u5462\uff1f\u7b54\u6848\u662f\u6709\uff0c\u9700\u8981\u914d\u5408 ",(0,r.kt)("inlineCode",{parentName:"p"},"subtree")," \u5c5e\u6027\u3002\u9664\u4e86\u9700\u8981\u6307\u5b9a ",(0,r.kt)("inlineCode",{parentName:"p"},"childList")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," \u4ee5\u5916\u8fd8\u9700\u8981\u6307\u5b9a ",(0,r.kt)("inlineCode",{parentName:"p"},"subtree")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="container">\n  <div id="inner-container">\n    <p>\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</p>\n  </div>\n</div>\n<button id="btn">\u5220\u9664/\u65b0\u589e</button>\n'))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  console.log(mutations);\n});\nobserver.observe(container, {\n  childList: true,\n  subtree: true\n});\n    \nconst btn = document.querySelector('#btn');\nbtn.addEventListener('click', () => {\n  const innerContainer = document.querySelector('#inner-container');\n  const p = innerContainer.querySelector('p');\n  if (p) {\n    innerContainer.removeChild(p);\n  } else {\n    innerContainer.innerHTML = '<p>\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</p>';\n  }\n});\n")))),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-childList4.mp4"}),(0,r.kt)("h2",{id:"\u901a\u8fc7-attributes-\u6765\u76d1\u542c\u5c5e\u6027\u7684\u53d8\u5316"},"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"h2"},"attributes")," \u6765\u76d1\u542c\u5c5e\u6027\u7684\u53d8\u5316"),(0,r.kt)("h3",{id:"attributes"},"attributes"),(0,r.kt)("p",null,"\u5f53\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"attributes")," \u5c5e\u6027\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," \u65f6\uff0c\u5c31\u53ef\u4ee5\u76d1\u542c\u5230\u5c5e\u6027\u7684\u53d8\u5316\uff0c\u5305\u62ec\u81ea\u5b9a\u4e49\u5c5e\u6027\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="container" class="red">\n  <p>\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</p>\n</div>\n<button id="btn">\u6539\u53d8\u989c\u8272</button>\n'))),(0,r.kt)(o.Z,{value:"css",label:"CSS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-css"},".red {\n  color: red;\n}\n.green {\n  color: green;\n}\n"))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  console.log(mutations);\n});\nobserver.observe(container, {\n  attributes: true\n});\n\nconst btn = document.querySelector('#btn');\nbtn.addEventListener('click', () => {\n  container.classList.toggle('red');\n  container.classList.toggle('green');\n});\n")))),(0,r.kt)("p",null,"\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u6bcf\u6b21\u70b9\u51fb\u6309\u94ae\u65f6\uff0c\u90fd\u4f1a\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u7684\u7c7b\u540d\u8fdb\u884c\u6539\u53d8\uff0c\u4ea4\u66ff\u7684\u6dfb\u52a0\u548c\u5220\u9664 ",(0,r.kt)("inlineCode",{parentName:"p"},"red")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"green")," \u7c7b\uff0c\u4ece\u800c\u4f7f\u5f97\u6587\u5b57\u7684\u6837\u5f0f\u53d1\u751f\u53d8\u5316\u3002"),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-attributes1.mp4"}),(0,r.kt)("p",null,"\u4ece\u89c6\u9891\u4e2d\u7684\u6253\u5370\u7ed3\u679c\u770b\uff0c\u6bcf\u6b21\u6211\u4eec\u4fee\u6539 ",(0,r.kt)("inlineCode",{parentName:"p"},"class")," \u65f6\uff0c\u56de\u8c03\u51fd\u6570\u90fd\u88ab\u6267\u884c\u4e86\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u6b21\u7684\u6570\u7ec4\u4e2d\u5305\u542b\u4e24\u4e2a\u5143\u7d20\uff0c\u4e00\u4e2a\u662f\u5220\u9664\u7c7b\u7684\u53d8\u52a8\uff0c\u4e00\u4e2a\u662f\u65b0\u589e\u7c7b\u7684\u53d8\u52a8\u3002"),(0,r.kt)("img",{src:"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/image.1uex3gw8w2rk.webp",style:{zoom:"50%"}}),(0,r.kt)("p",null,"\u53ef\u89c1\u770b\u5230\uff0c\u5c5e\u6027\u53d8\u52a8\u5bf9\u5e94\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationRecord")," \u5bf9\u8c61\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"attributes"),"\uff0c\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"attributeName")," \u53ef\u4ee5\u77e5\u9053\u4ec0\u4e48\u5c5e\u6027\u53d1\u751f\u4e86\u53d8\u5316\u3002"),(0,r.kt)("h3",{id:"attributeoldvalue"},"attributeOldValue"),(0,r.kt)("p",null,"\u901a\u8fc7\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"attributeOldValue")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\uff0c\u53ef\u4ee5\u77e5\u9053\u53d8\u52a8\u4e4b\u524d\u7684\u5c5e\u6027\u503c\u3002\u770b\u4e00\u4e2a\ud83c\udf30"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="container" data-text="Hello World"></div>\n<button id="btn">\u6539\u53d8\u81ea\u5b9a\u4e49\u5c5e\u6027</button>\n'))),(0,r.kt)(o.Z,{value:"css",label:"CSS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-css"},"#container::before {\n  content: attr(data-text);\n}\n"))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  mutations.forEach(mutation => {\n    console.log(mutation.oldValue);\n  });\n});\nobserver.observe(container, {\n  attributes: true,\n  attributeOldValue: true\n});\n\nconst texts = ['Hello World', '\u4f60\u597d\u4e16\u754c'];\nlet count = 0;\nconst btn = document.querySelector('#btn');\nbtn.addEventListener('click', () => {\n  container.dataset.text = texts[++count % 2];\n});\n")))),(0,r.kt)("p",null,"\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u5143\u7d20\u8bbe\u7f6e\u4e86\u81ea\u5b9a\u4e49\u5c5e\u6027 ",(0,r.kt)("inlineCode",{parentName:"p"},"data-text"),"\uff0c\u5e76\u8bbe\u7f6e\u5176\u4f2a\u5143\u7d20 ",(0,r.kt)("inlineCode",{parentName:"p"},"::before")," \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"data-text"),"\uff0c\u968f\u540e\u6211\u4eec\u70b9\u51fb\u6309\u94ae\uff0c\u6539\u53d8 ",(0,r.kt)("inlineCode",{parentName:"p"},"data-text")," \u7684\u503c\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"content")," \u968f\u4e4b\u6539\u53d8\uff0c\u9875\u9762\u53d1\u751f\u53d8\u5316\u3002\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver")," \u68c0\u6d4b\u5230\u8fd9\u4e00\u53d8\u5316\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationRecord")," \u5bf9\u8c61\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"oldValue")," \u5c5e\u6027\u6765\u8bbf\u95ee\u5230\u53d8\u5316\u4e4b\u524d\u7684\u5c5e\u6027\u503c\u3002"),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-attrOldValue.mp4?x=2"}),(0,r.kt)("h3",{id:"attributefilter"},"attributeFilter"),(0,r.kt)("p",null,"\u901a\u8fc7\u6307\u5b9a ",(0,r.kt)("inlineCode",{parentName:"p"},"attributeFilter")," \u5c5e\u6027\uff0c\u53ef\u4ee5\u53ea\u5173\u76d1\u542c\u7279\u5b9a\u5c5e\u6027\u7684\u53d8\u5316\uff0c\u5b83\u7684\u503c\u4e3a\u4e00\u4e2a\u6570\u7ec4\uff0c\u53ea\u76d1\u542c\u6570\u7ec4\u4e2d\u5305\u542b\u7684\u5c5e\u6027\u7684\u53d8\u5316"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div class="red" id="container" data-text="Hello World"></div>\n<button id="btn">\u6539\u503c\u4e0e\u6539\u8272</button>\n'))),(0,r.kt)(o.Z,{value:"css",label:"CSS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-css"},"#container::before {\n  content: attr(data-text);\n}\n.red {\n  color: red;\n}\n.green {\n  color: green;\n}\n"))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  mutations.forEach(mutation => {\n    // \u6253\u5370\u51fa\u53d8\u52a8\u7684\u5c5e\u6027\n    console.log(mutation.attributeName);\n  })\n});\nobserver.observe(container, {\n  attributes: true,\n  // \u53ea\u76d1\u542c data-text \u7684\u53d8\u5316\n  attributeFilter: ['data-text']\n});\n\nlet count = 0;\nconst texts = ['Hello World', '\u4f60\u597d\u4e16\u754c'];\nconst btn = document.querySelector('#btn');\nbtn.addEventListener('click', () => {\n  container.classList.toggle('red');\n  container.classList.toggle('green');\n  container.dataset.text = texts[++count % 2];\n});\n")))),(0,r.kt)("p",null,"\u5728\u4e0a\u9762\u6211\u4eec\u540c\u65f6\u6539\u53d8 ",(0,r.kt)("inlineCode",{parentName:"p"},"class")," \u5c5e\u6027\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"data-text")," \u5c5e\u6027\uff0c\u4f46\u662f\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," \u4e2d\u6211\u4eec\u8bbe\u7f6e\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"attributeFilter: ['data-text']"),"\uff0c\u5373\u53ea\u76d1\u542c ",(0,r.kt)("inlineCode",{parentName:"p"},"data-text")," \u5c5e\u6027\u3002\u6211\u4eec\u5728\u56de\u8c03\u51fd\u6570\u4e2d\u6253\u5370\u51fa\u76d1\u542c\u7684\u5c5e\u6027\u3002"),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-attrFilter.mp4"}),(0,r.kt)("p",null,"\u4ece\u89c6\u9891\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u6253\u5370\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"data-text"),"\uff0c\u5e76\u6ca1\u6709\u6253\u5370 ",(0,r.kt)("inlineCode",{parentName:"p"},"class"),"\u3002"),(0,r.kt)("h3",{id:"subtree-1"},"subtree"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"attributes")," \u5c5e\u6027\u4e5f\u53ef\u4ee5\u914d\u5408 ",(0,r.kt)("inlineCode",{parentName:"p"},"subtree")," \u4f7f\u7528\uff0c\u9664\u4e86\u53ef\u4ee5\u76d1\u542c\u6307\u5b9a\u5143\u7d20\u4e0a\u5c5e\u6027\u7684\u53d8\u5316\uff0c\u8fd8\u53ef\u4ee5\u76d1\u542c\u5230\u8be5\u5143\u7d20\u5305\u542b\u7684\u5b50\u5143\u7d20\u4e0a\u7684\u5c5e\u6027\u7684\u53d8\u5316\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="container">\n  <p class="red">Hello World!</p>\n</div>\n'))),(0,r.kt)(o.Z,{value:"css",label:"CSS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-css"},".red {\n  color: red;\n}\n.green {\n  color: green;\n}\n"))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  mutations.forEach(mutation => {\n    console.log(mutation);\n  });\n});\nobserver.observe(container, {\n  attributes: true,\n  subtree: true\n});\n\nsetTimeout(()=> {\n  const p = container.querySelector('p');\n  p.className = 'green';\n}, 3000);\n")))),(0,r.kt)("p",null,"\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u91cc\u9762\u6709\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u5305\u542b\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"class")," \u5c5e\u6027\u3002\u6211\u4eec\u4f7f\u7528\n",(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver")," \u76f4\u63a5\u76d1\u542c ",(0,r.kt)("inlineCode",{parentName:"p"},"container"),"\uff0c\u7136\u540e\u5f00\u542f\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5728\u5b9a\u65f6\u5668\u4e2d\u4fee\u6539 ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"class")," \u5c5e\u6027\uff0c\u7531\u4e8e\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," \u4e2d\u8bbe\u7f6e\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"subtree: true"),"\uff0c\u6240\u4ee5\u5373\u4f7f\u6211\u4eec\u76d1\u542c\u7684\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"container"),"\uff0c\u4f46\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"p")," \u6807\u7b7e\u5c5e\u6027\u7684\u53d8\u5316\u8fd8\u662f\u80fd\u88ab\u76d1\u542c\u5230\u3002"),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-attributes2.mp4"}),(0,r.kt)("h2",{id:"\u901a\u8fc7-characterdata-\u6765\u76d1\u542c\u6587\u672c\u7684\u53d8\u5316"},"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"h2"},"characterData")," \u6765\u76d1\u542c\u6587\u672c\u7684\u53d8\u5316"),(0,r.kt)("h3",{id:"characterdata"},"characterData"),(0,r.kt)("p",null,"\u901a\u8fc7\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"characterData")," \u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," \u6765\u76d1\u542c\u6587\u672c\u8282\u70b9\u7684\u53d8\u5316\u3002\u5176\u76f8\u5e94\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationRecord")," \u5bf9\u8c61\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," \u5c5e\u6027\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"characterData"),"\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="container" contenteditable="true">\u4e16\u754c\u8fd9\u4e48\u5927\uff0c\u6211\u60f3\u53bb\u770b\u770b</div>\n'))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  mutations.forEach(mutation => {\n    console.log(mutation);\n  });\n});\nobserver.observe(container.firstChild, {\n  characterData: true\n});\n")))),(0,r.kt)("p",null,"\u6211\u4eec\u51c6\u5907\u4e86\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"div"),"\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86\u5176 ",(0,r.kt)("inlineCode",{parentName:"p"},"contenteditable")," \u5c5e\u6027\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\uff0c\u5373\u5185\u90e8\u6587\u5b57\u53ef\u7f16\u8f91\u3002\u968f\u540e\u6211\u4eec\u76d1\u542c\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"div")," \u4e0b\u7684\u6587\u672c\u8282\u70b9\uff0c\u8bbe\u7f6e\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"characterData")," \u5c5e\u6027\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\uff0c\u5373\u76d1\u542c\u6587\u5b57\u7684\u53d8\u5316\u3002"),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-characterData1.mp4"}),(0,r.kt)("admonition",{title:"note",type:"note"},(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},"\u5f53\u4f7f\u7528 ",(0,r.kt)("kbd",null,"Ctrl + B")," \u6216\u8005 ",(0,r.kt)("kbd",null,"Ctrl + I")," \u4f7f\u5f97\u6587\u672c\u52a0\u7c97\u6216\u8005\u503e\u659c\u65f6\uff0c\u4f1a\u4f7f\u5f97\u539f\u6587\u672c\u8282\u70b9\u53d8\u4e3a\u591a\u4e2a\u8282\u70b9\uff0c\u8fd9\u65f6\u4f60\u518d\u7f16\u8f91\u6587\u5b57\uff0c\u4f1a\u53d1\u73b0 ",(0,r.kt)("inlineCode",{parentName:"li"},"MutationObserver")," \u4e0d\u8d77\u4f5c\u7528\uff0c\u9664\u975e\u4f60\u7f16\u8f91\u7684\u6587\u5b57\u88ab\u8ba4\u4e3a\u662f\u539f\u59cb\u7684\u6587\u672c\u8282\u70b9\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5f53\u4f60\u5c06\u6587\u672c\u8282\u70b9\u5305\u542b\u7684\u6240\u6709\u6587\u5b57\u90fd\u5220\u9664\u540e\uff0c",(0,r.kt)("inlineCode",{parentName:"li"},"MutationObserver")," \u4e0d\u518d\u89e6\u53d1\u56de\u8c03\u51fd\u6570\uff0c\u56e0\u4e3a\u4e00\u65e6\u6587\u5b57\u5220\u9664\u540e\uff0c\u539f\u6587\u672c\u8282\u70b9\u5c31\u88ab\u79fb\u9664\u4e86\uff0c\u518d\u6b21\u8f93\u5165\u7684\u6587\u5b57\u5f62\u6210\u4e86\u4e00\u4e2a\u65b0\u7684\u6587\u672c\u8282\u70b9\uff0c\u800c\u8fd9\u4e2a\u6587\u672c\u8282\u70b9\u5e76\u6ca1\u6709\u88ab\u76d1\u542c\u3002\u5982\u679c\u4ee5 ",(0,r.kt)("inlineCode",{parentName:"li"},"childList: true")," \u76d1\u542c\u6587\u672c\u8282\u70b9\u7236\u5bb9\u5668\uff0c\u53ef\u4ee5\u89c2\u5bdf\u5230\u5220\u9664\u6240\u6709\u6587\u672c\u7684\u65f6\u5019\u4f1a\u89e6\u53d1\u4e00\u6b21\u56de\u8c03\u51fd\u6570\uff0c\u56e0\u4e3a\u6b64\u65f6\u6587\u672c\u8282\u70b9\u88ab\u5220\u9664\u4e86\uff0c\u800c\u5220\u5b8c\u4e4b\u540e\u65b0\u589e\u6587\u5b57\u53c8\u4f1a\u89e6\u53d1\u4e00\u6b21\u56de\u8c03\u51fd\u6570\uff0c\u56e0\u4e3a\u6b64\u65f6\u65b0\u589e\u4e86\u4e00\u4e2a\u6587\u672c\u8282\u70b9\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u8f93\u5165\u4e2d\u6587\u5b57\u7b26\u65f6 ",(0,r.kt)("inlineCode",{parentName:"li"},"MutationObserver"),"\u65e0\u6cd5\u76d1\u542c\u5230\u5bf9\u5e94\u53d8\u5316\u3002"))),(0,r.kt)("h3",{id:"subtree-2"},"subtree"),(0,r.kt)("p",null,"\u4ee5\u4e0a\u4e09\u4e2a\u95ee\u9898\u5747\u53ef\u4ee5\u901a\u8fc7\u914d\u5408 ",(0,r.kt)("inlineCode",{parentName:"p"},"subtree")," \u6765\u89e3\u51b3\uff0c\u5f53\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"subtree")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," \u65f6\uff0c\u53ef\u4ee5\u76d1\u542c\u5230\u5b50\u8282\u70b9\u4e2d\u6587\u672c\u7684\u53d8\u5316\uff0c\u6240\u4ee5\u4e0d\u7ba1\u662f\u5206\u88c2\u4e3a\u591a\u4e2a\u8282\u70b9\u8fd8\u662f\u539f\u8282\u70b9\u88ab\u5220\u9664\u7136\u540e\u65b0\u589e\uff0c\u6240\u6709\u6587\u672c\u7684\u53d8\u5316\u90fd\u53ef\u4ee5\u88ab\u68c0\u6d4b\u5230\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  mutations.forEach(mutation => {\n    console.log(mutation);\n  });\n});\nobserver.observe(container, {\n  characterData: true,\n  subtree: true\n});\n")),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-characterData2.mp4"}),(0,r.kt)("admonition",{title:"note",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"\u9009\u62e9\u6587\u5b57\u7136\u540e\u8fdb\u884c\u5220\u9664\uff0c\u8fd9\u4e2a\u6587\u672c\u53d8\u5316\u597d\u50cf\u68c0\u67e5\u4e0d\u5230\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff0c\u8ddf\u9009\u533a\u6709\u5173\u5417\uff1f")),(0,r.kt)("h3",{id:"characterdataoldvalue"},"characterDataOldValue"),(0,r.kt)("p",null,"\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"characterDataOldValue")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," \u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationRecord")," \u5bf9\u8c61\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"oldValue")," \u5c5e\u6027\u83b7\u5f97\u53d8\u52a8\u4e4b\u524d\u7684\u6587\u672c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const container = document.querySelector('#container');\nconst observer = new MutationObserver(mutations => {\n  mutations.forEach(mutation => {\n    console.log(mutation.oldValue);\n  });\n});\nobserver.observe(container, {\n  characterData: true,\n  characterDataOldValue: true,\n  subtree: true,\n});\n")),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-chatacterData3.mp4"}),(0,r.kt)("h2",{id:"\u901a\u8fc7-takerecords-\u62e6\u622a\u53d8\u5316"},"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"h2"},"takeRecords")," \u62e6\u622a\u53d8\u5316"),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"takeRecords()")," \u65b9\u6cd5\uff0c\u53ef\u4ee5\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"mutations")," \u88ab\u56de\u8c03\u51fd\u6570\u5904\u7406\u4e4b\u524d\u62e6\u622a\u5230\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<ul id="list">\n  <li>\u7bee\u7403</li>\n  <li>\u8db3\u7403</li>\n  <li>\u7fbd\u6bdb\u7403</li>\n</ul>\n'))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const list = document.querySelector('#list');\nconst observer = new MutationObserver(mutations => {\n  console.log('callback:', mutations);\n});\nobserver.observe(list, {\n  childList: true\n});\n\nsetTimeout(() => {\n  list.insertAdjacentHTML('beforeend', '\\\\n<li>\u4e52\u4e53\u7403</li>');\n  const records = observer.takeRecords();\n  console.log('takeRecords:', records);\n}, 3000);\n")))),(0,r.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u51c6\u5907\u4e86\u4e00\u4e2a\u5217\u8868\uff0c\u4f7f\u7528\u4e00\u4e2a\u5b9a\u65f6\u5668\u5411\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u9879\u5185\u5bb9\uff0c\u6dfb\u52a0\u5185\u5bb9\u4e4b\u540e\uff0c\u6211\u4eec\u9a6c\u4e0a\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"takeRecords()")," \u8fdb\u884c\u4e86\u62e6\u622a\uff0c\u56e0\u6b64\u4e0d\u4f1a\u89e6\u53d1\u56de\u8c03\u51fd\u6570\u7684\u6267\u884c\u3002"),(0,r.kt)("video",{src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-takeRecords.mp4",controls:!0}),(0,r.kt)("h2",{id:"\u76d1\u542c\u591a\u4e2a\u5143\u7d20"},"\u76d1\u542c\u591a\u4e2a\u5143\u7d20"),(0,r.kt)("p",null,"\u540c\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"MutationObserver")," \u53ef\u4ee5\u540c\u65f6\u76d1\u542c\u591a\u4e2a\u5143\u7d20\uff0c\u53ef\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"disconnect")," \u53d6\u6d88\u6240\u6709\u5143\u7d20\u7684\u76d1\u542c\u3002"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"html",label:"HTML",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<div id="text1" contenteditable="true">Hello World!</div>\n<div id="text2" contenteditable="true">\u4f60\u597d\uff0c\u4e16\u754c\uff01</div>\n<button id="btn1">\u76d1\u542ctext1</button>\n<button id="btn2">\u76d1\u542ctext2</button>\n<button id="stopBtn">\u53d6\u6d88\u76d1\u542c</button>\n'))),(0,r.kt)(o.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const observer = new MutationObserver(mutations => {\n  console.log(mutations);\n});\n\nbtn1.addEventListener('click', () => {\n  observer.observe(text1, {\n    characterData: true,\n    subtree: true\n  });\n});\nbtn2.addEventListener('click', () => {\n  observer.observe(text2, {\n    characterData: true,\n    subtree: true\n  });\n});\nstopBtn.addEventListener('click', () => {\n  observer.disconnect();\n});\n")))),(0,r.kt)("video",{controls:!0,src:"https://video-obsidian.oss-cn-beijing.aliyuncs.com/MutationObserver-disconnect.mp4"}),(0,r.kt)("admonition",{title:"info",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"disconnect()")," \u4f1a\u53d6\u6d88\u6240\u6709\u5143\u7d20\u7684\u76d1\u542c\uff0c\u8fd9\u662f\u6211\u89c9\u5f97\u4e0d\u65b9\u4fbf\u7684\u5730\u65b9\uff0c\u4e0d\u50cf ",(0,r.kt)("inlineCode",{parentName:"p"},"IntersectionObserver")," \u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"unobserve()")," \u65b9\u6cd5\u53d6\u6d88\u76d1\u542c\u6307\u5b9a\u7684\u5143\u7d20\u3002")))}m.isMDXComponent=!0}}]);