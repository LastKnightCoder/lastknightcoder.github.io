"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9927],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>v});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),o=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},m=function(e){var n=o(e.components);return a.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),d=o(t),v=r,k=d["".concat(p,".").concat(v)]||d[v]||c[v]||l;return t?a.createElement(k,i(i({ref:n},m),{},{components:t})):a.createElement(k,i({ref:n},m))}));function v(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=d;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var o=2;o<l;o++)i[o]=t[o];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},873:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>s,toc:()=>o});var a=t(7462),r=(t(7294),t(3905));const l={slug:"EventEmitter",authors:"xiongtao",tags:["Node","EventEmitter"]},i=void 0,s={permalink:"/blog/EventEmitter",editUrl:"https://github.com/LastKnightCoder/lastknightcoder/tree/master/blog/2020-03-12-EventEmitter.mdx",source:"@site/blog/2020-03-12-EventEmitter.mdx",title:"EventEmitter",description:"EventEmitter \u7684\u4f7f\u7528",date:"2020-03-12T00:00:00.000Z",formattedDate:"2020\u5e743\u670812\u65e5",tags:[{label:"Node",permalink:"/blog/tags/node"},{label:"EventEmitter",permalink:"/blog/tags/event-emitter"}],readingTime:19.135,hasTruncateMarker:!1,authors:[{name:"\u718a\u6ed4",title:"\u524d\u7aef\u5de5\u7a0b\u5e08 @ \u963f\u91cc\u5df4\u5df4",url:"https://github.com/LastKnightCoder",imageURL:"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/wallhaven-8opwwy.3cbn7rc981c0.webp",key:"xiongtao"}],frontMatter:{slug:"EventEmitter",authors:"xiongtao",tags:["Node","EventEmitter"]},prevItem:{title:"Stream",permalink:"/blog/2020/04/02/Stream"},nextItem:{title:"Buffer",permalink:"/blog/Buffer"}},p={authorsImageUrls:[void 0]},o=[{value:"EventEmitter \u7684\u4f7f\u7528",id:"eventemitter-\u7684\u4f7f\u7528",level:2},{value:"on\u3001addListener",id:"onaddlistener",level:3},{value:"\u6267\u884c\u987a\u5e8f",id:"\u6267\u884c\u987a\u5e8f",level:4},{value:"\u91cd\u590d\u6dfb\u52a0",id:"\u91cd\u590d\u6dfb\u52a0",level:4},{value:"\u4f20\u9012\u53c2\u6570",id:"\u4f20\u9012\u53c2\u6570",level:4},{value:"\u540c\u6b65\u6267\u884c",id:"\u540c\u6b65\u6267\u884c",level:4},{value:"off\u3001removeListener",id:"offremovelistener",level:3},{value:"once",id:"once",level:3},{value:"prependListener\u3001prependOnceListener",id:"prependlistenerprependoncelistener",level:3},{value:"removeAllListeners",id:"removealllisteners",level:3},{value:"eventNames",id:"eventnames",level:3},{value:"listenerCount",id:"listenercount",level:3},{value:"setMaxLsiteners\u3001getMaxListeners",id:"setmaxlsitenersgetmaxlisteners",level:3},{value:"listeners\u3001rawListeners",id:"listenersrawlisteners",level:3},{value:"\u5b9e\u73b0\u4e00\u4e2a EventEmitter",id:"\u5b9e\u73b0\u4e00\u4e2a-eventemitter",level:2},{value:"on\u3001addListener",id:"onaddlistener-1",level:3},{value:"emit",id:"emit",level:3},{value:"prependListener",id:"prependlistener",level:3},{value:"off\u3001removeListener",id:"offremovelistener-1",level:3},{value:"once\u3001prependOnceListener",id:"onceprependoncelistener",level:3},{value:"removeAllListeners",id:"removealllisteners-1",level:3},{value:"eventNames",id:"eventnames-1",level:3},{value:"listenerCount",id:"listenercount-1",level:3},{value:"\u53c2\u8003\u6587\u732e",id:"\u53c2\u8003\u6587\u732e",level:2}],m={toc:o};function c(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"eventemitter-\u7684\u4f7f\u7528"},"EventEmitter \u7684\u4f7f\u7528"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"EventEmitter")," \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e8b\u4ef6\u8ba2\u9605\u673a\u5236\uff0c\u901a\u8fc7\u5f15\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},"events")," \u6a21\u5757\u6765\u4f7f\u7528\u5b83\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\n// \u76d1\u542c data \u4e8b\u4ef6\neventEmitter.on("data", () => {\n    console.log("data");\n});\n\n// \u89e6\u53d1 data \u4e8b\u4ef6\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u4e0a\u8ff0\u4ee3\u7801\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u65b9\u6cd5\u6765\u4e3a\u4e8b\u4ef6\u7ed1\u5b9a\u56de\u8c03\u51fd\u6570\uff0c\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," \u65b9\u6cd5\u6765\u89e6\u53d1\u4e00\u4e2a\u4e8b\u4ef6\u3002"),(0,r.kt)("h3",{id:"onaddlistener"},"on\u3001addListener"),(0,r.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"addListener")," \u65b9\u6cd5\u6765\u4e3a\u67d0\u4e8b\u4ef6\u6dfb\u52a0\u4e00\u4e2a\u76d1\u542c\u5668\uff0c\u4e8c\u8005\u7684\u4f7f\u7528\u662f\u4e00\u6837"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'eventEmitter.on("data", () => {\n    console.log("data");\n});\n\neventEmitter.addListener("data", () => {\n    console.log("data");\n});\n')),(0,r.kt)("p",null,"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u4e8b\u4ef6\u540d\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570\uff0c\u5f53 EventEmitter \u5b9e\u4f8b\u5bf9\u8c61\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," \u89e6\u53d1\u76f8\u5e94\u7684\u4e8b\u4ef6\u65f6\u4fbf\u4f1a\u8c03\u7528\u8be5\u56de\u8c03\u51fd\u6570\uff0c\u5982"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("data", () => {\n    console.log("data");\n});\n\neventEmitter.addListener("data", () => {\n    console.log("data");\n});\n\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u5728\u63a7\u5236\u53f0\u4f1a\u6253\u5370\u51fa\u4e24\u6b21 ",(0,r.kt)("inlineCode",{parentName:"p"},"data")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"data\ndata\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"\u4ece\u4e0a\u9762\u7684\u4f8b\u5b50\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u53ef\u4ee5\u4e3a\u540c\u4e00\u4e8b\u4ef6\u7ed1\u5b9a\u591a\u4e2a\u56de\u8c03\u51fd\u6570\u3002")),(0,r.kt)("h4",{id:"\u6267\u884c\u987a\u5e8f"},"\u6267\u884c\u987a\u5e8f"),(0,r.kt)("p",null,"\u5f53\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"p"},"addListener")," \u7ed1\u5b9a\u591a\u4e2a\u56de\u8c03\u51fd\u6570\u65f6\uff0c\u89e6\u53d1\u7684\u987a\u5e8f\u5c31\u662f\u6dfb\u52a0\u7684\u987a\u5e8f\uff0c\u5982"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("data", () => {\n    console.log("data 1");\n});\n\neventEmitter.on("data", () => {\n    console.log("data 2");\n});\n\neventEmitter.on("data", () => {\n    console.log("data 3");\n});\n\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u4f1a\u5728\u63a7\u5236\u53f0\u4f9d\u6b21\u6253\u5370\u51fa"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"data 1\ndata 2\ndata 3\n")),(0,r.kt)("h4",{id:"\u91cd\u590d\u6dfb\u52a0"},"\u91cd\u590d\u6dfb\u52a0"),(0,r.kt)("p",null,"\u5e76\u4e14\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u65b9\u6cd5\u7ed1\u5b9a\u4e8b\u4ef6\u65f6\uff0c\u5e76\u4e0d\u4f1a\u505a\u53bb\u91cd\u68c0\u67e5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require(\'events\');\nconst eventEmitter = new EventEmitter();\n\nconst listener = () => {\n    console.log("lsitener");\n}\n\neventEmitter.on("data", listener);\neventEmitter.on("data", listener);\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u63a7\u5236\u53f0\u7684\u6253\u5370\u7ed3\u679c\u4e3a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"lsitener\nlsitener\n")),(0,r.kt)("p",null,"\u4e0a\u9762\u7684\u7a0b\u5e8f\u4e3a\u4e8b\u4ef6\u7ed1\u5b9a\u4e86\u4e24\u6b21 ",(0,r.kt)("inlineCode",{parentName:"p"},"listener")," \u8fd9\u4e2a\u51fd\u6570\uff0c\u4f46\u662f\u5185\u90e8\u5e76\u4e0d\u4f1a\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u6dfb\u52a0\u8fc7\u8fd9\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u7136\u540e\u53bb\u91cd\uff0c\u6240\u4ee5\u4e0a\u9762\u5728\u63a7\u5236\u53f0\u6253\u5370\u51fa\u4e86\u4e24\u6b21 listener\u3002"),(0,r.kt)("h4",{id:"\u4f20\u9012\u53c2\u6570"},"\u4f20\u9012\u53c2\u6570"),(0,r.kt)("p",null,"\u53e6\u5916\u56de\u8c03\u51fd\u6570\u8fd8\u53ef\u4ee5\u63a5\u6536\u53c2\u6570\uff0c\u53c2\u6570\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," \u89e6\u53d1\u4e8b\u4ef6\u65f6\u4f20\u5165\uff0c\u5982"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("data", data => {\n    console.log(data);\n});\n\n// \u4e3a\u56de\u8c03\u51fd\u6570\u4f20\u5165\u53c2\u6570 HelloWorld!\neventEmitter.emit("data", "HelloWorld!");\n')),(0,r.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," \u89e6\u53d1\u4e8b\u4ef6\u65f6\uff0c\u8fd8\u4f20\u9012\u4e86\u989d\u5916\u7684\u53c2\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u4f1a\u88ab\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570\u3002"),(0,r.kt)("h4",{id:"\u540c\u6b65\u6267\u884c"},"\u540c\u6b65\u6267\u884c"),(0,r.kt)("p",null,"\u53e6\u5916\u4e00\u4e2a\u6bd4\u8f83\u5173\u5fc3\u7684\u95ee\u9898\uff0c\u4e8b\u4ef6\u7684\u89e6\u53d1\u662f\u540c\u6b65\u7684\u8fd8\u662f\u5f02\u6b65\u7684\uff0c\u6211\u4eec\u505a\u4e00\u4e2a\u5b9e\u9a8c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("data", () => {\n    console.log("\u89e6\u53d1\u4e86 data \u4e8b\u4ef6\uff01");\n});\n\nconsole.log("start");\neventEmitter.emit("data");\nconsole.log("end");\n')),(0,r.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u6211\u4eec\u5728\u89e6\u53d1\u4e8b\u4ef6\u524d\u540e\u90fd\u5411\u63a7\u5236\u53f0\u6253\u5370\u4e86\u4fe1\u606f\uff0c\u5982\u679c\u89e6\u53d1\u4e8b\u4ef6\u540e\u662f\u5f02\u6b65\u6267\u884c\u7684\uff0c\u90a3\u4e48\u540e\u9762\u7684\u6253\u5370\u8bed\u53e5\u5c31\u4f1a\u5148\u6267\u884c\uff0c\u5426\u5219\u5982\u679c\u662f\u540c\u6b65\u7684\u8bdd\uff0c\u5c31\u4f1a\u5148\u6267\u884c\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u3002\u6267\u884c\u7ed3\u679c\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"start\n\u89e6\u53d1\u4e86 data \u4e8b\u4ef6\uff01\nend\n")),(0,r.kt)("p",null,"\u53ef\u89c1\u4e8b\u4ef6\u89e6\u53d1\u662f\u540c\u6b65\u6267\u884c\u7684\u3002"),(0,r.kt)("h3",{id:"offremovelistener"},"off\u3001removeListener"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"off")," \u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"removeListener")," \u65b9\u6cd5\u7684\u4f5c\u7528\u540c ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"addLsitener")," \u7684\u4f5c\u7528\u662f\u76f8\u53cd\u7684\uff0c\u5b83\u4eec\u7684\u4f5c\u7528\u662f\u4e3a\u67d0\u4e2a\u4e8b\u4ef6\u5220\u9664\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require(\'events\');\nconst eventEmitter = new EventEmitter();\n\nlet listener1 = () => {\n    console.log("listener1");\n}\nlet listener2 = () => {\n    console.log("listener2");\n}\n\neventEmitter.on("data", listener1);\neventEmitter.on("data", listener2);\n\n// \u7b2c\u4e00\u6b21\u89e6\u53d1\uff0c\u4e24\u4e2a\u56de\u8c03\u51fd\u6570\u5426\u4f1a\u6267\u884c\neventEmitter.emit("data");\n\neventEmitter.off("data", listener1);\n// \u7b2c\u4e8c\u6b21\u89e6\u53d1\uff0c\u53ea\u4f1a\u6267\u884c listener2\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u63a7\u5236\u53f0\u6253\u5370\u7ed3\u679c\u4e3a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"listener1\nlistener2\nlistener2\n")),(0,r.kt)("p",null,"\u7b2c\u4e00\u6b21\u89e6\u53d1\u4e8b\u4ef6\u65f6\uff0c\u4e24\u4e2a\u4e8b\u4ef6\u90fd\u4f1a\u89e6\u53d1\uff0c\u7136\u540e\u6211\u4eec\u4e3a\u4e8b\u4ef6\u5220\u9664\u4e86 listener1 \u8fd9\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u6240\u4ee5\u7b2c\u4e8c\u6b21\u89e6\u53d1\u65f6\uff0c\u53ea\u4f1a\u89e6\u53d1 listener2\u3002"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"\u6ce8\u610f\uff1a\u5982\u679c\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u6216\u8005 ",(0,r.kt)("inlineCode",{parentName:"p"},"addListener")," \u7ed1\u5b9a\u7684\u662f\u4e00\u4e2a\u533f\u540d\u51fd\u6570\uff0c\u90a3\u4e48\u4fbf\u65e0\u6cd5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"off")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"removeListener")," \u53bb\u89e3\u7ed1\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u56e0\u4e3a\u5b83\u4f1a\u901a\u8fc7\u6bd4\u8f83\u4e24\u4e2a\u51fd\u6570\u7684\u5f15\u7528\u662f\u5426\u76f8\u540c\u6765\u89e3\u7ed1\u51fd\u6570\u7684\u3002")),(0,r.kt)("h3",{id:"once"},"once"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u53ef\u4ee5\u7ed1\u5b9a\u4e00\u4e2a\u53ea\u6267\u884c\u4e00\u6b21\u7684\u56de\u8c03\u51fd\u6570\uff0c\u5f53\u89e6\u53d1\u4e00\u6b21\u4e4b\u540e\uff0c\u8be5\u56de\u8c03\u51fd\u6570\u4fbf\u81ea\u52a8\u4f1a\u88ab\u89e3\u7ed1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.once("data", () => {\n    console.log("data");\n});\n\neventEmitter.emit("data");\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u4e0a\u8ff0\u4ee3\u7801\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," \u4e8b\u4ef6\u7ed1\u5b9a\u4e86\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u7136\u540e\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," \u65b9\u6cd5\u89e6\u53d1\u4e86\u4e24\u6b21\uff0c\u56e0\u4e3a\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u53ea\u4f1a\u88ab\u89e6\u53d1\u4e00\u6b21\uff0c\u6240\u4ee5\u7b2c\u4e8c\u6b21\u89e6\u53d1\uff0c\u56de\u8c03\u51fd\u6570\u4e0d\u4f1a\u6267\u884c\uff0c\u6240\u4ee5\u5728\u63a7\u5236\u53f0\u53ea\u6253\u5370\u4e86\u4e00\u6b21 data\u3002"),(0,r.kt)("p",null,"\u53e6\u5916\u540c ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u4e00\u6837\uff0c\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," \u65b9\u6cd5\u5411\u56de\u8c03\u51fd\u6570\u4f20\u9012\u53c2\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.once("data", data => {\n    console.log(data);\n});\n\neventEmitter.emit("data", "Hello");\n')),(0,r.kt)("p",null,"\u63a7\u5236\u53f0\u6253\u5370\u7ed3\u679c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"Hello\n")),(0,r.kt)("h3",{id:"prependlistenerprependoncelistener"},"prependListener\u3001prependOnceListener"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u6216\u8005 ",(0,r.kt)("inlineCode",{parentName:"p"},"addListener")," \u4e3a\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u4f1a\u88ab\u6839\u636e\u6dfb\u52a0\u7684\u987a\u5e8f\u6267\u884c\uff0c\u800c\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"prependLsitener")," \u7ed1\u5b9a\u7684\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\u4f1a\u5728\u5176\u4ed6\u56de\u8c03\u51fd\u6570\u4e4b\u524d\u6267\u884c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require(\'events\');\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("data", () => {\n    console.log("on");\n});\n\neventEmitter.prependListener("data", () => {\n    console.log("prepend");\n});\n\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u4e0a\u8ff0\u4ee3\u6253\u6211\u4eec\u5148\u7528\u63a7\u5236\u53f0\u7684\u6253\u5370\u7ed3\u679c\u4e3a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"prepend\non\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"prependOnceListener")," \u540c ",(0,r.kt)("inlineCode",{parentName:"p"},"prependListener"),"\uff0c\u4e0d\u8fc7\u5b83\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u53ea\u4f1a\u88ab\u6267\u884c\u4e00\u6b21"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require(\'events\');\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("data", () => {\n    console.log("on");\n});\n\neventEmitter.prependOnceListener("data", () => {\n    console.log("prepend once");\n});\n\neventEmitter.emit("data");\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"prependOnceListener")," \u7ed1\u5b9a\u4e86\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u5f53\u89e6\u53d1\u4e8b\u4ef6\u65f6\uff0c\u8be5\u56de\u8c03\u51fd\u6570\u4f1a\u5728\u5176\u4ed6\u51fd\u6570\u4e4b\u524d\u6267\u884c\uff0c\u5e76\u4e14\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\uff0c\u6240\u4ee5\u5f53\u7b2c\u4e8c\u6b21\u6211\u4eec\u89e6\u53d1\u51fd\u6570\u65f6\uff0c\u8be5\u56de\u8c03\u51fd\u6570\u4e0d\u4f1a\u6267\u884c\uff0c\u63a7\u5236\u53f0\u6253\u5370\u7ed3\u679c\u4e3a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"prepend once\non\non\n")),(0,r.kt)("h3",{id:"removealllisteners"},"removeAllListeners"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"removeAllListeners([event])")," \u65b9\u6cd5\u53ef\u4ee5\u5220\u9664\u4e8b\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"p"},"event")," \u7ed1\u5b9a\u7684\u6240\u6709\u56de\u8c03\u51fd\u6570\uff0c\u5982\u679c\u6ca1\u6709\u4f20\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},"event")," \u53c2\u6570\u7684\u8bdd\uff0c\u90a3\u4e48\u8be5\u65b9\u6cd5\u5c31\u4f1a\u5220\u9664\u6240\u6709\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require(\'events\');\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("data", () => {\n    console.log("data 1");\n});\n\neventEmitter.on("data", () => {\n    console.log("data 2");\n});\n\neventEmitter.emit("data");\neventEmitter.removeAllListeners("data");\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u4e0a\u9762\u7a0b\u5e8f\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," \u4e8b\u4ef6\u7ed1\u5b9a\u4e86\u4e24\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u5e76\u4e14\u5728\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"removeAllListeners")," \u65b9\u6cd5\u4e4b\u524d\u5206\u522b\u89e6\u53d1\u4e86\u4e00\u6b21 ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," \u4e8b\u4ef6\uff0c\u7b2c\u4e8c\u6b21\u89e6\u53d1 ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," \u4e8b\u4ef6\u65f6\uff0c\u4e0d\u4f1a\u6709\u4efb\u4f55\u7684\u56de\u8c03\u51fd\u6570\u88ab\u6267\u884c\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"removeAllListeners")," \u5220\u9664\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," \u4e8b\u4ef6\u7ed1\u5b9a\u7684\u6240\u6709\u56de\u8c03\u51fd\u6570\u3002\u63a7\u5236\u53f0\u7684\u6253\u5370\u7ed3\u679c\u4e3a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"data 1\ndata 2\n")),(0,r.kt)("h3",{id:"eventnames"},"eventNames"),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"eventNames")," \u65b9\u6cd5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4e3a\u54ea\u4e9b\u4e8b\u4ef6\u7ed1\u5b9a\u4e86\u56de\u8c03\u51fd\u6570\uff0c\u5b83\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("start", () => {\n    console.log("start");\n});\neventEmitter.on("end", () => {\n    console.log("end");\n});\neventEmitter.on("error", () => {\n    console.log("error");\n});\n\nconsole.log(eventEmitter.eventNames()); // [ \'start\', \'end\', \'error\' ]\n')),(0,r.kt)("p",null,"\u5982\u679c\u6211\u4eec\u5c06\u67d0\u4e8b\u4ef6\u7684\u6240\u6709\u56de\u8c03\u51fd\u6570\u5220\u9664\u540e\uff0c\u6b64\u65f6 ",(0,r.kt)("inlineCode",{parentName:"p"},"eventNames")," \u4fbf\u4e0d\u4f1a\u8fd4\u56de\u8be5\u4e8b\u4ef6\u4e86"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"eventEmitter.removeAllListeners(\"error\");\nconsole.log(eventEmitter.eventNames()); // [ 'start', 'end' ]\n")),(0,r.kt)("h3",{id:"listenercount"},"listenerCount"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"listenerCount")," \u65b9\u6cd5\u53ef\u4ee5\u5f97\u5230\u67d0\u4e2a\u4e8b\u4ef6\u7ed1\u5b9a\u4e86\u591a\u5c11\u4e2a\u56de\u8c03\u51fd\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.on("data", () => {\n\n});\neventEmitter.on("data", () => {\n\n});\n\nconsole.log(eventEmitter.listenerCount("data")); // 2\n')),(0,r.kt)("h3",{id:"setmaxlsitenersgetmaxlisteners"},"setMaxLsiteners\u3001getMaxListeners"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"setMaxListeners")," \u662f\u7528\u6765\u8bbe\u7f6e\u6700\u591a\u4e3a\u6bcf\u4e2a\u4e8b\u4ef6\u7ed1\u5b9a\u591a\u5c11\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u662f\u53ef\u4ee5\u7ed1\u5b9a\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6570\u76ee\u7684\u56de\u8c03\u51fd\u6570\u7684\uff0c\u4e0d\u8fc7\u5f53\u4f60\u7ed1\u5b9a\u8d85\u8fc7\u6307\u5b9a\u6570\u76ee\u7684\u56de\u8c03\u51fd\u6570\u65f6\uff0c\u4f1a\u5728\u63a7\u5236\u53f0\u7ed9\u51fa\u4e00\u4e2a\u8b66\u544a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\n// \u8bbe\u7f6e\u53ea\u80fd\u4e3a\u6bcf\u4e2a\u56de\u8c03\u51fd\u6570\u7ed1\u5b9a 1 \u4e2a\u56de\u8c03\u51fd\u6570\neventEmitter.setMaxListeners(1);\n\n// \u4e3a data \u4e8b\u4ef6\u7ed1\u5b9a\u4e86\u4e09\u4e2a\u56de\u8c03\u51fd\u6570\neventEmitter.on("data", () => {\n    console.log("data 1");\n});\neventEmitter.on("data", () => {\n    console.log("data 2");\n});\neventEmitter.on("data", () => {\n    console.log("data 3");\n});\n')),(0,r.kt)("p",null,"\u8fd0\u884c\u4e0a\u8ff0\u7a0b\u5e8f\uff0c\u63a7\u5236\u53f0\u6253\u5370\u7ed3\u679c\u4e3a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"data 1\ndata 2\ndata 3\n(node:36928) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 2 data listeners added to [EventEmitter]. Use emitter.setMaxListeners() to increase limit\n")),(0,r.kt)("p",null,"\u53ef\u89c1\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u4e09\u4e2a\u56de\u8c03\u51fd\u6570\u90fd\u53ef\u4ee5\u88ab\u89e6\u53d1\uff0c\u5e76\u4e14\u5728\u63a7\u5236\u53f0\u6253\u5370\u51fa\u4e86\u4e00\u6761\u8b66\u544a\u4fe1\u606f\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"getMaxListeners")," \u662f\u83b7\u5f97\u80fd\u4e3a\u6bcf\u4e2a\u4e8b\u4ef6\u7ed1\u5b9a\u591a\u5c11\u4e2a\u56de\u8c03\u51fd\u6570\u7684\u65b9\u6cd5\uff0c\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"setMaxListeners")," \u8bbe\u7f6e\u7684\u503c\u65f6\u591a\u5c11\uff0c\u8fd4\u56de\u7684\u503c\u5c31\u662f\u591a\u5c11"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.setMaxListeners(1);\n\nconsole.log(eventEmitter.getMaxListeners()); // 1\n')),(0,r.kt)("p",null,"\u5982\u679c\u6ca1\u6709\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"setMaxLsiteners")," \u8fdb\u884c\u8bbe\u7f6e\uff0c\u90a3\u4e48\u9ed8\u8ba4\u80fd\u591f\u4e3a\u6bcf\u4e2a\u4e8b\u4ef6\u6700\u591a\u7ed1\u5b9a ",(0,r.kt)("inlineCode",{parentName:"p"},"10")," \u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"EventEmitter")," \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"defaultMaxListeners")," \u5c5e\u6027\u83b7\u5f97\u8be5\u503c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\n\nconsole.log(EventEmitter.defaultMaxListeners); // 10\n')),(0,r.kt)("h3",{id:"listenersrawlisteners"},"listeners\u3001rawListeners"),(0,r.kt)("p",null,"\u5f53\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7ed1\u5b9a\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\u65f6\uff0c\u4e0d\u4f1a\u76f4\u63a5\u4e3a\u8be5\u4e8b\u4ef6\u7ed1\u5b9a\u8be5\u51fd\u6570\uff0c\u800c\u662f\u4f1a\u4f7f\u7528\u4e00\u4e2a\u51fd\u6570\u5305\u88c5\u8be5\u51fd\u6570\uff0c\u8fd9\u4e2a\u5305\u88c5\u51fd\u6570\u79f0\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"wrapper"),"\uff0c\u7136\u540e\u4e3a\u8be5\u4e8b\u4ef6\u7ed1\u5b9a ",(0,r.kt)("inlineCode",{parentName:"p"},"wrapper")," \u51fd\u6570\uff0c\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"wrapper")," \u51fd\u6570\u5185\u90e8\uff0c\u8bbe\u5b9a\u4e86\u5f53\u6267\u884c\u4e00\u6b21\u4e4b\u540e\u5c06\u81ea\u5df1\u89e3\u7ed1\u7684\u903b\u8f91\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"listeners")," \u8fd4\u56de\u6307\u5b9a\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u7ec4\u6210\u7684\u6570\u7ec4\uff0c\u800c ",(0,r.kt)("inlineCode",{parentName:"p"},"rawListeners")," \u4e5f\u662f\u8fd4\u56de\u6307\u5b9a\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u7ec4\u6210\u7684\u6570\u7ec4\uff0c\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"listeners")," \u4e0d\u540c\u7684\u662f\uff0c\u5bf9\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"wrapper"),"\uff0c\u800c\u4e0d\u662f\u539f\u751f\u7ed1\u5b9a\u7684\u51fd\u6570\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.once("data", () => {\n    console.log("once");\n})\n\nlet fns = eventEmitter.listeners("data");\n// once \u7ed1\u5b9a\u7684\u51fd\u6570\uff0c\u4e0d\u662f wrapper\uff0c\u5185\u90e8\u6ca1\u6709\u89e3\u7ed1\u7684\u903b\u8f91\uff0c\u6240\u4ee5\u540e\u9762\u89e6\u53d1 data \u4e8b\u4ef6\u65f6\u8fd8\u4f1a\u6267\u884c once \u7ed1\u5b9a\u7684\u51fd\u6570\nfns[0]()\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u63a7\u5236\u53f0\u6253\u5370\u7ed3\u679c\u4e3a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"once\nonce\n")),(0,r.kt)("p",null,"\u4e0b\u9762\u5c06\u4e0a\u9762\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"listeners")," \u66ff\u6362\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"rawListeners")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const {EventEmitter} = require("events");\nconst eventEmitter = new EventEmitter();\n\neventEmitter.once("data", () => {\n    console.log("once");\n})\n\n\nlet fns = eventEmitter.rawListeners("data");\n// \u56e0\u4e3a\u8fd4\u56de\u7684\u662f once \u7ed1\u5b9a\u51fd\u6570\u7684 wrapper\uff0c\u5176\u5185\u90e8\u6709\u6267\u884c\u4e00\u6b21\u540e\u89e3\u7ed1\u7684\u903b\u8f91\n// \u6240\u4ee5\u540e\u9762\u89e6\u53d1\u4e8b\u4ef6\u65f6 once \u7ed1\u5b9a\u7684\u51fd\u6570\u4e0d\u4f1a\u518d\u6267\u884c\nfns[0]()\neventEmitter.emit("data");\n')),(0,r.kt)("p",null,"\u63a7\u5236\u53f0\u7684\u6253\u5370\u7ed3\u679c\u4e3a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"once\n")),(0,r.kt)("h2",{id:"\u5b9e\u73b0\u4e00\u4e2a-eventemitter"},"\u5b9e\u73b0\u4e00\u4e2a EventEmitter"),(0,r.kt)("p",null,"\u5728\u8fd9\u4e2a\u5c0f\u8282\u5c06\u4ece\u96f6\u5b9e\u73b0\u4e00\u4e2a EventEmitter\uff0c\u6765\u52a0\u6df1\u5bf9\u8be5\u6a21\u5757\u7684\u7406\u89e3\u3002\u9996\u5148\u6211\u4eec\u9700\u8981\u51c6\u5907\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"listeners")," \u6765\u5b58\u50a8\u6240\u6709\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\uff0c\u5b83\u662f\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"Map")," \u5bf9\u8c61\uff0c\u952e\u662f\u4e8b\u4ef6\u540d\uff0c\u800c\u503c\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u4fdd\u5b58\u7684\u662f\u8be5\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"class EventEmitter {\n    constructor() {\n        this.listeners = new Map();\n    }\n}\n")),(0,r.kt)("h3",{id:"onaddlistener-1"},"on\u3001addListener"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u7ed1\u5b9a\u56de\u8c03\u51fd\u6570\u65f6\uff0c\u6211\u4eec\u5148\u5224\u65ad ",(0,r.kt)("inlineCode",{parentName:"p"},"Map")," \u96c6\u5408\u4e2d\u662f\u5426\u6709\u4e3a\u8be5\u4e8b\u4ef6\u7ed1\u5b9a\u56de\u8c03\u51fd\u6570\uff0c\u5982\u679c\u6709\u53d6\u51fa\u5bf9\u5e94\u6570\u7ec4\uff0c\u5e76\u6dfb\u52a0\u8be5\u56de\u8c03\u51fd\u6570\u8fdb\u6570\u7ec4\uff0c\u6ca1\u6709\u5219\u65b0\u5efa\u4e00\u4e2a\u6570\u7ec4\uff0c\u6dfb\u52a0\u8be5\u56de\u8c03\u51fd\u6570\uff0c\u5e76\u6dfb\u52a0\u8fdb ",(0,r.kt)("inlineCode",{parentName:"p"},"Map")," \u96c6\u5408"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"on(event, callback) {\n    if(!this.listeners.has(event)) {\n        this.listeners.set(event, []);\n    }\n    let fns = this.listeners.get(event);\n    fns.push(callback);\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"addListener")," \u7684\u529f\u80fd\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u662f\u4e00\u6837\u7684\uff0c\u6211\u4eec\u76f4\u63a5\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u65b9\u6cd5\u5373\u53ef"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"addListener(event, callback) {\n    this.on(event, callback);\n}\n")),(0,r.kt)("h3",{id:"emit"},"emit"),(0,r.kt)("p",null,"\u5f53\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," \u89e6\u53d1\u4e8b\u4ef6\u65f6\uff0c\u6211\u4eec\u4ece ",(0,r.kt)("inlineCode",{parentName:"p"},"Map")," \u53d6\u51fa\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570\u7ec4\u6210\u7684\u6570\u7ec4\uff0c\u7136\u540e\u4f9d\u6b21\u53d6\u51fa\u51fd\u6570\u6267\u884c\u3002\u53e6\u5916\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," \u4f20\u9012\u53c2\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"emit(event, ...args) {\n    if(!this.listeners.has(event)) {\n        return;\n    }\n    let fns = this.listeners.get(event);\n    let values = [];\n    for(let fn of fns) {\n        values.push(fn);\n    }\n    for (let fn of values) {\n        fn(...args);\n    }\n}\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"\u8fd9\u91cc\u4f60\u53ef\u80fd\u4f1a\u89c9\u5f97\u6211\u5199\u7684\u6709\u70b9\u590d\u6742\uff0c\u6240\u4ee5\u4f60\u4f1a\u89c9\u5f97\u76f4\u63a5\u8fd9\u4e48\u5199\u66f4\u597d"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"emit(event, ...args) {\n    if(!this.listeners.has(event)) {\n        return;\n    }\n    for (let fn of fns) {\n        fn(...args);\n    }\n}\n")),(0,r.kt)("p",{parentName:"admonition"},"\u4e00\u5f00\u59cb\u6211\u4e5f\u662f\u8fd9\u4e48\u5199\u7684\uff0c\u4f46\u662f\u56e0\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7ed1\u5b9a\u7684\u51fd\u6570\u5b83\u5728\u6267\u884c\u5b8c\u6bd5\u540e\u5c06\u81ea\u5df1\u4ece\u6570\u7ec4\u4e2d\u79fb\u9664\uff0c\u5e76\u4e14\u662f\u540c\u6b65\u7684\uff0c\u6240\u4ee5\u5728\u6267\u884c\u5faa\u73af\u7684\u65f6\u5019\uff0c\u6570\u7ec4\u662f\u5728\u4e0d\u65ad\u53d8\u5316\u7684\uff0c\u4f7f\u7528\u4e0a\u8ff0\u7684\u65b9\u5f0f\u4f1a\u4f7f\u5f97\u4e00\u4e9b\u56de\u8c03\u51fd\u6570\u4f1a\u88ab\u6f0f\u6389\uff0c\u6240\u4ee5\u6211\u624d\u4f1a\u5148\u5c06\u6570\u7ec4\u4e2d\u7684\u51fd\u6570\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u6570\u7ec4\uff0c\u7136\u540e\u904d\u5386\u8fd9\u4e2a\u65b0\u7684\u6570\u7ec4\uff0c\u56e0\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7ed1\u5b9a\u7684\u51fd\u6570\u5b83\u53ea\u4f1a\u5220\u9664\u539f\u6570\u7ec4\u4e2d\u7684\u51fd\u6570\uff0c\u800c\u4e0d\u4f1a\u5220\u9664\u65b0\u7684\u8fd9\u4e2a\u6570\u7ec4\uff0c\u6240\u4ee5\u65b0\u6570\u7ec4\u7684\u957f\u5ea6\u5728\u904d\u5386\u7684\u8fc7\u7a0b\u4e0d\u4f1a\u6539\u53d8\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53d1\u751f\u6f0f\u6389\u51fd\u6570\u672a\u6267\u884c\u7684\u60c5\u51b5\u3002")),(0,r.kt)("h3",{id:"prependlistener"},"prependListener"),(0,r.kt)("p",null,"\u5b9e\u73b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"prependListener")," \u7684\u903b\u8f91\u540c ",(0,r.kt)("inlineCode",{parentName:"p"},"on")," \u4e00\u6837\uff0c\u4e0d\u8fc7\u6211\u4eec\u662f\u5f80\u6570\u7ec4\u7684\u6700\u524d\u65b9\u6dfb\u52a0\u56de\u8c03\u51fd\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"prependListener(event, callback) {\n    if(!this.listeners.has(event)) {\n        this.listeners.set(event, []);\n    }\n    let fns = this.listeners.get(event);\n    fns.unshift(callback);\n}\n")),(0,r.kt)("h3",{id:"offremovelistener-1"},"off\u3001removeListener"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"off")," \u65b9\u6cd5\u662f\u7528\u6765\u89e3\u7ed1\u4e8b\u4ef6\u7684\uff0c\u5728\u6570\u7ec4\u4e2d\u627e\u5230\u6307\u5b9a\u7684\u51fd\u6570\uff0c\u7136\u540e\u5220\u9664\u5373\u53ef"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"off(event, callback) {\n    if(!this.listeners.has(event)) {\n        return;\n    }\n    let fns = this.listeners.get(event);\n    // \u627e\u51fa\u6570\u7ec4\u4e2d\u7684\u56de\u8c03\u51fd\u6570\uff0c\u7136\u540e\u5220\u9664\n    for (let i = 0; i < fns.length; i++) {\n        if(fns[i] === callback) {\n            fns.splice(i, 1);\n            break;\n        }\n    }\n    // \u5982\u679c\u5220\u9664\u56de\u8c03\u51fd\u6570\u540e\uff0c\u6570\u7ec4\u4e3a\u7a7a\uff0c\u5219\u5220\u9664\u8be5\u4e8b\u4ef6\n    if (fns.length === 0) {\n        this.listeners.delete(event);\n    }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"removeListener")," \u540c ",(0,r.kt)("inlineCode",{parentName:"p"},"off")," \u7684\u4f5c\u7528\u4e00\u6837\uff0c\u6211\u4eec\u5728\u5185\u90e8\u76f4\u63a5\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"off")," \u65b9\u6cd5\u5373\u53ef"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"removeListener(event, callback) {\n    this.off(event, callback);\n}\n")),(0,r.kt)("h3",{id:"onceprependoncelistener"},"once\u3001prependOnceListener"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7ed1\u5b9a\u4e00\u4e2a\u53ea\u6267\u884c\u4e00\u6b21\u7684\u51fd\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c06\u7ed1\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u4f7f\u7528\u4e00\u4e2a\u51fd\u6570\u5305\u88c5\u4e00\u4e0b\uff0c\u7136\u540e\u6dfb\u52a0\u8fdb\u6570\u7ec4\u4e2d\uff0c\u8fd9\u4e2a\u5305\u88c5\u51fd\u6570\u6211\u4eec\u79f0\u4e4b\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"wrapper"),"\u3002\u5728\u5305\u88c5\u51fd\u6570\u4e2d\uff0c\u5f53\u6267\u884c\u4e00\u904d\u540e\u4f1a\u5c06\u81ea\u5df1\u4ece\u6570\u7ec4\u4e2d\u5220\u9664"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"once(event, callback) {\n    let wrapper = (...args) => {\n        callback(...args);\n        this.off(event, wrapper);\n    }\n    if(!this.listeners.has(event)) {\n        this.listeners.set(event, []);\n    }\n    let fns = this.listeners.get(event);\n    fns.push(wrapper);\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"prependOnceListener")," \u7684\u5b9e\u73b0\u540c ",(0,r.kt)("inlineCode",{parentName:"p"},"once"),"\uff0c\u53ea\u662f\u5411\u6570\u7ec4\u7684\u5f00\u5934\u63d2\u5165\u51fd\u6570\uff0c\u5c06\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"push")," \u6362\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"unshift")," \u5373\u53ef"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"prependOnceListener(event, callback) {\n    let wrapper = (...args) => {\n        callback(...args);\n        this.off(event, wrapper);\n    }\n    if(!this.listeners.has(event)) {\n        this.listeners.set(event, []);\n    }\n    let fns = this.listeners.get(event);\n    fns.unshift(wrapper);\n}\n")),(0,r.kt)("h3",{id:"removealllisteners-1"},"removeAllListeners"),(0,r.kt)("p",null,"\u76f4\u63a5\u4ece\u5220\u9664\u5bf9\u5e94\u7684\u4e8b\u4ef6\uff0c\u5982\u679c\u6ca1\u6709\u4f20\u5165\u5177\u4f53\u4e8b\u4ef6\u7684\u8bdd\uff0c\u5219\u9700\u8981\u5220\u9664\u6240\u6709\u7684\u4e8b\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"removeAllListeners(event) {\n    // \u5982\u679c\u6ca1\u6709\u4f20\u5165 event\uff0c\u5219\u5220\u9664\u6240\u6709\u4e8b\u4ef6\n    if (event === undefined) {\n        this.listeners = new Map();\n        return;\n    }\n    this.listeners.delete(event);\n}\n")),(0,r.kt)("h3",{id:"eventnames-1"},"eventNames"),(0,r.kt)("p",null,"\u83b7\u5f97\u5df2\u7ecf\u7ed1\u5b9a\u4e86\u54ea\u4e9b\u4e8b\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"eventNames() {\n    return [...this.listeners.keys()];\n}\n")),(0,r.kt)("h3",{id:"listenercount-1"},"listenerCount"),(0,r.kt)("p",null,"\u83b7\u5f97\u67d0\u4e8b\u4ef6\u7ed1\u5b9a\u53ef\u591a\u5c11\u4e2a\u56de\u8c03\u51fd\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"listenerCount(event) {\n    return this.listeners.get(event).length;\n}\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"\u4e0a\u8ff0\u7684\u5b9e\u73b0\u6709\u4e00\u4e2a bug\uff0c\u90a3\u5c31\u662f\u65e0\u6cd5\u5220\u9664\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7ed1\u5b9a\u7684\u51fd\u6570\uff0c\u6211\u7684\u60f3\u6cd5\u662f\u4f7f\u7528\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"Map")," \u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7ed1\u5b9a\u7684\u51fd\u6570\u540c\u5bf9\u5e94\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"wrapper")," \u5bf9\u5e94\uff0c\u5220\u9664\u65f6\u5373\u53ef\u6839\u636e ",(0,r.kt)("inlineCode",{parentName:"p"},"once")," \u7684\u56de\u8c03\u51fd\u6570\u627e\u5230\u5bf9\u5e94\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"wrapper")," \u7136\u540e\u5220\u9664"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"constructor() {\n    this.listeners = new Map();\n    // \u4fdd\u5b58 once \u7684\u56de\u8c03\u51fd\u6570\u4e0e\u5bf9\u5e94\u7684 wrapper \n    this.onceToWrapper = new Map();\n}\n\nonce(event, callback) {\n    let wrapper = (...args) => {\n        callback(...args);\n        // \u5220\u9664\u4e4b\u524d\uff0c\u5220\u9664 callback \u548c wrapper \u7684\u5173\u7cfb\n        this.onceToWrapper.delete(callback);\n        this.off(event, wrapper);\n    }\n    if(!this.listeners.has(event)) {\n        this.listeners.set(event, []);\n    }\n    let fns = this.listeners.get(event);\n    // \u6dfb\u52a0\u4e4b\u524d\uff0c\u7ed1\u5b9a callback \u548c wrapper \u7684\u5173\u7cfb\n    this.onceToWrapper.set(callback, wrapper);\n    fns.push(wrapper);\n}\n\nprependOnceListener(event, callback) {\n    let wrapper = (...args) => {\n        callback(...args);\n        // \u540c\u4e0a\n        this.onceToWrapper.delete(callback);\n        this.off(event, wrapper);\n    }\n    if(!this.listeners.has(event)) {\n        this.listeners.set(event, []);\n    }\n    let fns = this.listeners.get(event);\n    // \u540c\u4e0a\n    this.onceToWrapper.set(callback, wrapper);\n    fns.unshift(wrapper);\n}\n\noff(event, callback) {\n    if(!this.listeners.has(event)) {\n        return;\n    }\n    let fns = this.listeners.get(event);\n    // \u5148\u4ece onceToWrapper \u4e2d\u67e5\u627e\u662f\u5426\u6709\u5bf9\u5e94\u7684 wrapper\uff0c\u5982\u679c\u6709\u8bf4\u660e\u662f once \u7ed1\u5b9a\u7684\n    callback = this.onceToWrapper.get(callback) || callback;\n    for (let i = 0; i < fns.length; i++) {\n        if(fns[i] === callback) {\n            fns.splice(i, 1);\n            break;\n        }\n    }\n    if (fns.length === 0) {\n        this.listeners.delete(event);\n    }\n}\n"))),(0,r.kt)("p",null,"\u5168\u90e8\u4ee3\u7801\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"class EventEmitter {\n    constructor() {\n        this.listeners = new Map();\n        this.onceToWrapper = new Map();\n    }\n\n    on(event, callback) {\n        if(!this.listeners.has(event)) {\n            this.listeners.set(event, []);\n        }\n        let fns = this.listeners.get(event);\n        fns.push(callback);\n    }\n\n    addListener(event, callback) {\n        this.on(event, callback);\n    }\n\n    emit(event, ...args) {\n        if(!this.listeners.has(event)) {\n            return;\n        }\n        let fns = this.listeners.get(event);\n        let values = [];\n        for(let fn of fns) {\n            values.push(fn);\n        }\n        for (let fn of values) {\n            fn(...args);\n        }\n    }\n\n    prependListener(event, callback) {\n        if(!this.listeners.has(event)) {\n            this.listeners.set(event, []);\n        }\n        let fns = this.listeners.get(event);\n        fns.unshift(callback);\n        \n    }\n\n    off(event, callback) {\n        if(!this.listeners.has(event)) {\n            return;\n        }\n        let fns = this.listeners.get(event);\n        callback = this.onceToWrapper.get(callback) || callback;\n        for (let i = 0; i < fns.length; i++) {\n            if(fns[i] === callback) {\n                fns.splice(i, 1);\n                break;\n            }\n        }\n        if (fns.length === 0) {\n            this.listeners.delete(event);\n        }\n    }\n\n    removeListener(event, callback) {\n        this.off(event, callback);\n    }\n\n    once(event, callback) {\n        let wrapper = (...args) => {\n            callback(...args);\n            this.onceToWrapper.delete(callback);\n            this.off(event, wrapper);   \n        }\n        if(!this.listeners.has(event)) {\n            this.listeners.set(event, []);\n        }\n        let fns = this.listeners.get(event);\n        this.onceToWrapper.set(callback, wrapper);\n        fns.push(wrapper);\n    }\n\n    prependOnceListener(event, callback) {\n        let wrapper = (...args) => {\n            callback(...args);\n            this.onceToWrapper.delete(callback);\n            this.off(event, wrapper);\n        }\n        if(!this.listeners.has(event)) {\n            this.listeners.set(event, []);\n        }\n        let fns = this.listeners.get(event);\n        this.onceToWrapper.set(callback, wrapper);\n        \n        fns.unshift(wrapper);\n    }\n\n    removeAllListeners(event) {\n        if (event === undefined) {\n            this.listeners = new Map();\n            return;\n        }\n        this.listeners.delete(event);\n    }\n\n    eventNames() {\n        return [...this.listeners.keys()];\n    }\n\n    listenerCount(event) {\n        return this.listeners.get(event).length;\n    }\n}\n")),(0,r.kt)("h2",{id:"\u53c2\u8003\u6587\u732e"},"\u53c2\u8003\u6587\u732e"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.freecodecamp.org/news/how-to-code-your-own-event-emitter-in-node-js-a-step-by-step-guide-e13b7e7908e1/"},"How to code your own event emitter in Node.js: a step-by-step guide")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/api/events.html"},"Nodejs|Events"))))}c.isMDXComponent=!0}}]);