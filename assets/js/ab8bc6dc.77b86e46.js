"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[3398],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var l=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,l,a=function(e,n){if(null==e)return{};var t,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)t=r[l],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)t=r[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=l.createContext({}),p=function(e){var n=l.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return l.createElement(s.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},d=l.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=p(t),k=a,u=d["".concat(s,".").concat(k)]||d[k]||m[k]||r;return t?l.createElement(u,i(i({ref:n},c),{},{components:t})):l.createElement(u,i({ref:n},c))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,i=new Array(r);i[0]=d;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var p=2;p<r;p++)i[p]=t[p];return l.createElement.apply(null,i)}return l.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7271:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var l=t(7462),a=(t(7294),t(3905));const r={authors:"xiongtao",slug:"\u624b\u5199Promise",tags:["Promise","\u624b\u5199"]},i=void 0,o={permalink:"/blog/\u624b\u5199Promise",editUrl:"https://github.com/LastKnightCoder/lastknightcoder/tree/master/blog/2020-06-28-\u624b\u5199Promise.mdx",source:"@site/blog/2020-06-28-\u624b\u5199Promise.mdx",title:"\u624b\u5199Promise",description:"Promise \u7684\u4f7f\u7528",date:"2020-06-28T00:00:00.000Z",formattedDate:"2020\u5e746\u670828\u65e5",tags:[{label:"Promise",permalink:"/blog/tags/promise"},{label:"\u624b\u5199",permalink:"/blog/tags/\u624b\u5199"}],readingTime:24.235,hasTruncateMarker:!0,authors:[{name:"\u718a\u6ed4",title:"\u524d\u7aef\u5de5\u7a0b\u5e08 @ \u963f\u91cc\u5df4\u5df4",url:"https://github.com/LastKnightCoder",imageURL:"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/wallhaven-8opwwy.3cbn7rc981c0.webp",key:"xiongtao"}],frontMatter:{authors:"xiongtao",slug:"\u624b\u5199Promise",tags:["Promise","\u624b\u5199"]},prevItem:{title:"\u5c0f\u7403\u4f1a\u505c\u4e0b\u6765\u5417",permalink:"/blog/2020/08/30/\u5c0f\u7403\u4f1a\u505c\u4e0b\u6765\u5417"},nextItem:{title:"TypeScript\u5165\u95e8\u6307\u5357",permalink:"/blog/2020/05/30/TypeScript\u5165\u95e8\u6307\u5357"}},s={authorsImageUrls:[void 0]},p=[{value:"Promise \u7684\u4f7f\u7528",id:"promise-\u7684\u4f7f\u7528",level:2},{value:"\u56de\u8c03\u5730\u72f1",id:"\u56de\u8c03\u5730\u72f1",level:3},{value:"Promise \u7684\u7b80\u5355\u4f7f\u7528",id:"promise-\u7684\u7b80\u5355\u4f7f\u7528",level:3},{value:"\u94fe\u5f0f\u8c03\u7528",id:"\u94fe\u5f0f\u8c03\u7528",level:3},{value:"\u539f\u578b\u65b9\u6cd5",id:"\u539f\u578b\u65b9\u6cd5",level:3},{value:"\u9759\u6001\u65b9\u6cd5",id:"\u9759\u6001\u65b9\u6cd5",level:3},{value:"resolve",id:"resolve",level:4},{value:"all",id:"all",level:4},{value:"race",id:"race",level:4},{value:"\u5b9e\u73b0 Promise",id:"\u5b9e\u73b0-promise",level:2},{value:"\u7b80\u5355\u5b9e\u73b0",id:"\u7b80\u5355\u5b9e\u73b0",level:3},{value:"\u94fe\u5f0f\u8c03\u7528",id:"\u94fe\u5f0f\u8c03\u7528-1",level:3},{value:"\u539f\u578b\u65b9\u6cd5",id:"\u539f\u578b\u65b9\u6cd5-1",level:3},{value:"\u9759\u6001\u65b9\u6cd5",id:"\u9759\u6001\u65b9\u6cd5-1",level:3},{value:"\u5b8c\u6574\u4ee3\u7801",id:"\u5b8c\u6574\u4ee3\u7801",level:3},{value:"\u53c2\u8003\u6587\u7ae0",id:"\u53c2\u8003\u6587\u7ae0",level:2}],c={toc:p};function m(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,l.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"promise-\u7684\u4f7f\u7528"},"Promise \u7684\u4f7f\u7528"),(0,a.kt)("h3",{id:"\u56de\u8c03\u5730\u72f1"},"\u56de\u8c03\u5730\u72f1"),(0,a.kt)("p",null,"\u9996\u5148\u6211\u4eec\u4e86\u89e3\u4e00\u4e0b ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u51fa\u73b0\u7684\u80cc\u666f\uff0c\u5047\u8bbe\u6709\u4e0b\u9762\u7684\u7a0b\u5e8f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"let name = getUserNameById(id);\nlet score = getScoreByName(name);\nlet scholarship = getScholarshipByScore(score);\nconsole.log(scholarship);\n")),(0,a.kt)("p",null,"\u8fd9\u4e2a\u7a0b\u5e8f\u9996\u5148\u6839\u636e ",(0,a.kt)("inlineCode",{parentName:"p"},"id")," \u53bb\u83b7\u53d6\u540d\u5b57\uff0c\u63a5\u7740\u6839\u636e\u62ff\u5230\u7684\u540d\u5b57\u53d6\u83b7\u5f97\u5206\u6570\uff0c\u6700\u540e\u6839\u636e\u5206\u6570\u53bb\u83b7\u53d6\u5956\u5b66\u91d1\uff0c\u6700\u540e\u6253\u5370\u51fa\u5956\u5b66\u91d1\u3002\u4f46\u662f\u8fd9\u4e2a\u7a0b\u5e8f\u771f\u7684\u80fd\u8fbe\u5230\u9884\u671f\u7684\u6548\u679c\u5417? \u7b54\u6848\u662f\u4e0d\u80fd\uff0c\u56e0\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"JavaScript")," \u662f\u5f02\u6b65\u7684\uff0c\u5bf9\u4e8e\u4e00\u822c\u7684\u8017\u65f6\u64cd\u4f5c\u5e76\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\uff0c\u800c\u662f\u5c06\u51fd\u6570\u4fdd\u5b58\u5728\u4e00\u4e2a\u961f\u5217\u4e2d\uff0c\u76f4\u5230\u4ee3\u7801\u6267\u884c\u5b8c\u6bd5\uff0c\u624d\u4f1a\u62ff\u51fa\u961f\u5217\u4e2d\u7684\u51fd\u6570\u6267\u884c\u3002\u6240\u4ee5\u4e0a\u9762\u7684\u51fd\u6570\u90fd\u4e0d\u4f1a\u88ab\u7acb\u5373\u6267\u884c\uff0c\u6240\u4ee5\u5f53\u7136\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u6240\u4ee5\u4e0a\u9762\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"name, score, scholarship")," \u90fd\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"undefined"),"\u3002"),(0,a.kt)("p",null,"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u4f7f\u7528\u56de\u8c03\u51fd\u6570\u7684\u5f62\u5f0f\uff0c\u7b49\u6211\u4eec\u6839\u636e ",(0,a.kt)("inlineCode",{parentName:"p"},"id")," \u62ff\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"name")," \u4e4b\u540e\uff0c\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"name"),' \u4f20\u5165\u56de\u8c03\u51fd\u6570\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1"\u540c\u6b65"\u7684\u6548\u679c\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u4e0a\u9762\u7684\u4ee3\u7801\u4fee\u6539\u5982\u4e0b'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"getUserNameById(id, function (name) {\n  getScoreByName(name, function (score) {\n    getScholarshipByScore(score, function (scholarship) {\n      console.log(scholarship);\n    });\n  });\n});\n")),(0,a.kt)("p",null,"\u4f46\u662f\u4e0a\u9762\u7684\u7a0b\u5e8f\u770b\u8d77\u6765\u8fd8\u662f\u602a\u5413\u4eba\u7684\uff0c\u51fd\u6570\u5957\u7740\u51fd\u6570\uff0c\u50cf\u8fd9\u6837\u7684\u60c5\u51b5\u6211\u4eec\u79f0\u4e4b\u4e3a\u56de\u8c03\u5730\u72f1\u3002\u56de\u8c03\u5730\u72f1\u4e0d\u80fd\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"try... catch")," \u6355\u83b7\u5f02\u5e38\uff0c\u4e0d\u80fd\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"return"),"\uff0c\u5e76\u4e14\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u5dee\uff0c\u8fd8\u5bb9\u6613\u51fa\u9519\u3002\u53ef\u80fd\u73b0\u5728\u4f60\u8fd8\u4f53\u4f1a\u4e0d\u5230\uff0c\u4e0a\u9762\u6211\u4eec\u53ea\u662f\u5d4c\u5957\u4e86\u4e09\u5c42\uff0c\u5b9e\u9645\u7684\u60c5\u51b5\u53ef\u80fd\u6709\u66f4\u591a\u7684\u5c42\uff0c\u4f7f\u5f97\u4ee3\u7801\u5f88\u96be\u9605\u8bfb\u3002"),(0,a.kt)("h3",{id:"promise-\u7684\u7b80\u5355\u4f7f\u7528"},"Promise \u7684\u7b80\u5355\u4f7f\u7528"),(0,a.kt)("p",null,"\u6b63\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"ES6")," \u4e2d\u63d0\u51fa\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u6765\u770b\u5982\u4f55\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise"),"\uff0c\u770b\u4e0b\u9762\u7684\u7a0b\u5e8f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve) => {\n  // fn1\n  setTimeout(() => {\n    console.log("1s");\n    resolve(1);\n  }, 1000);\n});\n\np.then((value) => {\n  // fn2\n  console.log(value);\n});\n')),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u6784\u9020\u51fd\u6570\u63a5\u53d7\u4e00\u4e2a\u56de\u8c03\u51fd\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn1"),"\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u6709\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u4e5f\u63a5\u53d7\u4e00\u4e2a\u56de\u8c03\u51fd\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn2"),"\uff0c\u53ea\u6709\u5f53 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn1")," \u4e2d\u63a5\u6536 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u51fd\u6570\u6267\u884c(\u5f53 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u6267\u884c\u4ee5\u540e\uff0c\u6211\u4eec\u5c31\u8bf4\u8be5 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u8fdb\u5165\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001)\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u624d\u4f1a\u88ab\u6267\u884c\u3002"),(0,a.kt)("p",null,"\u4ee5\u4e0a\u9762\u7684\u4ee3\u7801\u4e3a\u4f8b\uff0c\u9996\u5148\u6211\u4eec\u5f80 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u4e2d\u4f20\u9012\u4e86\u4e00\u4e2a\u56de\u8c03\u51fd\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn1"),"\uff0c\u8be5\u51fd\u6570\u4f1a\u7acb\u5373\u6267\u884c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'// \u5411\u6784\u9020\u51fd\u6570\u4e2d\u4f20\u5165\u7684\u56de\u8c03\u51fd\u6570 fn1\n(resolve) => {\n  setTimeout(() => {\n    console.log("1s");\n    resolve(1);\n  }, 1000);\n};\n')),(0,a.kt)("p",null,"\u5f53\u8be5 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn1")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u51fd\u6570\u6267\u884c\u4e4b\u540e\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u624d\u4f1a\u88ab\u6267\u884c\uff0c\u6240\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"1s")," \u4e4b\u540e ",(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u624d\u4f1a\u6267\u884c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// then \u63a5\u6536\u7684\u56de\u8c03\u51fd\u6570 fn2\n(value) => {\n  console.log(value);\n};\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u63a5\u6536\u7684\u53c2\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"value")," \u662f\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u4f20\u5165\u7684\uff0c\u5728\u4e0a\u9762\u6211\u4eec\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve(1)")," \u4f20\u5165\u4e86\u53c2\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"1"),"\uff0c\u6240\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u63a5\u53d7\u5230\u7684\u53c2\u6570\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"1"),"\u3002\u4e0a\u9762\u6267\u884c\u7684\u7ed3\u679c\u4e3a"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/2020062714122022-04-21-20-12-28.gif",style:{zoom:"50%"}}),(0,a.kt)("p",null,"\u53ef\u89c1 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u662f\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u51fd\u6570\u4e4b\u540e\u6267\u884c\u7684\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u4ee3\u7801\u6267\u884c\u7684\u987a\u5e8f\uff0c\u5e76\u4e14\u4e0d\u7528\u5199\u5d4c\u5957\u7684\u56de\u8c03\u51fd\u6570\uff0c\u800c\u662f\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"then"),' \u65b9\u6cd5\u8fdb\u884c"\u5e73\u884c"\u7684\u8c03\u7528\u3002'),(0,a.kt)("h3",{id:"\u94fe\u5f0f\u8c03\u7528"},"\u94fe\u5f0f\u8c03\u7528"),(0,a.kt)("p",null,"\u6240\u8c13\u7684\u94fe\u5f0f\u8c03\u7528\u662f\u6307\u5728\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u4e4b\u540e\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\uff0c\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve) => {\n  // fn1\n  resolve(1);\n});\n\np.then((value) => {\n  // fn2\n  console.log(value);\n  return 2;\n}).then((value) => {\n  // fn3\n  console.log(value);\n});\n")),(0,a.kt)("p",null,"\u8f93\u51fa\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"1;\n2;\n")),(0,a.kt)("p",null,"\u5982\u4e0a\u6240\u793a\uff0c\u6211\u4eec\u8fde\u7eed\u8c03\u7528\u4e86\u4e24\u6b21 ",(0,a.kt)("inlineCode",{parentName:"p"},"then"),"\uff0c\u5728\u6267\u884c\u65f6\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"fn3")," \u662f\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u4e4b\u540e\u6267\u884c\u7684\uff0c\u5e76\u4e14 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn3")," \u4e2d\u7684\u53c2\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"value")," \u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u7684\u8fd4\u56de\u503c\u3002\u5176\u5b9e ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u4e5f\u53ef\u4ee5\u4e0d\u4f20\u9012\u4efb\u4f55\u7684\u53c2\u6570"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve) => {\n  // fn1\n  resolve(1);\n});\n\np.then((value) => {\n  // fn2\n  console.log(value);\n  return 2;\n}).then() // \u6ca1\u6709\u4f20\u9012\u4efb\u4f55\u7684\u53c2\u6570\n  .then((value) => {\n    // fn3\n    console.log(value);\n  });\n")),(0,a.kt)("p",null,"\u5728\u4e0a\u9762\u6211\u4eec\u8c03\u7528\u4e86\u6ca1\u6709\u4f20\u5165\u56de\u8c03\u51fd\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u4e4b\u540e\u53c8\u7ee7\u7eed\u8c03\u7528\u4e86\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"then"),"\uff0c\u6839\u636e\u6211\u4eec\u4e0a\u9762\u6240\u8bb2\u7684\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"fn3")," \u63a5\u53d7\u7684\u53c2\u6570 ",(0,a.kt)("inlineCode",{parentName:"p"},"value")," \u662f\u7b2c\u4e8c\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u56de\u8c03\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u4f46\u662f\u7531\u4e8e\u7b2c\u4e8c\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u6ca1\u6709\u56de\u8c03\u51fd\u6570\uff0c\u610f\u5473\u7740\u6839\u672c\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f1a\u628a\u4e0a\u4e00\u5c42\u7684\u8fd4\u56de\u503c\u5373 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u8fd4\u56de\u503c\u4f20\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn3")),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/202204212013242022-04-21-20-13-25.png",style:{zoom:"50%"}}),(0,a.kt)("p",null,"\u6240\u4ee5\u4e0a\u9762\u7684\u8f93\u51fa\u662f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"1\n2\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u9664\u4e86\u53ef\u4ee5\u8fd4\u56de\u666e\u901a\u7684\u503c\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\uff0c\u5f53\u8fd4\u56de ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u65f6\uff0c\u4e0b\u9762\u5982\u679c\u7ee7\u7eed\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"then"),"\uff0c\u90a3\u4e48 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u8981\u7b49\u5230\u8fd9\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\u6267\u884c\u540e\u624d\u4f1a\u88ab\u6267\u884c\uff0c\u5373\u8fdb\u5165\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001 \uff0c\u5e76\u4e14\u8fd9\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u4e2d\u56de\u8c03\u51fd\u6570\u6240\u9700\u7684\u53c2\u6570\u662f\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u4f20\u5165\u7684\u503c\uff0c\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve) => {\n  resolve(1);\n});\n\np.then((value) => {\n  // fn1\n  console.log(value);\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      console.log("then \u8fd4\u56de\u7684Promise");\n      resolve(2);\n    }, 1000);\n  });\n}).then((value) => {\n  // fn2\n  console.log(value);\n});\n')),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"fn2")," \u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"fn1")," \u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u8fdb\u5165\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u4e4b\u540e\u624d\u4f1a\u88ab\u6267\u884c"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/202204212014492022-04-21-20-14-50.png",style:{zoom:"50%"}}),(0,a.kt)("p",null,"\u4e0a\u9762\u7684\u6267\u884c\u7ed3\u679c\u4e3a"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/2020062717352022-04-21-20-16-02.gif",style:{zoom:"50%"}}),(0,a.kt)("h3",{id:"\u539f\u578b\u65b9\u6cd5"},"\u539f\u578b\u65b9\u6cd5"),(0,a.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u4ecb\u7ecd\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\uff0c\u5f53\u6211\u4eec\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\u4e4b\u540e\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u63a5\u6536\u7684\u56de\u8c03\u51fd\u6570\u624d\u4f1a\u6267\u884c\u3002\u5176\u5b9e\u4f20\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u7684\u56de\u8c03\u51fd\u6570\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2a\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve"),"\uff0c\u53e6\u4e00\u4e2a\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"reject"),"\uff0c\u5f53\u51fd\u6570\u4ea7\u751f\u9519\u8bef\u65f6\uff0c\u90a3\u4e48\u6211\u4eec\u4f1a\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"reject")," \u65b9\u6cd5\uff0c\u8fd9\u65f6\u6211\u4eec\u8bf4 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u8fdb\u5165\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"rejetced")," \u72b6\u6001\uff0c\u8fd9\u65f6\u540e\u9762\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u4e0d\u4f1a\u6267\u884c\uff0c\u4e0e ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u76f8\u5bf9\u7684\u662f\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4e5f\u662f\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u8be5\u56de\u8c03\u51fd\u6570\u65f6\u7528\u6765\u5904\u7406\u9519\u8bef\u7684\uff0c\u5f53\u8be5 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u8fdb\u5165\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"rejected")," \u72b6\u6001\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u624d\u4f1a\u88ab\u6267\u884c\uff0c\u4e0e ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u76f8\u4f3c\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u56de\u8c03\u51fd\u6570\u63a5\u6536\u7684\u53c2\u6570\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"reject")," \u8c03\u7528\u65f6\u4f20\u5165\u7684\u53c2\u6570\uff0c\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve, reject) => {\n  reject("error");\n}).then(() => {\n    console.log("then\u65b9\u6cd5\u6267\u884c\u4e86");\n  })\n  .catch((error) => {\n    console.log("catch\u65b9\u6cd5\u6267\u884c");\n    console.log("message: " + error);\n  });\n')),(0,a.kt)("p",null,"\u7ed3\u679c\u4e3a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"catch\u65b9\u6cd5\u6267\u884c;\nmessage: error;\n")),(0,a.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u8c03\u7528\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"reject"),"\uff0c\u8fd9\u65f6\u540e\u9762\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u662f\u4e0d\u4f1a\u6267\u884c\u7684\uff0c\u800c\u662f\u4f1a\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u3002"),(0,a.kt)("admonition",{title:"note",type:"note"},(0,a.kt)("p",{parentName:"admonition"},"\u5176\u5b9e ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u53ef\u4ee5\u63a5\u53d7\u4e24\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u7b2c\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\u7528\u6765\u5904\u7406 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u4e4b\u540e\u7684\u7ed3\u679c\uff0c\u800c\u7b2c\u4e8c\u4e2a\u56de\u8c03\u51fd\u6570\u5219\u662f\u7528\u6765\u5904\u7406 ",(0,a.kt)("inlineCode",{parentName:"p"},"reject")," \u4e4b\u540e\u7684\u7ed3\u679c\uff0c\u6bd4\u5982\u4e0a\u9762\u7684\u7a0b\u5e8f\u53ef\u4ee5\u5199\u4e3a"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve, reject) => {\n  reject("error");\n}).then(\n  () => {\n    console.log("then\u65b9\u6cd5\u6267\u884c\u4e86");\n  },\n  (error) => {\n    console.log("catch\u65b9\u6cd5\u6267\u884c");\n    console.log("message:" + error);\n  }\n);\n'))),(0,a.kt)("p",null,"\u6267\u884c\u7684\u7ed3\u679c\u4e0e\u4e0a\u9762\u7684\u76f8\u540c\uff0c",(0,a.kt)("strong",{parentName:"p"},"\u5176\u5b9e ",(0,a.kt)("inlineCode",{parentName:"strong"},"catch(onError)")," \u51fd\u6570\u672c\u8d28\u4e0a\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"strong"},"then(null, onError)")),"\u3002"),(0,a.kt)("p",null,"\u6709\u7684\u65f6\u5019\u65e0\u8bba\u662f\u6210\u529f\u4ee5\u5426\uff0c\u6211\u4eec\u90fd\u5e0c\u671b\u6267\u884c\u4e00\u4e2a\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7684\u4f5c\u7528\u4e00\u822c\u662f\u7528\u6765\u8d44\u6e90\u7684\u56de\u6536\uff0c\u7528\u6765\u5b8c\u6210\u8fd9\u4e2a\u529f\u80fd\u7684\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"finally")," \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4e5f\u662f\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u8be5\u56de\u8c03\u51fd\u6570\u65e0\u8bba\u662f\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u8fd8\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"rejected")," \u72b6\u6001\u90fd\u662f\u4f1a\u88ab\u6267\u884c\u7684"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve, reject) => {\n  // rejected\u72b6\u6001\n  reject();\n})\n  .then(\n    () => {\n      console.log("then\u65b9\u6cd5\u6267\u884c\u4e86");\n    },\n    () => {\n      console.log("catch\u65b9\u6cd5\u6267\u884c");\n    }\n  )\n  .finally(() => {\n    console.log("finally\u6267\u884c\u4e86");\n  });\n')),(0,a.kt)("p",null,"\u6700\u540e\u7684\u6267\u884c\u7ed3\u679c\u4e3a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"catch\u65b9\u6cd5\u6267\u884c;\nfinally\u6267\u884c\u4e86;\n")),(0,a.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"reject()")," \u6539\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve()")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve, reject) => {\n  // fulfilled \u72b6\u6001\n  resolve();\n}).then(\n    () => {\n      console.log("then\u65b9\u6cd5\u6267\u884c\u4e86");\n    },\n    () => {\n      console.log("catch\u65b9\u6cd5\u6267\u884c");\n    }\n  )\n  .finally(() => {\n    console.log("finally\u6267\u884c\u4e86");\n  });\n')),(0,a.kt)("p",null,"\u8fd9\u65f6\u6267\u884c\u7684\u7ed3\u679c\u4e3a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"then\u65b9\u6cd5\u6267\u884c\u4e86\nfinally\u6267\u884c\u4e86\n")),(0,a.kt)("p",null,"\u6240\u4ee5\u4e0d\u8bba\u51fa\u4e8e\u54ea\u4e2a\u72b6\u6001\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"finally")," \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u90fd\u4f1a\u88ab\u6267\u884c\u3002"),(0,a.kt)("h3",{id:"\u9759\u6001\u65b9\u6cd5"},"\u9759\u6001\u65b9\u6cd5"),(0,a.kt)("p",null,"\u9759\u6001\u65b9\u6cd5\u6307\u7684\u5c31\u662f\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u76f4\u63a5\u8c03\u7528\u7684\u65b9\u6cd5\u3002"),(0,a.kt)("h4",{id:"resolve"},"resolve"),(0,a.kt)("p",null,"\u6211\u4eec\u9996\u5148\u6765\u4ecb\u7ecd ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\uff0c\u8be5\u51fd\u6570\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\uff0c\u6839\u636e\u53c2\u6570\u7684\u4e0d\u540c\u60c5\u51b5\uff0c\u8fd4\u56de\u503c\u4e5f\u4e0d\u76f8\u540c"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u53c2\u6570\u662f\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\uff0c\u76f4\u63a5\u8fd4\u56de"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"let p1 = new Promise((resolve, reject) => {\n  resolve(123);\n});\n\nlet p2 = Promise.resolve(p1);\n\nconsole.log(p1 === p2); // true\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u53c2\u6570\u662f\u4e00\u4e2a\u542b\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u7684\u5bf9\u8c61(\u6211\u4eec\u4e5f\u79f0\u4e4b\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"thenable")," \u5bf9\u8c61)\uff0c\u90a3\u4e48\u4f1a\u7acb\u5373\u6267\u884c\u8be5 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\uff0c\u8be5 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u4e3a\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve, reject")," \u65b9\u6cd5"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = Promise.resolve({\n  then(resolve, reject) {\n    resolve(123);\n  },\n});\n\np.then((value) => {\n  console.log(value); // 123\n});\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u53c2\u6570\u4e0d\u662f\u4e0a\u9762\u4e24\u79cd\u60c5\u51b5\uff0c\u90a3\u4e48\u4f1a\u8fd4\u56de\u7684\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise"),"\uff0c\u8be5 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u4f1a\u5c06\u53c2\u6570\u4f20\u7ed9\u540e\u9762\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = Promise.resolve("123");\n\np.then((value) => {\n  console.log(value); // 123\n});\n')))),(0,a.kt)("h4",{id:"all"},"all"),(0,a.kt)("p",null,"\u8be5\u65b9\u6cd5\u4e5f\u4f1a\u8fd4\u56de\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\uff0c\u5b83\u63a5\u53d7\u4e00\u4e2a\u7531 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u7ec4\u6210\u7684\u6570\u7ec4\uff0c\u53ea\u6709\u5f53\u8be5\u6570\u7ec4\u4e2d\u7684\u6240\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u90fd\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u4e4b\u540e\uff0c\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u624d\u4f1a\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p1 = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("p1");\n    resolve(1);\n  }, 1000);\n});\n\nlet p2 = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("p2");\n    resolve(2);\n  }, 2000);\n});\n\nlet p3 = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("p3");\n    resolve(3);\n  }, 3000);\n});\n\nPromise.all([p1, p2, p3]).then((results) => {\n  console.log(results); // [ 1, 2, 3 ]\n});\n')),(0,a.kt)("p",null,"\u5728\u4e0a\u9762\u6211\u4eec\u5b9a\u4e49\u4e09\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u4e09\u4e2a\u5bf9\u8c61\u5206\u522b\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"1s, 2s, 3s")," \u540e\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled"),"\uff0c\u6240\u4ee5\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"3s")," \u540e\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\uff0c\u5e76\u4e14\u4f1a\u5c06\u8fd9\u4e09\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u5411 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u4f20\u5165\u7684\u503c\u5f62\u6210\u6570\u7ec4\u4f20\u5165\u5230\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u4e2d"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/202204212018472022-04-21-20-18-48.png",style:{zoom:"50%"}}),(0,a.kt)("p",null,"\u4e0a\u9762\u4ee3\u7801\u7684\u6267\u884c\u7ed3\u679c\u4e3a"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/202006272055gif2022-04-21-20-19-28.gif",style:{zoom:"50%"}}),(0,a.kt)("h4",{id:"race"},"race"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"race")," \u65b9\u6cd5\u5b83\u4e5f\u4f1a\u8fd4\u56de\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\uff0c\u540c ",(0,a.kt)("inlineCode",{parentName:"p"},"all")," \u65b9\u6cd5\u4e00\u6837\uff0c\u5b83\u4e5f\u63a5\u53d7\u4e00\u4e2a\u7531 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u7ec4\u6210\u7684\u6570\u7ec4\uff0c\u4f46\u662f\u4e0d\u662f\u5f53\u6240\u6709\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u540e\uff0c\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u624d\u4f1a\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled"),"\uff0c\u800c\u662f\u8fd9\u4e9b ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u8fdb\u884c\u7ade\u8d5b\uff0c\u5f53\u6700\u5feb\u7684\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u65f6\uff0c\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u5c31\u4f1a\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p1 = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("p1");\n    resolve(1);\n  }, 1000);\n});\n\nlet p2 = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("p2");\n    resolve(2);\n  }, 2000);\n});\n\nlet p3 = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("p3");\n    resolve(3);\n  }, 3000);\n});\n\nPromise.race([p1, p2, p3]).then((result) => {\n  console.log(result);\n});\n')),(0,a.kt)("p",null,"\u5e76\u4e14\u4f1a\u5c06\u5411\u6700\u5feb\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u4f20\u5165\u7684\u503c\u4f20\u5165\u5230\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\u4e2d"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/202204212020082022-04-21-20-20-09.png",style:{zoom:"50%"}}),(0,a.kt)("p",null,"\u6240\u4ee5\u4e0a\u9762\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u4e3a"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/2020062721142022-04-21-20-20-53.gif",style:{zoom:"50%"}}),(0,a.kt)("p",null,"\u53ef\u89c1\u5f53 ",(0,a.kt)("inlineCode",{parentName:"p"},"p1")," \u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u4e4b\u540e\uff0c\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u4e5f\u53d8\u4e3a\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\uff0c\u5e76\u4e14\u62ff\u5230\u4e86\u5411 ",(0,a.kt)("inlineCode",{parentName:"p"},"p1")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u4e2d\u4f20\u5165\u7684\u503c\u3002"),(0,a.kt)("h2",{id:"\u5b9e\u73b0-promise"},"\u5b9e\u73b0 Promise"),(0,a.kt)("h3",{id:"\u7b80\u5355\u5b9e\u73b0"},"\u7b80\u5355\u5b9e\u73b0"),(0,a.kt)("p",null,"\u4e0b\u9762\u5c31\u5c06\u7b80\u5355\u5b9e\u73b0\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise"),"\u3002\u9996\u5148\u6211\u4eec\u8981\u660e\u786e\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u6709\u4e09\u4e2a\u72b6\u6001\uff0c\u5206\u522b\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"pending, fulfilled, rejected")," \u4e09\u4e2a\u72b6\u6001\uff0c\u521d\u59cb\u65f6\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"pending")," \u72b6\u6001\uff0c\u5f53\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\u540e\u5c31\u4f1a\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\uff0c\u5f53\u5904\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u65f6\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u4e2d\u7684\u7b2c\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\u624d\u4f1a\u88ab\u6267\u884c\uff1b\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"reject")," \u65b9\u6cd5\u5c31\u4f1a\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"rejected")," \u72b6\u6001\uff0c\u5f53\u5904\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"rejected")," \u72b6\u6001\u65f6\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u4e2d\u7684\u7b2c\u4e8c\u4e2a\u56de\u8c03\u51fd\u6570\u624d\u4f1a\u88ab\u6267\u884c\u6216\u8005 ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u624d\u4f1a\u88ab\u6267\u884c\u3002\u5e76\u4e14 ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"rejected")," \u72b6\u6001\u53ea\u80fd\u7531 ",(0,a.kt)("inlineCode",{parentName:"p"},"pending")," \u72b6\u6001\u8f6c\u53d8\u800c\u6765\uff0c\u5e76\u4e14\u4e00\u822c\u8f6c\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u6216\u8005 ",(0,a.kt)("inlineCode",{parentName:"p"},"rejected")," \u72b6\u6001\uff0c\u90a3\u4e48\u72b6\u6001\u5c31\u4e0d\u80fd\u518d\u6b21\u8fdb\u884c\u8f6c\u53d8"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'class Promise {\n  // Promise\u7684\u4e09\u4e2a\u72b6\u6001\n  PENDING = "pending";\n  FULFILLED = "fulfilled";\n  REJECTED = "rejected";\n\n  // \u5f53\u524d\u72b6\u6001\n  state = this.PENDING;\n  // \u4f20\u7ed9 then \u4e2d\u56de\u8c03\u51fd\u6570\u7684\u503c\n  value = null;\n\n  // \u6784\u9020\u51fd\u6570\uff0c\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u7acb\u5373\u6267\u884c\u8be5\u51fd\u6570\u5e76\u5c06 _resolve \u548c _reject \u4f20\u5165\n  constructor(fn) {\n    fn(this._resolve.bind(this), this._reject.bind(this));\n  }\n\n  // \u5f53\u6267\u884c\u5230 then \u65b9\u6cd5\u4f46\u8fd8\u672a\u53d8\u4e3a fulfilled \u72b6\u6001\u65f6\uff0c\u90a3\u4e48\u5c06\u5411 then \u4e2d\u4f20\u5165\u7684\u56de\u8c03\u51fd\u6570\u5148\u4fdd\u5b58\u8d77\u6765\n  callbacks = [];\n\n  _resolve(value) {\n    // \u5982\u679c\u72b6\u6001\u4e0d\u4e3a pending\uff0c\u8bf4\u660e\u72b6\u6001\u5df2\u53d1\u751f\u6539\u53d8\uff0c\u4e0d\u518d\u6267\u884c\n    if (this.state !== this.PENDING) {\n      return;\n    }\n\n    // \u5c06\u8981\u4f20\u7ed9 then \u4e2d\u56de\u8c03\u51fd\u6570\u7684\u503c\u4fdd\u5b58\u8d77\u6765\n    this.value = value;\n    // \u6539\u53d8\u72b6\u6001\n    this.state = this.FULFILLED;\n    // \u6267\u884c\u5411 then \u4e2d\u4f20\u5165\u7684 onFulfilled \u51fd\u6570\n    this.callbacks.forEach((callback) => callback.onFulfilled(this.value));\n  }\n\n  _reject(error) {\n    // \u8fc7\u7a0b\u540c reject\n    if (!this.PENDING) {\n      return;\n    }\n    this.value = error;\n    this.state = this.REJECTED;\n    this.callbacks.forEach((callback) => callback.onRejected(this.value));\n  }\n\n  then(onFulfilled, onRejected) {\n    // \u5982\u679c\u5f53\u524d\u7684\u72b6\u6001\u4e3a pending\uff0c\u90a3\u4e48\u5c06\u56de\u8c03\u51fd\u6570\u4fdd\u5b58\u5230 callbacks \u51fd\u6570\u4e2d\uff0c\u7b49\u5230\u72b6\u6001\u6539\u53d8\u65f6\u6267\u884c\n    if (this.state === this.PENDING) {\n      this.callbacks.push({\n        onFulfilled,\n        onRejected,\n      });\n      return;\n    }\n\n    // \u5982\u679c\u72b6\u6001\u4e3a fulfilled \u72b6\u6001\uff0c\u5219\u6267\u884c onFulfilled \u65b9\u6cd5\n    if (this.state === this.FULFILLED) {\n      onFulfilled(this.value);\n      return;\n    }\n\n    // \u540c\u4e0a\n    if (this.state === this.REJECTED) {\n      onRejected(this.value);\n      return;\n    }\n  }\n}\n')),(0,a.kt)("p",null,"\u4e0a\u9762\u7684\u7a0b\u5e8f\u7684\u6ce8\u91ca\u63cf\u8ff0\u4e86\u7a0b\u5e8f\u7684\u529f\u80fd\uff0c\u76f8\u6bd4\u8fd8\u662f\u4e0d\u96be\u7406\u89e3\u7684\uff0c\u73b0\u5728\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\u662f\u5426\u6709\u6548"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("1s\u540e");\n    resolve(1);\n  }, 1000);\n});\n\np.then((value) => {\n  console.log(value);\n});\n')),(0,a.kt)("p",null,"\u7ed3\u679c\u5982\u4e0b"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/2020062721452022-04-21-20-21-44.gif",style:{zoom:"50%"}}),(0,a.kt)("h3",{id:"\u94fe\u5f0f\u8c03\u7528-1"},"\u94fe\u5f0f\u8c03\u7528"),(0,a.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u6765\u5b9e\u73b0\u94fe\u5f0f\u8c03\u7528\uff0c\u8981\u5b9e\u73b0\u94fe\u5f0f\u8c03\u7528\u5c31\u9700\u8981\u8fd4\u56de\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise"),"\uff0c\u6bcf\u6b21\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u65b9\u6cd5\u6211\u4eec\u90fd\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise"),"\uff0c\u4fee\u6539\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"_resolve(value) {\n  if (this.state !== this.PENDING) {\n      return;\n  }\n  this.value = value;\n  this.state = this.FULFILLED;\n  // \u4fee\u6539\u4e86\u8fd9\u91cc\uff0c\u7531\u4e8e\u9700\u8981\u5c06 then \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u7684\u8fd4\u56de\u503c\u8fd4\u56de\uff0c\u6240\u4ee5\u4e0d\u80fd\u7b80\u5355\u7684\u8c03\u7528\n  this.callbacks.forEach(callback => this._handle(callback));\n}\n\n_reject(error) {\n  if (!this.PENDING) {\n      return;\n  }\n  this.value = error;\n  this.state = this.REJECTED;\n  // \u540c resolve\n  this.callbacks.forEach(callback => this._handle(callback));\n}\n\nthen(onFulfilled, onRejected) {\n  // \u8fd4\u56de\u65b0\u7684 Promise\n  return new Promise((resolve, reject) => {\n    this._handle({\n      onFulfilled,\n      onRejected,\n      resolve,\n      reject\n    })\n  })\n}\n\n_handle(callback) {\n  // \u5982\u679c\u662f pending \u72b6\u6001\uff0c\u5c06 callback \u5ef6\u8fdf\u6267\u884c\n  if (this.state === this.PENDING) {\n    this.callbacks.push(callback);\n  }\n  if (this.state === this.FULFILLED) {\n    // \u5982\u679c then \u65b9\u6cd5\u6ca1\u6709\u4f20\u5165 onFulFilled \u56de\u8c03\u51fd\u6570\uff0c\u90a3\u4e48\u5c06\u4e0a\u4e00\u5c42\u8fd4\u56de\u7684\u503c\u4f20\u5165\n    if (!callback.onFulfilled) {\n      callback.resolve(this.value);\n      return;\n    }\n    // \u5982\u679c\u6709 onFulFilled \u51fd\u6570\uff0c\u90a3\u4e48\u5c06 onFulFilled \u51fd\u6570\u7684\u8fd4\u56de\u503c\u4f20\u5165\u5230\u8fd4\u56de\u7684 Promise \u5bf9\u8c61\u7684 resolve \u4e2d\n    try {\n      // \u7528\u6237\u4f20\u5165\u7684\u56de\u8c03\u51fd\u6570\u53ef\u80fd\u4f1a\u51fa\u9519\uff0c\u6240\u4ee5\u4f7f\u7528 try...catch \u5305\u88f9\u8d77\u6765\n      let ret = callback.onFulfilled(this.value);\n      callback.resolve(ret);\n    } catch (e) {\n      // \u5f53\u4f20\u5165\u7684\u56de\u8c03\u51fd\u6570\u51fa\u9519\u65f6\uff0cPromise \u53d8\u4e3a rejected\u72b6\u6001\n      callback.reject(e);\n    }\n  }\n  if (this.state === this.REJECTED) {\n    if (!callback.onRejected) {\n      callback.reject(this.value);\n      return;\n    }\n    let ret = callback.onRejected(this.value);\n    callback.reject(ret);\n  }\n}\n")),(0,a.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\u662f\u5426\u80fd\u591f\u8fdb\u884c\u94fe\u5f0f\u8c03\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("1s\u540e");\n    resolve(1);\n  }, 1000);\n});\n\np.then((value) => {\n  console.log(value);\n  return 2;\n}).then() // \u4ec0\u4e48\u56de\u8c03\u51fd\u6570\u90fd\u6ca1\u6709\u4f20\u5165\uff0c\u4f1a\u5c06\u4e0a\u4e00\u4e2a then \u8fd4\u56de\u7684\u503c\u4f20\u5165\n  .then((value) => {\n    console.log(value);\n  });\n')),(0,a.kt)("p",null,"\u4e0a\u9762\u7684\u6267\u884c\u7ed3\u679c\u4e3a"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/2020062722232022-04-21-20-22-52.gif",style:{zoom:"50%"}}),(0,a.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u8fd8\u8981\u6700\u540e\u4e00\u4e2a\u95ee\u9898\u6ca1\u6709\u89e3\u51b3\uff0c\u5c31\u662f\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8981\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"_resolve")," \u5bf9\u503c\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u503c\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\uff0c\u8bb0\u4f5c ",(0,a.kt)("inlineCode",{parentName:"p"},"p1"),"\uff0c\u90a3\u4e48 ",(0,a.kt)("inlineCode",{parentName:"p"},"then")," \u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61 ",(0,a.kt)("inlineCode",{parentName:"p"},"p2")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\u5e94\u5f53\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"p1")," \u5bf9\u8c61\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u6267\u884c\u4e4b\u540e\u6267\u884c\u3002\u4fee\u6539 ",(0,a.kt)("inlineCode",{parentName:"p"},"_resolve")," \u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"_resolve(value) {\n  if (this.state !== this.PENDING) {\n      return;\n  }\n\n  // \u53ea\u589e\u52a0\u4e86\u4e0b\u9762\u7684\u4ee3\u7801\n  if (value instanceof Promise) {\n    // \u5f53\u524d resolve \u7684\u6267\u884c\u5e94\u5f53\u5728 value \u7684 resolve \u6267\u884c\u4e4b\u540e\n    value.then(this._resolve.bind(this), this._reject.bind(this));\n    return;\n  }\n\n  this.value = value;\n  this.state = this.FULFILLED;\n  this.callbacks.forEach(callback => this._handle(callback));\n}\n")),(0,a.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u6765\u9a8c\u8bc1\u4e00\u756a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'let p = new Promise((resolve) => {\n  setTimeout(() => {\n    console.log("1s\u540e");\n    resolve(1);\n  }, 1000);\n});\n\np.then((value) => {\n  console.log(value);\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      console.log("\u53c81s\u540e");\n      resolve(2);\n    }, 1000);\n  });\n}).then((value) => {\n  console.log(value);\n});\n')),(0,a.kt)("p",null,"\u6267\u884c\u7ed3\u679c\u4e3a"),(0,a.kt)("img",{src:"https://cdn.jsdelivr.net/gh/LastKnightCoder/ImgHosting3@master/2020062722392022-04-21-20-23-35.gif",style:{zoom:"50%"}}),(0,a.kt)("h3",{id:"\u539f\u578b\u65b9\u6cd5-1"},"\u539f\u578b\u65b9\u6cd5"),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u7ee7\u7eed\u5b9e\u73b0 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u7684\u51e0\u4e2a\u539f\u578b\u65b9\u6cd5\uff0c\u5206\u522b\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"finally"),"\u3002",(0,a.kt)("inlineCode",{parentName:"p"},"catch")," \u7684\u5b9e\u73b0\u5f88\u7b80\u5355"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"catch(onRejected) {\n  return this.then(null, onRejected);\n}\n")),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u662f\u5b9e\u73b0 ",(0,a.kt)("inlineCode",{parentName:"p"},"finally")," \u65b9\u6cd5\uff0c\u6700\u5bb9\u6613\u60f3\u5230\u7684\u7248\u672c\u662f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"finally(onDone) {\n  return this.then(onDone, onDone);\n}\n")),(0,a.kt)("p",null,"\u4e0d\u7ba1\u662f\u5904\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u7684\u72b6\u6001\u8fd8\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"rejected")," \u7684\u72b6\u6001\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"onDone")," \u65b9\u6cd5\u90fd\u4f1a\u5f97\u5230\u6267\u884c\uff0c\u4f46\u662f\u4f7f\u7528\u8fd9\u6837\u7684\u65b9\u5f0f\u6709\u7f3a\u70b9"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"onDone")," \u65b9\u6cd5\u662f\u65e0\u8bba\u5931\u8d25\u8fd8\u662f\u6210\u529f\u65f6\u90fd\u4f1a\u6267\u884c\u7684\uff0c\u6240\u4ee5\u5b83\u5e94\u8be5\u6ca1\u6709\u53c2\u6570\uff0c\u4f46\u662f\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"then(onDone, onDone)")," \u7684\u65b9\u5f0f\u5c31\u4f1a\u4f20\u5165\u53c2\u6570"),(0,a.kt)("li",{parentName:"ol"},"\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"li"},"onDone")," \u8fd4\u56de\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"li"},"Promise")," \u5bf9\u8c61\u7684\u8bdd\uff0c\u90a3\u4e48\u4f1a\u6539\u53d8 ",(0,a.kt)("inlineCode",{parentName:"li"},"finally")," \u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"Promise")," \u7684\u72b6\u6001")),(0,a.kt)("p",null,"\u5904\u4e8e\u4e0a\u8ff0\u8003\u8651\uff0c\u6211\u4eec\u4f7f\u7528\u4e0b\u9762\u7684\u5b9e\u73b0\u65b9\u5f0f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"finally(onDone) {\n  if (typeof onDone !== 'function') {\n    return this.then();\n  }\n  // \u65e0\u8bba\u6210\u529f\u4e0e\u5426\uff0conDone() \u90fd\u4f1a\u6267\u884c\uff0c\u4e14\u4e0d\u9700\u8981\u53c2\u6570\n  // \u53e6\u5916\u6267\u884c finally \u4e0d\u4f1a\u5f71\u54cd\u4e4b\u524d\u7684 Promise \u72b6\u6001\n  return this.then(\n    value => Promise.resolve(onDone()).then(() => value),\n    error => Promise.resolve(onDone()).then(() => {throw error})\n  );\n}\n")),(0,a.kt)("h3",{id:"\u9759\u6001\u65b9\u6cd5-1"},"\u9759\u6001\u65b9\u6cd5"),(0,a.kt)("p",null,"\u6700\u540e\u6765\u5b9e\u73b0 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u7684\u9759\u6001\u65b9\u6cd5\uff0c\u9996\u5148\u5b9e\u73b0 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\uff0c\u5bf9\u4e8e\u8be5\u65b9\u6cd5\u7684\u4f7f\u7528\u6211\u4eec\u5728\u7528\u6cd5\u90a3\u91cc\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u8d34\u51fa\u5b9e\u73b0\u7684\u4ee3\u7801"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"static resolve(value) {\n  // \u5982\u679c\u4f20\u5165\u7684\u662f Promise \u5bf9\u8c61\uff0c\u76f4\u63a5\u8fd4\u56de\n  if (value instanceof Promise) {\n    return value;\n  }\n\n  // \u5982\u679c\u4f20\u5165\u7684\u662f thenable \u5bf9\u8c61\uff0c\u5219\u7acb\u5373\u6267\u884c\u5bf9\u8c61\u7684 then\uff0c\u5e76\u5c06 resolve \u548c reject \u4f20\u5165\n  if (value && typeof value === 'object' && typeof value.then === 'function') {\n    return new Promise((resolve, reject) => value.then(resolve, reject));\n  }\n\n  if (value) {\n    // \u5982\u679c\u4e0d\u662f\u4e0a\u9762\u4e24\u79cd\u60c5\u51b5\uff0c\u5e76\u4e14 value \u5b58\u5728\uff0c\u90a3\u4e48\u76f4\u63a5\u5c06 value \u4f20\u5165 resolve\n    return new Promise(resolve => resolve(value));\n  } else {\n    return new Promise(resolve => resolve());\n  }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"all")," \u65b9\u6cd5\u5728\u4e0a\u9762\u4e5f\u4ecb\u7ecd\u8fc7\u4e86\uff0c\u53ea\u6709\u5f53\u6240\u6709\u4f20\u5165\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u90fd\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\uff0c\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u624d\u4f1a\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u53d8\u91cf\u6765\u7edf\u8ba1\u5df2\u7ecf\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u7684\u4e2a\u6570\uff0c\u5f53\u6240\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u90fd\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u65f6\uff0c\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\uff0c\u5c06\u8fd4\u56de\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\uff0c\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"static all(promises) {\n  return new Promise((resolve, reject) => {\n    // Promise \u5bf9\u8c61\u7684\u4e2a\u6570\n    let itemLength = promises.length;\n    // \u7edf\u8ba1\u5df2\u53d8\u4e3a fulfilled \u72b6\u6001\u7684 Promise \u5bf9\u8c61\u4e2a\u6570\n    let finishedPromise = 0;\n    // \u8fd4\u56de\u7684\u6570\u7ec4\n    let results = Array.from({length: itemLength});\n\n    promises.forEach(promise => {\n      promise.then(result => {\n        results[finishedPromise] = result;\n        finishedPromise++;\n        // \u5f53\u6240\u6709\u7684 Promise \u5bf9\u8c61\u53d8\u4e3a fulfilled \u65f6\uff0c\u8fd4\u56de\u7684 Promise \u5bf9\u8c61\u72b6\u6001\u53d8\u4e3a fulfilled\n        if (finishedPromise == itemLength) {\n          resolve(results);\n        }\n      }, error => {\n        // \u53ea\u8981\u6709\u4e00\u4e2a\u53d8\u4e3a rejected\uff0c\u90a3\u4e48\u76f4\u63a5\u53d8\u4e3a rejected \u72b6\u6001\n        reject(error);\n      })\n    })\n  })\n}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"race")," \u65b9\u6cd5\u7684\u7528\u6cd5\u4e5f\u4ecb\u7ecd\u8fc7\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u5229\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\u7684\u7279\u6027\uff0c\u6211\u4eec\u5f88\u5feb\u53ef\u4ee5\u5199\u51fa\u8fd9\u6837\u7684\u4ee3\u7801"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"static race(promises) {\n  return new Promise((resolve, reject) => {\n    promises.forEach(promise => {\n      promise.then(result => {\n        resolve(result);\n      }, error => {\n        reject(error);\n      })\n    })\n  })\n}\n")),(0,a.kt)("p",null,"\u7531\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u53ea\u4f1a\u6267\u884c\u4e00\u6b21\uff0c\u53ea\u6709\u6700\u5148\u53d8\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"fulfilled")," \u72b6\u6001\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise")," \u5bf9\u8c61\u80fd\u5c06\u5b83 ",(0,a.kt)("inlineCode",{parentName:"p"},"resolve")," \u7684\u503c\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"\u5b8c\u6574\u4ee3\u7801"},"\u5b8c\u6574\u4ee3\u7801"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'class Promise {\n  PENDING = "pending";\n  FULFILLED = "fulfilled";\n  REJECTED = "rejected";\n\n  state = this.PENDING;\n  value = null;\n\n  constructor(fn) {\n    fn(this._resolve.bind(this), this._reject.bind(this));\n  }\n\n  callbacks = [];\n\n  _resolve(value) {\n    if (this.state !== this.PENDING) {\n      return;\n    }\n\n    if (value instanceof Promise) {\n      value.then(this._resolve.bind(this), this._reject.bind(this));\n      return;\n    }\n\n    this.value = value;\n    this.state = this.FULFILLED;\n    this.callbacks.forEach((callback) => this._handle(callback));\n  }\n\n  _reject(error) {\n    if (!this.PENDING) {\n      return;\n    }\n    this.value = error;\n    this.state = this.REJECTED;\n    this.callbacks.forEach((callback) => this._handle(callback));\n  }\n\n  then(onFulfilled, onRejected) {\n    return new Promise((resolve, reject) => {\n      this._handle({\n        onFulfilled,\n        onRejected,\n        resolve,\n        reject,\n      });\n    });\n  }\n\n  catch(onRejected) {\n    return this.then(null, onRejected);\n  }\n\n  finally(onDone) {\n    if (typeof onDone !== "function") {\n      return this.then();\n    }\n\n    return this.then(\n      (value) => Promise.resolve(onDone()).then(() => value),\n      (error) =>\n        Promise.resolve(onDone()).then(() => {\n          throw error;\n        })\n    );\n  }\n\n  _handle(callback) {\n    if (this.state === this.PENDING) {\n      this.callbacks.push(callback);\n    }\n\n    if (this.state === this.FULFILLED) {\n      if (!callback.onFulfilled) {\n        callback.resolve(this.value);\n        return;\n      }\n\n      try {\n        let ret = callback.onFulfilled(this.value);\n        callback.resolve(ret);\n      } catch (e) {\n        callback.reject(e);\n      }\n    }\n\n    if (this.state === this.REJECTED) {\n      if (!callback.onRejected) {\n        callback.reject(this.value);\n        return;\n      }\n      let ret = callback.onRejected(this.value);\n      callback.reject(ret);\n    }\n  }\n\n  static resolve(value) {\n    if (value instanceof Promise) {\n      return value;\n    }\n\n    if (\n      value &&\n      typeof value === "object" &&\n      typeof value.then === "function"\n    ) {\n      return new Promise((resolve, reject) => value.then(resolve, reject));\n    }\n\n    if (value) {\n      return new Promise((resolve) => resolve(value));\n    } else {\n      return new Promise((resolve) => resolve());\n    }\n  }\n\n  static all(promises) {\n    return new Promise((resolve, reject) => {\n      let itemLength = promises.length;\n      let finishedPromise = 0;\n      let results = Array.from({ length: itemLength });\n\n      promises.forEach((promise) => {\n        promise.then(\n          (result) => {\n            results[finishedPromise] = result;\n            finishedPromise++;\n            if (finishedPromise == itemLength) {\n              resolve(results);\n            }\n          },\n          (error) => {\n            reject(error);\n          }\n        );\n      });\n    });\n  }\n\n  static race(promises) {\n    return new Promise((resolve, reject) => {\n      promises.forEach((promise) => {\n        promise.then(\n          (result) => {\n            resolve(result);\n          },\n          (error) => {\n            reject(error);\n          }\n        );\n      });\n    });\n  }\n}\n')),(0,a.kt)("h2",{id:"\u53c2\u8003\u6587\u7ae0"},"\u53c2\u8003\u6587\u7ae0"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s?__biz=MzA5NTcxOTcyMg==&mid=2247486601&idx=1&sn=54429420b0c07d518cec0f25a335c41e&chksm=90ba54cca7cddddae70a7ed7c000f0b1bc0d7c2d1c3b24f57775dc5822fc86fd9ba0c5f3ed70&scene=126&sessionid=1592905857&key=82c238abbe3b82baf9881311d259c9d04b6825a9ccae7b2a4719b98d46065f568a0db4178266ff98feff0214486915cb1af9165162e328decbc0810fb56726ef47afce6aab7d437b05ee4b92e1e2edac&ascene=1&uin=MTc3NjQ2ODM3NQ%3D%3D&devicetype=Windows+10+x64&version=6209007b&lang=zh_CN&exportkey=AXzB1RasL6jiqp0WQ45qnf4%3D&pass_ticket=x774fARNYVyp1e9yDUlfRb7wSl0izcpF0j6DFaHf0fkEHDL6jv0ElWc1SzaZ6%2B%2B1"},"\u56fe\u89e3 Promise \u5b9e\u73b0\u539f\u7406\uff08\u4e00\uff09\uff1a\u5148\u5199\u4e00\u4e2a\u57fa\u7840\u7684 Promise")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s?__biz=MzA5NTcxOTcyMg==&mid=2247486680&idx=1&sn=94ad054b685f05fbb6e37059399c9cef&chksm=90ba549da7cddd8b5c802100f0d4752587c2781797d69bf33b7f3da241b754a0c28b4250b947&scene=126&sessionid=1592905847&key=e82ba7b3cce71606954236c4df9ca857aa88e193ff96f051fc026f71c1b1ca29273ee7acb983db16e8bbaf66b5fca09e484347169ba81d069693c0bd0e0575c68bdbe3d58d3f3215e65fbb45d745e79b&ascene=1&uin=MTc3NjQ2ODM3NQ%3D%3D&devicetype=Windows+10+x64&version=6209007b&lang=zh_CN&exportkey=Af0QDGTKJ0ZZ3MXT%2BURTN9M%3D&pass_ticket=x774fARNYVyp1e9yDUlfRb7wSl0izcpF0j6DFaHf0fkEHDL6jv0ElWc1SzaZ6%2B%2B1"},"\u56fe\u89e3 Promise \u5b9e\u73b0\u539f\u7406\uff08\u4e8c\uff09\uff1a Promise \u94fe\u5f0f\u8c03\u7528")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s?__biz=MzA5NTcxOTcyMg==&mid=2247486762&idx=1&sn=278db1c95220579a8c1a2125a65d627a&chksm=90ba556fa7cddc7902cd186b057a989d0ca1a1357ba101feb9f871985385909e104aaafd4bda&scene=126&sessionid=1592905847&key=f6dee7b9ef4ba659a75dc0797593ee3ed7a2ec7d08fcb00f6cc346c81f86fc7a61cf5067c66192cee324e7aa9577fb5657def17927abdf0ce25d2e702f369d6a2ee3a3ac2bd2e3ae501aea18372ad528&ascene=1&uin=MTc3NjQ2ODM3NQ%3D%3D&devicetype=Windows+10+x64&version=6209007b&lang=zh_CN&exportkey=AY0%2FcOOAjibVmsT%2B%2B1tYPmI%3D&pass_ticket=x774fARNYVyp1e9yDUlfRb7wSl0izcpF0j6DFaHf0fkEHDL6jv0ElWc1SzaZ6%2B%2B1"},"\u56fe\u89e3 Promise \u5b9e\u73b0\u539f\u7406\uff08\u4e09\uff09\uff1aPromise \u539f\u578b\u65b9\u6cd5\u5b9e\u73b0")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s?__biz=MzA5NTcxOTcyMg==&mid=2247486839&idx=1&sn=5e9d85a70e9f85c94250a8c1c86772ca&chksm=90ba5532a7cddc24535cfc80fe892ffa34ff3a9638fbc1e9810ebab3c35784402968f9a65d44&scene=126&sessionid=1593161282&key=e82ba7b3cce71606a4cce70ca930ac7d6b61a05729ee3144ff9c5ccd0f54be407ea3ba04542163e11032e315e329bcf1536ceaf16ef408d759adda51f9d1ed57c083e30ba375fa10862d7e6705e0942d&ascene=1&uin=MTc3NjQ2ODM3NQ%3D%3D&devicetype=Windows+10+x64&version=6209007b&lang=zh_CN&exportkey=AWZmv5R1eG3cSK0W44%2F8fyM%3D&pass_ticket=uTkleeK9zg7mTbWWYlCzmyU6cReKuc7iYYllvVI7AfOrz4Zh0w9gvqjsFpKY5qNq"},"\u56fe\u89e3 Promise \u5b9e\u73b0\u539f\u7406\uff08\u56db\uff09\uff1aPromise \u9759\u6001\u65b9\u6cd5\u5b9e\u73b0")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://juejin.im/post/5d3f0a38f265da03bb4a81ff"},"Promise.all \u548c Promise.race \u6e90\u7801\u5b9e\u73b0"))))}m.isMDXComponent=!0}}]);