"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1477],{10:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"mobile-text-middle","metadata":{"permalink":"/blog/mobile-text-middle","editUrl":"https://github.com/LastKnightCoder/lastknightcoder/tree/master/blog/2022-10-17-\u79fb\u52a8\u7aef\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u65b9\u6848.mdx","source":"@site/blog/2022-10-17-\u79fb\u52a8\u7aef\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u65b9\u6848.mdx","title":"\u79fb\u52a8\u7aef\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u65b9\u6848","description":"\u6709\u8fc7\u79fb\u52a8\u7aef\u5f00\u53d1\u7ecf\u9a8c\u7684\u4eba\uff0c\u60f3\u5fc5\u90fd\u5bf9\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u5934\u75db\u4e0d\u5df2\uff0c\u56e0\u4e3a\u4f7f\u7528\u5e38\u89c4\u624b\u6bb5\u5b9e\u73b0\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u5728\u90e8\u5206 Android \u624b\u673a\u4e0a\u4f1a\u51fa\u73b0\u6587\u5b57\u504f\u4e0a\u7684\u60c5\u51b5\uff0c\u5f80\u5f80\u9700\u8981\u914d\u5408 line-height \u6216\u8005 padding \u8fdb\u884c\u5fae\u8c03\uff0c\u82e6\u4e0d\u582a\u8a00\u3002\u4e0b\u9762\u662f\u6211\u5c1d\u8bd5\u7684\u51e0\u79cd\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u65b9\u6848\uff1a","date":"2022-10-17T00:00:00.000Z","formattedDate":"2022\u5e7410\u670817\u65e5","tags":[{"label":"SVG","permalink":"/blog/tags/svg"},{"label":"Canvas","permalink":"/blog/tags/canvas"},{"label":"\u6587\u5b57\u5782\u76f4\u5c45\u4e2d","permalink":"/blog/tags/\u6587\u5b57\u5782\u76f4\u5c45\u4e2d"}],"readingTime":14.08,"hasTruncateMarker":false,"authors":[{"name":"\u718a\u6ed4","title":"\u524d\u7aef\u5de5\u7a0b\u5e08 @ \u963f\u91cc\u5df4\u5df4","url":"https://github.com/LastKnightCoder","imageURL":"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/wallhaven-8opwwy.3cbn7rc981c0.webp","key":"xiongtao"}],"frontMatter":{"slug":"mobile-text-middle","tags":["SVG","Canvas","\u6587\u5b57\u5782\u76f4\u5c45\u4e2d"],"authors":"xiongtao"},"nextItem":{"title":"IntersectionObserver","permalink":"/blog/IntersectionObserver"}},"content":"import Tabs from \'@theme/Tabs\';\\nimport TabItem from \'@theme/TabItem\';\\n\\n\u6709\u8fc7\u79fb\u52a8\u7aef\u5f00\u53d1\u7ecf\u9a8c\u7684\u4eba\uff0c\u60f3\u5fc5\u90fd\u5bf9\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u5934\u75db\u4e0d\u5df2\uff0c\u56e0\u4e3a\u4f7f\u7528\u5e38\u89c4\u624b\u6bb5\u5b9e\u73b0\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u5728\u90e8\u5206 Android \u624b\u673a\u4e0a\u4f1a\u51fa\u73b0\u6587\u5b57\u504f\u4e0a\u7684\u60c5\u51b5\uff0c\u5f80\u5f80\u9700\u8981\u914d\u5408 `line-height` \u6216\u8005 `padding` \u8fdb\u884c\u5fae\u8c03\uff0c\u82e6\u4e0d\u582a\u8a00\u3002\u4e0b\u9762\u662f\u6211\u5c1d\u8bd5\u7684\u51e0\u79cd\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u65b9\u6848\uff1a\\n\\n`line-height` \u5b9e\u73b0\u5782\u76f4\u5c45\u4e2d:\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\'>\\n\\n```html\\n<div id=\\"line-height\\">\u67e5\u770b\u66f4\u591a</div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\' default>\\n\\n```css\\n#line-height {\\n  width: 200px;\\n  text-align: center;\\n  \\n  height: 56px;\\n  line-height: 56px;\\n  \\n  font-size: 26px;\\n  color: black;  \\n  \\n  border: 1px solid;\\n  border-radius: 28px;\\n}\\n```  \\n\\n</TabItem>\\n</Tabs>\\n\\n\\n`display: flex` \u5b9e\u73b0\u5782\u76f4\u5c45\u4e2d\uff1a\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\'>\\n\\n```html\\n<div id=\\"flex\\">\u67e5\u770b\u66f4\u591a</div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\' default>\\n\\n```css\\n#flex {\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  width: 200px;\\n  height: 56px;\\n  font-size: 26px;\\n  color: black;\\n  border: 1px solid;\\n  border-radius: 28px;\\n}\\n```\\n\\n</TabItem>\\n</Tabs>\\n\\n`padding` \u5b9e\u73b0\u5782\u76f4\u5c45\u4e2d\uff1a\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\'>\\n\\n```html\\n<div id=\\"padding\\">\u67e5\u770b\u66f4\u591a</div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\' default>\\n\\n```css\\n#padding {\\n  width: 200px;\\n  text-align: center;\\n  box-sizing: border-box;\\n  height: 56px;\\n  font-size: 26px;\\n  line-height: 1;\\n  padding: 15px 0;\\n  color: black;\\n  border: 1px solid;\\n  border-radius: 28px;\\n}\\n```\\n\\n</TabItem>\\n</Tabs>\\n\\nCanvas \u5b9e\u73b0\u5782\u76f4\u5c45\u4e2d\uff1a \\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\'>\\n\\n```html\\n<div id=\\"canvas-container\\">\\n  <canvas id=\\"canvas\\" width=\\"200\\" height=\\"56\\"></canvas>\\n</div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\'>\\n\\n```css\\n#canvas-container {\\n  width: 200px;\\n  height: 56px;\\n  color: black;\\n  border: 1px solid;\\n  border-radius: 28px;\\n}\\n#canvas {\\n  width: 200px;\\n  height: 56px;\\n}\\n```\\n\\n</TabItem>\\n<TabItem value=\'js\' label=\'JavaScript\' default>\\n\\n```js\\nconst canvas = document.querySelector(\'#canvas\');\\nconst ctx = canvas.getContext(\'2d\');\\n\\n// \u89e3\u51b3\u9ad8\u6e05\u5c4f\u6a21\u7cca\u7684\u95ee\u9898\\nconst computedStyle = window.getComputedStyle(canvas);\\nconst dpr = window.devicePixelRatio;\\ncanvas.width = parseFloat(computedStyle.width) * dpr;\\ncanvas.height = parseFloat(computedStyle.height) * dpr;\\nctx.scale(dpr, dpr);\\n\\nconst text = \'\u67e5\u770b\u66f4\u591a\';\\nconst fontSize = 26;\\nctx.font = `${fontSize}px normal`;\\nconst textWidth = ctx.measureText(text).width;\\nctx.textBaseline = \'bottom\'\\n// \u8fd9\u91cc\u7684 1.15 \u662f\u56e0\u4e3a\u5e95\u7ebf\u5176\u5b9e\u662f\u8d85\u51fa\u4e86\u884c\u6846\u76d2\u5b50\u7684\uff0c\u8d85\u51fa\u5b57\u4f53\u5927\u5c0f\u7684 5%-10%\uff0c\u89c1\u9644\u5f55\\nctx.fillText(text, (canvas.width / dpr - textWidth) / 2, (canvas.height / dpr + 1.15 * fontSize) / 2);\\n```\\n\\n</TabItem>\\n</Tabs>\\n\\nSVG \u5b9e\u73b0\u5782\u76f4\u5c45\u4e2d\uff1a\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\' default>\\n\\n```html\\n<div id=\\"svg-container\\">\\n  <svg width=\\"200\\" height=\\"56\\" viewBox=\\"0 0 200 56\\">\\n    <text\\n      text-anchor=\\"middle\\"\\n      fill=\\"currentColor\\"\\n      x=\\"100\\"\\n      dominant-baseline=\\"central\\"\\n      y=\\"28\\"\\n      font-size=\\"26\\"\\n    >\\n      \u67e5\u770b\u66f4\u591a\\n    </text>\\n  </svg>\\n</div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\'>\\n\\n```css\\n#svg-container {\\n  width: 200px;\\n  height: 56px;\\n  color: black;\\n  border: 1px solid;\\n  border-radius: 28px;\\n}\\n```\\n\\n</TabItem>\\n</Tabs>\\n\\n\u901a\u8fc7\u5728\u4e0d\u540c\u673a\u578b\u4e0a\u7684\u5bf9\u6bd4\uff0c\u53d1\u73b0 Canvas \u548c SVG \u7684\u65b9\u6848\u5728\u5404\u4e2a\u673a\u578b\u4e0b\u9762\u5747\u4fdd\u6301\u4e00\u81f4\u7684\u5c45\u4e2d\u6548\u679c\uff0c\u56e0\u6b64\u51b3\u5b9a\u5c06\u5176\u62bd\u79bb\u4e3a\u4e00\u4e2a React \u7ec4\u4ef6\uff0c\u4e0b\u9762\u5c31\u8be6\u7ec6\u8bb2\u89e3\u8be5\u7ec4\u4ef6\u7684\u5f00\u53d1\u601d\u8def\u3002\\n\\n\u672c\u6587\u4ee5 SVG \u4e3a\u4f8b\uff0cCanvas \u5f00\u53d1\u601d\u8def\u662f\u4e00\u6837\u7684\uff0c\u5728\u6587\u7ae0\u7684\u6700\u540e\u7ed9\u51fa Canvas \u7684\u5b9e\u73b0\uff0c\u4f9b\u4ee5\u53c2\u8003\u3002\\n\\n## \u4f7f\u7528\u65b9\u6cd5\\n\\n\u4e3a\u5b9e\u73b0\u5782\u76f4\u5c45\u4e2d\u529f\u80fd\uff0c\u7ec4\u4ef6\u9700\u8981\u56db\u4e2a\u53c2\u6570\\n\\n- `height`\uff1a\u5bb9\u5668\u9ad8\u5ea6\uff0c\u5355\u4f4d\u4e3a `px`\\n- `fontSize`\uff1a\u5b57\u4f53\u5927\u5c0f\uff0c\u5355\u4f4d\u4e3a `px`\\n- `text`\uff1a\u6587\u5b57\u5185\u5bb9\\n- `color`\uff1a\u6587\u5b57\u989c\u8272\\n\\n\u8fd9\u56db\u4e2a\u53c2\u6570\u662f\u5fc5\u987b\u4f20\u9012\u7684\uff0c\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a\\n\\n```jsx\\n// \u4f7f\u7528\u65b9\u5f0f\u4e00\\n<TextMiddle fontSize={28} height={60} color={\'deepskyblue\'} text={\'\u67e5\u770b\u66f4\u591a\'} />\\n```\\n\\n\u9664\u4e86\u4e0a\u9762\u56db\u4e2a\u5c5e\u6027\uff0c\u8fd8\u652f\u6301\u4f20\u9012 `className` \u4e0e `style`\u3002\\n\\n## SVG \u5782\u76f4\u5c45\u4e2d\u539f\u7406\\n\\n\u5728 SVG \u4e2d\u901a\u8fc7 `text` \u6807\u7b7e\u6765\u663e\u793a\u6587\u5b57\uff0c\u53ef\u4ee5\u901a\u8fc7 `x` \u548c `y` \u5c5e\u6027\u6765\u8bbe\u7f6e\u6587\u5b57\u7684\u4f4d\u7f6e\uff0c\u8fd9\u91cc\u6211\u4eec\u5173\u6ce8\u5230 `y`\uff0c\u5b83\u8bbe\u7f6e\u7684\u662f\u6587\u5b57\u57fa\u7ebf\u5728 SVG \u753b\u5e03\u4e2d\u7684\u4f4d\u7f6e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7  `dominant-baseline` \u6765\u6307\u5b9a\u57fa\u7ebf\u5728\u6587\u5b57\u7684\u54ea\u4e2a\u4f4d\u7f6e\uff0c\u6211\u4eec\u5c06\u5176\u8bbe\u7f6e\u4e3a `central`\uff0c\u8868\u793a\u57fa\u7ebf\u5728\u6587\u5b57\u7684\u4e2d\u95f4\uff0c\u7136\u540e\u5c06 `y` \u8bbe\u7f6e\u4e3a\u9ad8\u5ea6\u7684\u4e00\u534a\uff0c\u5373\u53ef\u5b9e\u73b0\u6587\u5b57\u7684\u5782\u76f4\u5c45\u4e2d\u3002\\n\\n```html\\n<svg width=\\"200\\" height=\\"60\\" viewBox=\\"0 0 200 60\\">\\n  <text\\n    font-size=\\"26\\"\\n    fill=\\"currentColor\\"\\n    dominant-baseline=\\"central\\" y=\\"30\\">\\n    \u67e5\u770b\u66f4\u591a\\n  </text>\\n</svg>\\n```\\n\\n\\n\\n:::note\\n\\n\u4e0a\u9762\u4f7f\u7528\u7684\u5355\u4f4d\u5747\u4e3a `px`\u3002\\n\\n::: \\n\\n\u6839\u636e\u4e0a\u9762\u7684\u539f\u7406\uff0c\u53ef\u4ee5\u5199\u51fa\u7b2c\u4e00\u7248\u7684 `TextMiddle` \u5b9e\u73b0\\n\\n```jsx\\nimport React, { useEffect, useRef } from \\"react\\";\\n\\nconst TextMiddle = props => {\\n  const { height, fontSize, color, text, className = \'\', style = {} } = props;\\n  const container = useRef();\\n\\n  const actualStyle = {\\n    ...style,\\n    height: `${height / 100}rem`,\\n    fontSize: `${fontSize / 100}rem`,\\n    color\\n  };\\n\\n  useEffect(() => {\\n    const computedStyle = window.getComputedStyle(container.current);\\n    const actualHeight = parseFloat(computedStyle.height);\\n    const actualFontSize = parseFloat(computedStyle.fontSize);\\n    const actualWidth = parseFloat(computedStyle.width);\\n\\n    const svg = `\\n      <svg width=\\"${actualWidth}\\" height=\\"${actualHeight}\\" viewBox=\\"0 0 ${actualWidth} ${actualHeight}\\">\\n        <text\\n          font-size=\\"${actualFontSize}\\"\\n          fill=\\"currentColor\\"\\n          dominant-baseline=\\"central\\" y=\\"${actualHeight / 2}\\"\\n        >\\n          ${text}\\n        </text>\\n      </svg>\\n    `;\\n    container.current.innerHTML = svg;\\n  }, [text]);\\n\\n  return (\\n    <div ref={container} className={className} style={actualStyle}>\\n      {text}\\n    </div>\\n  )\\n}\\n\\nexport default TextMiddle;\\n```\\n\\n## \u6587\u5b57\u8d85\u51fa\\n\\n\u4e8b\u60c5\u5230\u8fd9\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u6211\u4eec\u4f7f\u7528 `SVG` \u8fd9\u79cd\u65b9\u6848\u662f\u6709\u7f3a\u70b9\u7684\uff0c\u90a3\u5c31\u662f\u7f3a\u5931\u4e86\u6d41\u52a8\u6027\uff0c\u6587\u5b57\u53ea\u80fd\u4e00\u884c\u5c55\u793a\uff0c\u4e0d\u4f1a\u6362\u884c\uff0c\u591a\u4f59\u7684\u6587\u5b57\u4f1a\u88ab\u9690\u85cf\u4e0d\u53ef\u89c1\u3002\\n\\n\u8003\u8651\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4e00\u822c\u90fd\u662f\u5355\u884c\u6587\u672c\u5b9e\u73b0\u5782\u76f4\u5c45\u4e2d\uff0c\u6240\u4ee5\u5c31\u4e0d\u5bf9\u6362\u884c\u8fdb\u884c\u5904\u7406\uff0c\u4f46\u662f\u6587\u5b57\u8d85\u51fa\u8fd8\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\uff0c\u6240\u4ee5\u6709\u5fc5\u8981\u5bf9\u6587\u5b57\u8d85\u51fa\u8fdb\u884c\u8fdb\u884c\u5904\u7406\uff0c\u8fd9\u91cc\u5bf9\u8d85\u51fa\u7684\u6587\u5b57\u4f7f\u7528 `...` \u4ee3\u66ff\u3002\\n\\n\u600e\u4e48\u5224\u65ad\u6587\u5b57\u662f\u5426\u8d85\u51fa\u4e86\u5462\uff1f\u6211\u4eec\u9700\u8981\u77e5\u9053\u6587\u5b57\u7684\u957f\u5ea6\uff0c\u5982\u679c\u6587\u5b57\u7684\u957f\u5ea6\u5927\u4e8e\u5bb9\u5668\u7684\u957f\u5ea6\uff0c\u5c31\u8bf4\u660e\u8d85\u51fa\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u9700\u8981\u8fdb\u884c\u6253\u70b9\u3002\u53ef\u4ee5\u901a\u8fc7 `Canvas` \u7684 `measureText` \u6765\u83b7\u5f97\u6587\u672c\u7684\u5bbd\u5ea6\\n\\n```js\\nconst canvas = document.createElement(\'canvas\');\\nconst ctx = canvas.getContext(\'2d\');\\nconst getTextLength = (text, fontSize) => {\\n  ctx.font= `${fontSize}px normal`;\\n  const metrics = ctx.measureText(text);\\n  return parseInt(\'\' + metrics.width);\\n}\\n```\\n\\n\u8fd9\u91cc\u5bf9\u6587\u5b57\u7684\u957f\u5ea6\u8fdb\u884c\u4e86\u53d6\u6574\uff0c\u8fd9\u662f\u56e0\u4e3a\u5728\u5c0f\u6570\u90e8\u5206\u5b58\u5728\u8bef\u5dee\uff0c\u56e0\u6b64\u6211\u4eec\u4e5f\u9700\u8981\u5bf9\u5bb9\u5668\u7684\u957f\u5ea6\u8fdb\u884c\u53d6\u6574\uff0c\u7531\u4e8e\u53d6\u6574\u4e4b\u540e\uff0c\u53ef\u80fd\u5b58\u5728 `1px` \u7684\u8bef\u5dee\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u5bb9\u5668\u7684\u5bbd\u5ea6\u4e3a\u53d6\u6574\u540e `+1`\\n\\n```js\\nconst actualWidth = parseInt(computedStyle.width) + 1;\\nconst textLength = getTextLength(text, actualFontSize);\\nif (textLength > actualWidth) {\\n\\t// \u6587\u5b57\u8d85\u51fa\u5904\u7406\\n}\\n```\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u8d85\u51fa\u7684\u6587\u5b57\u5206\u754c\u70b9\uff0c\u7136\u540e\u8fdb\u884c\u622a\u65ad\\n\\n```js\\nconst actualWidth = parseInt(computedStyle.width) + 1;\\nconst textLength = getTextLength(text, actualFontSize);\\nlet actualText = text;\\n// \u8ba1\u7b97\u622a\u65ad\u70b9\u4ee5\u53ca\u5b9e\u9645\u6587\u672c\\nif (textLength > actualWidth) {\\n  actualText = text.slice(0, 1) + \'...\';\\n  for (let i = 1; i < text.length; i++) {\\n    const adjustText = text.slice(0, i) + \'...\';\\n    const adjustWidth = getTextLength(adjustText, actualFontSize);\\n    if (adjustWidth > actualWidth) {\\n      break;\\n    }\\n    actualText = adjustText;\\n  }\\n}\\nconst svg = `\\n  <svg width=\\"${actualWidth}\\" height=\\"${actualHeight}\\" viewBox=\\"0 0 ${actualWidth} ${actualHeight}\\">\\n    <text\\n      font-size=\\"${actualFontSize}\\"\\n      fill=\\"currentColor\\"\\n      dominant-baseline=\\"central\\" y=\\"${actualHeight / 2}\\"\\n    >\\n      ${actualText}\\n    </text>\\n  </svg>\\n`;\\ncontainer.current.innerHTML = svg;\\n```\\n\\n## \u6027\u80fd\u4f18\u5316\\n\\n\u5f53\u9875\u9762\u4e0a\u6709\u592a\u591a\u7684 SVG \u8981\u6e32\u67d3\u65f6\uff0c\u4f1a\u6709\u8f83\u5927\u7684\u767d\u5c4f\u65f6\u95f4\uff0c\u7ecf\u6d4b\u8bd5\uff0c\u540c\u65f6\u6709 1000 \u4e2a SVG \u6e32\u67d3\uff0c\u5c06\u4f1a\u6709\u63a5\u8fd1 1s \u7684\u767d\u5c4f\u65f6\u95f4\uff0c\u8fd9\u4e2a\u662f\u4e0d\u53ef\u63a5\u53d7\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `IntersectionObserver` \u6765\u8fdb\u884c\u4e00\u4e2a\u6027\u80fd\u4f18\u5316\uff0c\u53ea\u6709\u5f53\u8be5\u7ec4\u4ef6\u5373\u5c06\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u65f6\uff0c\u6211\u4eec\u624d\u6e32\u67d3\u4e3a SVG\u3002\\n\\n```js\\nconst svg = `\\n  <svg width=\\"${actualWidth}\\" height=\\"${actualHeight}\\" viewBox=\\"0 0 ${actualWidth} ${actualHeight}\\">\\n    <text\\n      font-size=\\"${actualFontSize}\\"\\n      fill=\\"currentColor\\"\\n      dominant-baseline=\\"central\\" y=\\"${actualHeight / 2}\\"\\n    >\\n      ${actualText}\\n    </text>\\n  </svg>\\n`;\\nconst observer = new IntersectionObserver(entries => {\\n  entries.forEach(entry => {\\n    // \u8fdb\u5165\u89c6\u53e3\u65f6\u6216\u5df2\u7ecf\u5728\u89c6\u53e3\u4e2d\\n    if (entry.isIntersecting) {\\n      container.current.innerHTML = svg;\\n      // \u53d6\u6d88\u76d1\u542c\\n      observer.unobserve(container.current);\\n    }\\n  })\\n}, {\\n  // \u89c6\u53e3\u8303\u56f4\u5411\u4e0b\u6269\u5927 500px\uff0c\u63d0\u524d\u52a0\u8f7d\\n  rootMargin: \'0px 0px 500px 0px\'\\n});\\nobserver.observe(container.current);\\n```\\n\\n\u53e6\u4e00\u4e2a\u5c31\u662f\u5bf9\u4e8e\u82f9\u679c\u624b\u673a\uff0c\u6211\u4eec\u6ca1\u6709\u5fc5\u8981\u4f7f\u7528 SVG \u7684\u65b9\u6848\uff0c\u56e0\u4e3a\u82f9\u679c\u624b\u673a\u7684\u517c\u5bb9\u6027\u5f88\u597d\uff0c\u5bf9\u4e8e\u82f9\u679c\u624b\u673a\u5c31\u4f7f\u7528\u8bbe\u7f6e\u884c\u9ad8\u7b49\u4e8e\u9ad8\u5ea6\u7684\u65b9\u6848\\n\\n```js\\nconst isIos = /ipad|iphone|macintosh/gim.test(window.navigator.userAgent);\\nconst actualStyle = {\\n  overflow: \'hidden\',\\n  whiteSpace: \'nowrap\',\\n  textOverflow: \'ellipsis\',\\n  ...style,\\n  height: `${height / 100}rem`,\\n  lineHeight: `${height / 100}rem`,\\n  fontSize: `${fontSize / 100}rem`,\\n  color\\n};\\n\\nuseEffect(() => {\\n\\tif (isIos) {\\n\\t  return;\\n\\t}\\n\\t// ... \u5176\u5b83\u903b\u8f91\\n}, []);\\n```\\n\\n:::warning\\n\u4e0d\u8981\u4e3a `TextMiddle` \u6dfb\u52a0 `display: flex;`\uff0c\u5426\u5219 `text-overflow` \u4f1a\u5931\u6548\uff0c\u9664\u975e\u4f60\u786e\u5b9a\u4f60\u7684\u6587\u672c\u4e00\u5b9a\u4e0d\u4f1a\u8d85\u51fa\u5bb9\u5668\u7684\u5bbd\u5ea6\u3002\\n:::\\n\\n## \u6700\u7ec8\u4ee3\u7801\\n\\n### SVG\\n\\n```jsx\\nimport React, { useEffect, useRef } from \\"react\\";\\n\\nconst canvas = document.createElement(\'canvas\');\\nconst ctx = canvas.getContext(\'2d\');\\nconst getTextLength = (text, fontSize) => {\\n  ctx.font= `${fontSize}px normal`;\\n  const metrics = ctx.measureText(text);\\n  return parseInt(\'\' + metrics.width);\\n}\\n\\nconst TextMiddle = props => {\\n  const { height, fontSize, color, text, className = \'\', style = {} } = props;\\n  const container = useRef();\\n  const isIos = /ipad|iphone|macintosh/gim.test(window.navigator.userAgent);\\n  const actualStyle = {\\n    overflow: \'hidden\',\\n    whiteSpace: \'nowrap\',\\n    textOverflow: \'ellipsis\',\\n    ...style,\\n    height: `${height / 100}rem`,\\n    lineHeight: `${height / 100}rem`,\\n    fontSize: `${fontSize / 100}rem`,\\n    color\\n  };\\n\\n  useEffect(() => {\\n    if (isIos) {\\n      return;\\n    }\\n    const computedStyle = window.getComputedStyle(container.current);\\n    const actualHeight = parseFloat(computedStyle.height);\\n    const actualFontSize = parseFloat(computedStyle.fontSize);\\n    const actualWidth = parseInt(computedStyle.width) + 1;\\n    const textLength = getTextLength(text, actualFontSize);\\n    let actualText = text;\\n    if (textLength > actualWidth) {\\n      actualText = text.slice(0, 1) + \'...\';\\n      for (let i = 1; i < text.length; i++) {\\n        const adjustText = text.slice(0, i) + \'...\';\\n        const adjustWidth = getTextLength(adjustText, actualFontSize);\\n        if (adjustWidth > actualWidth) {\\n          break;\\n        }\\n        actualText = adjustText;\\n      }\\n    }\\n\\n    const svg = `\\n      <svg width=\\"${actualWidth}\\" height=\\"${actualHeight}\\" viewBox=\\"0 0 ${actualWidth} ${actualHeight}\\">\\n        <text\\n          font-size=\\"${actualFontSize}\\"\\n          fill=\\"currentColor\\"\\n          dominant-baseline=\\"central\\" y=\\"${actualHeight / 2}\\"\\n        >\\n          ${actualText}\\n        </text>\\n      </svg>\\n    `;\\n    const observer = new IntersectionObserver(entries => {\\n      entries.forEach(entry => {\\n        // \u8fdb\u5165\u89c6\u53e3\u65f6\u6216\u5df2\u7ecf\u5728\u89c6\u53e3\u4e2d\\n        if (entry.isIntersecting) {\\n          container.current.innerHTML = svg;\\n          observer.unobserve(container.current);\\n        }\\n      })\\n    }, {\\n      // \u89c6\u53e3\u8303\u56f4\u5411\u4e0b\u6269\u5927 500px\uff0c\u63d0\u524d\u52a0\u8f7d\\n      rootMargin: \'0px 0px 500px 0px\'\\n    });\\n    observer.observe(container.current);\\n  }, [text]);\\n\\n  return (\\n    <div ref={container} className={className} style={actualStyle}>\\n      {text}\\n    </div>\\n  )\\n}\\n\\nexport default TextMiddle;\\n```\\n\\n### Canvas\\n\\n```jsx\\nimport React, { useEffect, useRef } from \\"react\\";\\n\\nconst isIos = /ipad|iphone|macintosh/gim.test(window.navigator.userAgent);\\n\\nconst canvas = document.createElement(\'canvas\');\\nconst ctx = canvas.getContext(\'2d\');\\nconst getTextLength = (text, fontSize) => {\\n  ctx.font= `${fontSize}px normal`;\\n  const metrics = ctx.measureText(text);\\n  return parseInt(\'\' + metrics.width);\\n}\\n\\nconst TextMiddle = props => {\\n  const { text, color, height, fontSize, className = \'\', style = {} } = props;\\n  const container = useRef();\\n\\n  const actualStyle = {\\n    overflow: \'hidden\',\\n    whiteSpace: \'nowrap\',\\n    textOverflow: \'ellipsis\',\\n    ...style,\\n    height: `${height / 100}rem`,\\n    lineHeight: `${height / 100}rem`,\\n    fontSize: `${fontSize / 100}rem`,\\n    color\\n  };\\n\\n  useEffect(() => {\\n    if (isIos) {\\n      return;\\n    }\\n\\n    const computedStyle = window.getComputedStyle(container.current);\\n    const actualHeight = parseFloat(computedStyle.height);\\n    const actualFontSize = parseFloat(computedStyle.fontSize);\\n    const actualWidth = parseInt(computedStyle.width) + 1;\\n    \\n    // \u9ad8\u5206\u5c4f\u6a21\u7cca\u5904\u7406\\n    const canvas = document.createElement(\'canvas\');\\n    const ctx = canvas.getContext(\'2d\');\\n    canvas.style.width = actualWidth + \'px\';\\n    canvas.style.height = actualHeight + \'px\';\\n    const dpr = window.devicePixelRatio;\\n    canvas.width = actualWidth * dpr;\\n    canvas.height = actualHeight * dpr;\\n    ctx.scale(dpr, dpr);\\n\\n    // \u6587\u5b57\u8d85\u51fa\u5904\u7406\\n    const textLength = getTextLength(text, actualFontSize);\\n    let actualText = text;\\n    if (textLength > actualWidth) {\\n      actualText = text.slice(0, 1) + \'...\';\\n      for (let i = 1; i < text.length; i++) {\\n        const adjustText = text.slice(0, i) + \'...\';\\n        const adjustWidth = getTextLength(adjustText, actualFontSize);\\n        if (adjustWidth > actualWidth) {\\n          break;\\n        }\\n        actualText = adjustText;\\n      }\\n    }\\n\\n    ctx.font = `${actualFontSize}px normal`;\\n    ctx.fillStyle = color;\\n    ctx.textBaseline = \'bottom\';\\n    // \u5e95\u7ebf\u5176\u5b9e\u662f\u8d85\u51fa\u884c\u6846\u76d2\u5b50\u7684\uff0c\u53c2\u8003\u5b57\u6bcd y g \u7684\u4e0b\u8fb9\u7f18\uff0c\u8d85\u51fa\u7684\u90e8\u5206\u662f\u5b57\u4f53\u5927\u5c0f\u7684 10%\\n    ctx.fillText(actualText, 0, (canvas.height / dpr + 1.15 * actualFontSize) / 2);\\n\\n    const observer = new IntersectionObserver(entries => {\\n      entries.forEach(entry => {\\n        if (entry.isIntersecting) {\\n          container.current.removeChild(container.current.firstChild);\\n          container.current.append(canvas);\\n          observer.unobserve(container.current);\\n        }\\n      });\\n    }, {\\n      rootMargin: \'0px 0px 500px 0px\'\\n    });\\n    observer.observe(container.current);\\n  }, [text, color]);\\n\\n  return (\\n    <div ref={container} className={className} style={actualStyle}>\\n      {text}\\n    </div>\\n  )\\n}\\n\\nexport default TextMiddle;\\n```\\n\\n\\n## \u9644\u5f55\\n\\n\u8fd9\u4e2a\u6765\u8865\u5145 `Canvas` \u7ed8\u5236\u6587\u5b57\u7684\u4e00\u4e2a\u7ec6\u8282\uff0c\u5728\u4ee3\u7801\u91cc\u9762\u6211\u4eec\u7ed8\u5236\u6587\u5b57\u7528\u4e86\u4e0b\u9762\u7684\u4ee3\u7801\\n\\n```js\\nctx.textBaseline = \'bottom\';\\nctx.fillText(actualText, 0, (canvas.height / dpr + 1.2 * actualFontSize) / 2);\\n```\\n\\n\u5173\u4e8e\u6587\u5b57\u7684\u4f4d\u7f6e\u8fd9\u91cc\u7ed9\u4e86 `canvas.height / dpr + 1.2 * actualFontSize) / 2`\uff0c\u6309\u9053\u7406\u5e94\u8be5\u7ed9 `canvas.height / dpr + actualFontSize) / 2`\uff0c\u6240\u4ee5\u6211\u4eec\u4e3a\u4ec0\u4e48\u8981\u4e58 `1.2`\u3002\\n\\n\u6211\u4eec\u5148\u770b\u4e0b\u8fd9\u4e2a\u516c\u5f0f\u662f\u600e\u4e48\u8ba1\u7b97\u7684\uff0c\u5047\u8bbe\u5bb9\u5668\u7684\u9ad8\u5ea6\u662f `h`\uff0c\u5b57\u4f53\u7684\u5927\u5c0f\u662f `s`\uff0c\u8981\u4f7f\u5f97\u5b57\u4f53\u5782\u76f4\u5c45\u4e2d\uff0c\u90a3\u4e48\u5b57\u4f53\u5e95\u90e8\u79bb\u9876\u90e8\u7684\u8ddd\u79bb\u5c31\u662f `(h - s) / 2 + s = (h + s) / 2`\u3002\u73b0\u5728\u6211\u4eec\u7684\u8ba1\u7b97\u516c\u5f0f\u662f `(h + 1.2 * s) / 2`\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\uff1f\\n\\n\u8fd9\u662f\u56e0\u4e3a\u5e95\u7ebf\u7684\u8ddd\u79bb\u5e76\u4e0d\u662f\u6587\u5b57\u6240\u5728\u76d2\u5b50\u7684\u5e95\u90e8\uff0c\u770b\u4e00\u4e2a\u4f8b\u5b50\\n\\n```html\\n<div id=\\"container\\">\u67e5\u770b\u66f4\u591ay</div>\\n```\\n\\n```css\\n#container {\\n  font-size: 100px;\\n  outline: 1px solid red;\\n  line-height: 1;\\n}\\n```\\n\\n<img src=\\"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/image.7f1js39a5200.webp\\" style={{ zoom: \'50%\' }} />\\n\\n\u53ef\u4ee5\u770b\u5230\u5e95\u7ebf\uff08\u4e5f\u5c31\u662f\u5b57\u6bcd `y` \u7684\u5e95\u90e8\uff09\u8d85\u51fa\u4e86\u884c\u6846\u76d2\u5b50\uff0c\u6240\u4ee5\u5c06\u5e95\u7ebf\u8bbe\u7f6e\u5230 `(h + s) / 2`\uff0c\u4f1a\u4f7f\u5f97\u6587\u5b57\u504f\u4e0a\u3002\u8981\u4f7f\u5f97\u6587\u5b57\u6b63\u5e38\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u8d85\u51fa\u4e86\u591a\u5c11\uff0c\u8fd9\u4e2a\u5927\u5c0f\u4e0e\u5b57\u4f53\u5927\u5c0f\u6210\u4e00\u4e2a\u6bd4\u4f8b\u5173\u7cfb\uff0c\u4e0d\u59a8\u8bbe\u4e3a `y`\uff0c\u5219\u8d85\u51fa\u7684\u5927\u5c0f\u4e3a `ys`\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u53ea\u8981\u5728\u5411\u4e0b\u79fb\u52a8 `ys` \u5c31\u53ef\u4ee5\u4e86 `(h + s) / 2 + ys = (h + (1 + 2y)s) / 2`\u3002\\n\\n\u5bf9\u4e8e\u4e0d\u540c\u7684\u5b57\u4f53\uff0c`y` \u4e0d\u4e00\u6837\uff0c\u8303\u56f4\u5728 `5%~10%` \u4e4b\u95f4\uff0c\u8fd9\u91cc\u6211\u53d6\u4e86 `7.5%`\uff0c\u6240\u4ee5\u503c\u5c31\u662f `(h + 1.15s) / 2`\u3002\\n\\n\u6240\u4ee5\u5bf9\u4e8e\u4e0d\u540c\u7684\u5b57\u4f53\u5b9e\u73b0\u7684\u662f\u4e00\u4e2a\u4f2a\u5c45\u4e2d\uff0c\u6700\u5927\u7684\u8bef\u5dee\u5728 `2.5%`\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e\u5b57\u4f53\u5927\u5c0f\u5728 `40px` \u4ee5\u5185\u7684\u6587\u672c\uff0c\u8bef\u5dee\u5c0f\u4e8e `1px`\uff08\u5bf9\u4e8e\u79fb\u52a8\u7aef\u7684\u6587\u672c\u6765\u8bf4\uff0c\u6587\u5b57\u5927\u5c0f\u4e00\u822c\u5c11\u6709\u8d85\u8fc7 `15px` \u7684\uff09\u3002\u5b9e\u73b0\u4e86\u89c6\u89c9\u4e0a\u7684\u201c\u5c45\u4e2d\u201d\uff0c\u6700\u91cd\u8981\u7684\u662f\uff0c\u5728\u5404\u4e2a\u673a\u578b\u4e0a\u5747\u80fd\u4fdd\u6301\u4e00\u81f4\u6027\u3002"},{"id":"IntersectionObserver","metadata":{"permalink":"/blog/IntersectionObserver","editUrl":"https://github.com/LastKnightCoder/lastknightcoder/tree/master/blog/2022-09-28-IntersectionObserver.mdx","source":"@site/blog/2022-09-28-IntersectionObserver.mdx","title":"IntersectionObserver","description":"\u5982\u679c\u6211\u4eec\u9700\u8981\u76d1\u542c\u67d0\u4e2a\u5143\u7d20\u662f\u5426\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\uff0c\u4e00\u822c\u505a\u6cd5\u662f\u76d1\u542c scroll \u4e8b\u4ef6\uff0c\u7136\u540e\u67e5\u8be2\u5143\u7d20\u79bb\u89c6\u53e3\u9876\u90e8\u7684\u8ddd\u79bb\uff0c\u4f46\u662f\u76d1\u542c scroll \u4e8b\u4ef6\u5b58\u5728\u6027\u80fd\u95ee\u9898\u3002","date":"2022-09-28T00:00:00.000Z","formattedDate":"2022\u5e749\u670828\u65e5","tags":[{"label":"IntersectionObserver","permalink":"/blog/tags/intersection-observer"},{"label":"\u5ef6\u8fdf\u52a0\u8f7d","permalink":"/blog/tags/\u5ef6\u8fdf\u52a0\u8f7d"},{"label":"\u65e0\u9650\u6eda\u52a8","permalink":"/blog/tags/\u65e0\u9650\u6eda\u52a8"},{"label":"\u6027\u80fd\u4f18\u5316","permalink":"/blog/tags/\u6027\u80fd\u4f18\u5316"}],"readingTime":9.145,"hasTruncateMarker":false,"authors":[{"name":"\u718a\u6ed4","title":"\u524d\u7aef\u5de5\u7a0b\u5e08 @ \u963f\u91cc\u5df4\u5df4","url":"https://github.com/LastKnightCoder","imageURL":"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/wallhaven-8opwwy.3cbn7rc981c0.webp","key":"xiongtao"}],"frontMatter":{"slug":"IntersectionObserver","tags":["IntersectionObserver","\u5ef6\u8fdf\u52a0\u8f7d","\u65e0\u9650\u6eda\u52a8","\u6027\u80fd\u4f18\u5316"],"authors":"xiongtao","date":"2022-09-28T00:00:00.000Z"},"prevItem":{"title":"\u79fb\u52a8\u7aef\u6587\u5b57\u5782\u76f4\u5c45\u4e2d\u65b9\u6848","permalink":"/blog/mobile-text-middle"},"nextItem":{"title":"Selection\u4e0eRange","permalink":"/blog/selection-and-range"}},"content":"import Tabs from \'@theme/Tabs\';\\nimport TabItem from \'@theme/TabItem\';\\n\\n\u5982\u679c\u6211\u4eec\u9700\u8981\u76d1\u542c\u67d0\u4e2a\u5143\u7d20\u662f\u5426\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\uff0c\u4e00\u822c\u505a\u6cd5\u662f\u76d1\u542c `scroll` \u4e8b\u4ef6\uff0c\u7136\u540e\u67e5\u8be2\u5143\u7d20\u79bb\u89c6\u53e3\u9876\u90e8\u7684\u8ddd\u79bb\uff0c\u4f46\u662f\u76d1\u542c `scroll` \u4e8b\u4ef6\u5b58\u5728\u6027\u80fd\u95ee\u9898\u3002\\n\\n\u6d4f\u89c8\u5668\u539f\u751f\u63d0\u4f9b\u4e86 `IntersectionObserver` \u76d1\u542c\u5668\uff0c\u53ef\u4ee5\u76d1\u542c\u67d0\u4e2a\u5143\u7d20\u662f\u5426\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u3002\\n\\n## \u4f7f\u7528\u65b9\u6cd5\\n\\n1. \u9996\u5148\u901a\u8fc7 `new IntersectionObserver(callback, options)` \u521b\u5efa\u4e00\u4e2a\u76d1\u89c6\u5668\uff0c\u5176\u4e2d callback \u662f\u5f53\u76d1\u542c\u7684\u5143\u7d20\u51fa\u73b0\u5728\u89c6\u53e3\u65f6\u6267\u884c\u7684\u56de\u8c03\u51fd\u6570\uff0coptions \u662f\u4e00\u4e9b\u9009\u9879\uff0c\u7a0d\u540e\u4ecb\u7ecd\u3002\\n2. \u7136\u540e\u901a\u8fc7\u76d1\u89c6\u5668\u7684 `observe` \u65b9\u6cd5\u76d1\u542c\u611f\u5174\u8da3\u7684\u5143\u7d20\u3002\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\' default>\\n\\n```html\\n<div id=\\"box\\"></div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\'>\\n\\n```css\\n#box {\\n  width: 100%;\\n  height: 500px;\\n  background: deeppink;\\n  position: relative;\\n  top: calc(100vh + 100px);\\n}\\n```  \\n\\n</TabItem>\\n\\n<TabItem value=\'js\' label=\'JavaScript\'>\\n\\n```js\\nconst observer = new IntersectionObserver(entries => {\\n    console.log(\'entries: \', entries);\\n});\\n\\nobserver.observe(document.getElementById(\'box\'));\\n```  \\n\\n</TabItem>\\n</Tabs>\\n\\n\\n\\n<video controls src=\\"https://video-obsidian.oss-cn-beijing.aliyuncs.com/IntersectionObserver-base.mp4\\"></video>\\n\\n## options\\n\\n### threshold\\n\\n\u901a\u8fc7 `threshold` \u53ef\u4ee5\u6307\u5b9a\u5143\u7d20\u4e0e\u89c6\u53e3\u76f8\u4ea4\u7684\u6bd4\u4f8b\u6765\u89e6\u53d1\u56de\u8c03\u51fd\u6570\uff0c\u5b83\u7684\u503c\u662f\u4e00\u4e2a\u6570\u5b57\u6216\u4e00\u4e2a\u6570\u7ec4\uff0c\u9ed8\u8ba4\u662f `0`\uff0c\u5373\u5143\u7d20\u4e00\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u5c31\u6267\u884c\\n\\n```js\\nconst observer = new IntersectionObserver(entries => {  \\n  console.log(entries);  \\n}, {  \\n  threshold: [0.5, 1]  \\n});\\n```\\n\\n\u4e0a\u8ff0\u4ee3\u7801\u8868\u793a\u5f53\u5143\u7d20\u4e00\u534a\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u6216\u8005\u5143\u7d20\u5168\u90e8\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u65f6\uff0c\u5747\u4f1a\u6267\u884c\u56de\u8c03\u51fd\u6570\u3002\\n\\n<video controls src=\\"https://video-obsidian.oss-cn-beijing.aliyuncs.com/IntersectionObserver-threshold.mp4\\"></video>\\n\\n### root\\n\\n\u6211\u4eec\u4e0d\u6b62\u53ef\u4ee5\u76d1\u542c\u5143\u7d20\u5728\u89c6\u53e3\u4e2d\u51fa\u73b0\u4e0e\u6d88\u5931\uff0c\u5728\u4efb\u610f\u53ef\u6eda\u52a8\u7684\u5143\u7d20\u4e2d\u5747\u53ef\u4ee5\u76d1\u542c\uff0c\u6211\u4eec\u901a\u8fc7 `root` \u6765\u6307\u5b9a\u6eda\u52a8\u7684\u5bb9\u5668\uff0c`root` \u7684\u9ed8\u8ba4\u503c\u4e3a `null`\uff0c\u5f53\u503c\u4e3a `null`\uff0c\u4f7f\u7528 `document` \u4f5c\u4e3a\u6eda\u52a8\u5bb9\u5668\u3002\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\' default>\\n\\n```html\\n<div id=\\"box-container\\">\\n  <div id=\\"box\\"></div>\\n  <div id=\\"box-after\\"></div>\\n</div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\'>\\n\\n```css\\nbody {\\n    margin: 0;\\n    padding: 0;\\n}\\n\\n#box-container {\\n    height: 300px;\\n    overflow: auto;\\n    width: 300px;\\n    margin: 100px auto;\\n}\\n\\n#box {\\n    width: 100%;\\n    height: 300px;\\n    background: deepskyblue;\\n    position: relative;\\n    top: 300px;\\n}\\n\\n#box-after {\\n    position: relative;\\n    height: 300px;\\n    top: 300px;\\n}\\n```  \\n\\n</TabItem>\\n\\n<TabItem value=\'js\' label=\'JavaScript\'>\\n\\n```js\\nconst observer = new IntersectionObserver(entries => {\\n  console.log(\'entries: \', entries);\\n}, {\\n  threshold: [0.5, 1],\\n  root: document.getElementById(\'box-container\'),\\n});\\n\\nobserver.observe(document.getElementById(\'box\'));\\n```  \\n\\n</TabItem>\\n</Tabs>\\n\\n<video controls src=\\"https://video-obsidian.oss-cn-beijing.aliyuncs.com/IntersectionObserver-root.mp4\\"></video>\\n\\n### rootMargin\\n\\n`rootMargin `\u53ef\u4ee5\u589e\u5927\u6216\u7f29\u5c0f\u89c6\u53e3\u7684\u533a\u57df\uff0c\u4e0e `margin` \u5c5e\u6027\u7684\u53d6\u503c\u76f8\u4f3c\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u7684 `rootMargin` \u8fd8\u53ef\u4ee5\u4e3a\u8d1f\u503c\u3002\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\' default>\\n\\n```html\\n<div id=\\"box\\"></div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\'>\\n\\n```css\\n#box {\\n  width: 100%;\\n  height: 500px;\\n  background: deeppink;\\n  position: relative;\\n  top: calc(100vh + 100px);\\n}\\n```  \\n\\n</TabItem>\\n\\n<TabItem value=\'js\' label=\'JavaScript\'>\\n\\n```js\\nconst observer = new IntersectionObserver(entries => {\\n  console.log(entries);\\n}, {\\n  threshold: [0.5, 1],\\n  rootMargin: \'-100px 0px -100px 0px\'\\n});\\n```  \\n\\n</TabItem>\\n</Tabs>\\n\\n\u4e0a\u9762\u8bbe\u7f6e\u4e86 `rootMargin` \u4e3a `-100px 0px 0px -100px`\uff0c\u4f7f\u5f97\u89c6\u53e3\u4e0e\u5143\u7d20\u4ea4\u53c9\u533a\u57df\u7684\u8ba1\u7b97\u4e0d\u518d\u662f\u84dd\u8272\uff0c\u800c\u53d8\u4e3a\u4e86\u9ec4\u8272\\n\\n<img src=\\"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/BoundingRect-\u7b2c-2-\u9875.6z20zf4eop40.png\\" style={{zoom: \'50%\'}} />\\n\\n\u5982\u679c\u5143\u7d20\u4e0b\u9762\u6ca1\u6709\u5176\u4ed6\u7a7a\u95f4\uff0c\u90a3\u4e48\u5143\u7d20\u4e0d\u53ef\u80fd\u5b8c\u5168\u4f4d\u4e8e\u9ec4\u8272\u533a\u57df\u4e2d\uff0c`threshold `\u8bbe\u7f6e\u4e3a `1` \u6ca1\u6709\u610f\u4e49\u3002\\n\\n<video controls src=\\"https://video-obsidian.oss-cn-beijing.aliyuncs.com/IntersectionObserver-rootMargin.mp4\\"></video>\\n\\n\u867d\u7136\u6211\u4eec\u8bbe\u7f6e\u4e86 `threshold: [0.5, 1]` \uff0c\u4f46\u662f\u4ece\u89c6\u9891\u53ef\u4ee5\u770b\u5230\u51fa\u73b0\u548c\u6d88\u5931\u5206\u522b\u53ea\u6253\u5370\u4e86\u4e00\u6b21\u3002\\n\\n## entries\\n\\n\u4f20\u5165\u8be5\u56de\u8c03\u51fd\u6570\u7684\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u56e0\u4e3a\u53ef\u4ee5\u540c\u65f6\u76d1\u542c\u591a\u4e2a\u5bf9\u8c61\uff0c\u591a\u4e2a\u5bf9\u8c61\u53ef\u80fd\u540c\u65f6\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\uff0c\u56e0\u6b64\u662f\u4e00\u4e2a\u6570\u7ec4\u3002\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u5bf9\u8c61\uff0c\u5305\u542b\u4ee5\u4e0b\u5b57\u6bb5\uff1a\\n\\n- `intersectionRatio`\uff1a\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u7684\u5143\u7d20\u4e0e\u6574\u4f53\u7684\u6bd4\u4f8b\\n- `boundingClientRect`\uff1a\u5143\u7d20\u7684\u5927\u5c0f\u53ca\u4f4d\u7f6e\u4fe1\u606f\\n- `intersectionRect`\uff1a\u5143\u7d20\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u8fd9\u90e8\u5206\u7684\u5927\u5c0f\u53ca\u4f4d\u7f6e\u4fe1\u606f\\n- `rootBounds`\uff1aroot \u7684\u5927\u5c0f\u53ca\u4f4d\u7f6e\u4fe1\u606f\\n- `target`\uff1a\u88ab\u76d1\u542c\u7684\u5143\u7d20\\n- `time`\uff1a\u89e6\u53d1\u8be5\u4e8b\u4ef6\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2\uff0c\u9875\u9762\u52a0\u8f7d\u65f6\u4e3a 0\\n- `isIntersecting`\uff1a\u662f\u51fa\u73b0\u8fd8\u662f\u6d88\u5931\\n\\n### intersectionRatio\\n\\n`intersectionRatio` \u8868\u793a\u5143\u7d20\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u7684\u90e8\u5206\u4e0e\u5143\u7d20\u6574\u4f53\u7684\u6bd4\u4f8b\\n\\n<img src=\\"https://cdn.jsdelivr.net/gh/LastKnightCoder/image-for-2022@master/BoundingRect-\u7b2c 3 \u9875.png\\" alt=\\"BoundingRect-\u7b2c 3 \u9875\\" style={{zoom: \'50%\'}} />\\n\\n### boundingClientRect\u3001intersectionRect \u4e0e rootBounds\\n\\n`boundingClientRect`\u3001`intersectionRect` \u4e0e `rootBounds` \u7684\u503c\u90fd\u662f `DOMRect` \u5bf9\u8c61\uff0c\u63d0\u4f9b\u4e86\u5143\u7d20\u7684\u5927\u5c0f\u4ee5\u53ca\u76f8\u5bf9\u4e8e\u89c6\u53e3\u7684\u4f4d\u7f6e\u5173\u7cfb\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 `Element.getBoundingClientRect()` \u65b9\u6cd5\uff0c\u5404\u5b57\u6bb5\u542b\u4e49\u5982\u4e0b\u6240\u793a\u3002\\n\\n<img src=\\"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/BoundingRect-\u7b2c-1-\u9875.61y0smwvqk00.png\\" style={{ zoom: \'50%\'}} />\\n\\n`boundingClientRect` \u8868\u793a\u7684\u662f\u88ab\u76d1\u542c\u7684\u5143\u7d20\u7684\u5927\u5c0f\u4e0e `root` \u7684\u4f4d\u7f6e\u5173\u7cfb\uff0c`intersectionRect` \u8868\u793a\u5143\u7d20\u4e0e\u89c6\u53e3\u4ea4\u53c9\u533a\u57df\u90e8\u5206\u7684\u5927\u5c0f\u4e0e `root` \u7684\u4f4d\u7f6e\u5173\u7cfb\uff0c`rootBounds` \u8868\u793a\u7684\u662f `root` \u7684\u5927\u5c0f\u4e0e\u89c6\u53e3\u7684\u4f4d\u7f6e\u5173\u7cfb\u3002\\n\\n`rootBounds` \u7684\u5927\u5c0f\u53ca\u4f4d\u7f6e\u5747\u4f1a\u6536\u5230 `rootMargin` \u7684\u5f71\u54cd\u3002\\n\\n### target\\n\\n`target` \u8868\u793a\u7684\u5c31\u662f\u88ab\u76d1\u542c\u7684\u5143\u7d20\u3002\\n\\n### isIntersecting\\n\\n```js\\nconst observer = new IntersectionObserver(entries => {  \\n  for (const entry of entries) {  \\n    console.log(entry.isIntersecting);  \\n  }  \\n}, {  \\n  threshold: [0.5],  \\n});  \\n  \\nobserver.observe(document.getElementById(\'box\'));\\n```\\n\\n\u5f53\u88ab\u76d1\u542c\u7684\u5143\u7d20\u8fdb\u5165\u6216\u6d88\u5931\u4e8e\u89c6\u53e3\u4e2d\u65f6\uff0c\u5747\u4f1a\u89e6\u53d1\u56de\u8c03\u51fd\u6570\u7684\u6267\u884c\uff0c`isIntersecting` \u7684\u503c\u53ef\u4ee5\u8868\u793a\u662f\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u8fd8\u662f\u6d88\u5931\u5728\u89c6\u53e3\u4e2d\uff0c\u5f53\u503c\u4e3a `true` \u65f6\uff0c\u8868\u793a\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\uff0c\u4e3a `false` \u8868\u793a\u6d88\u5931\u5728\u89c6\u53e3\u4e2d\u3002\\n\\n<video controls src=\\"https://video-obsidian.oss-cn-beijing.aliyuncs.com/IntersectionObserver-isIntersecting.mp4\\"></video>\\n\\n### time\\n\\n\u53ef\u89c1\u6027\u53d1\u751f\u53d8\u5316\u7684\u65f6\u95f4\uff0c\u662f\u4e00\u4e2a\u9ad8\u7cbe\u5ea6\u65f6\u95f4\u6233\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2\u3002\\n\\n## \u6848\u4f8b\\n\\n### \u56fe\u7247\u61d2\u52a0\u8f7d\\n\\n\u5982\u679c\u4e00\u4e2a\u9875\u9762\u4e2d\u56fe\u7247\u7684\u6570\u91cf\u592a\u591a\uff0c\u4f1a\u5f71\u54cd\u9875\u9762\u7684\u52a0\u8f7d\u901f\u5ea6\uff0c\u5bf9\u7f51\u7ad9\u6027\u80fd\u9020\u6210\u5f71\u54cd\uff0c\u6211\u4eec\u53ef\u4ee5\u5f53\u56fe\u7247\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u65f6\u624d\u5bf9\u56fe\u7247\u8fdb\u884c\u52a0\u8f7d\uff0c\u4f20\u7edf\u7684\u65b9\u6cd5\u9700\u8981\u76d1\u542c `scroll` \u4e8b\u4ef6\uff0c\u7136\u540e\u5224\u65ad\u56fe\u7247\u662f\u5426\u5728\u89c6\u53e3\u4e2d\u3002\u4f46\u662f `scroll` \u89e6\u53d1\u7684\u5341\u5206\u9891\u7e41\uff0c\u5177\u6709\u6027\u80fd\u95ee\u9898\u3002\u73b0\u5728\u53ef\u4ee5\u901a\u8fc7 `IntersectionObserver` \u6765\u5b9e\u73b0\uff0c\u5e76\u4e14\u6709\u8f83\u597d\u7684\u6027\u80fd\u3002\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\' default>\\n\\n```html\\n<div id=\\"before\\"></div>\\n<div id=\\"image-list\\">\\n  <img class=\\"lazy-image\\" data-src=\\"images/01.jpg\\" />\\n  <img class=\\"lazy-image\\" data-src=\\"images/02.jpg\\" />\\n  <img class=\\"lazy-image\\" data-src=\\"images/03.jpg\\" />\\n  <img class=\\"lazy-image\\" data-src=\\"images/04.jpg\\" />\\n</div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\'>\\n\\n```css\\n#before {\\n  height: calc(100vh + 10px);\\n}\\n\\n#image-list {\\n  display: flex;\\n  justify-content: space-between;\\n  margin: 100px 50px;\\n}\\n\\n#image-list .lazy-image {\\n  width: 200px;\\n  height: 200px;\\n  object-fit: cover;\\n}\\n```  \\n\\n</TabItem>\\n\\n<TabItem value=\'js\' label=\'JavaScript\'>\\n\\n```js\\nconst observer = new IntersectionObserver(entries => {\\n  entries.forEach(entry => {\\n    // \u5f53\u5411\u4e0b\u6ed1\u52a8\u7684\u65f6\u5019\\n    if (entry.isIntersecting) {\\n      const img = entry.target;\\n      const src = img.dataset.src;\\n      img.src = src;\\n      // \u53d6\u6d88\u76d1\u542c\\n      observer.unobserve(img);\\n    }\\n  });\\n});\\n\\nconst lazyImages = document.getElementsByClassName(\'lazy-image\');\\nfor (let lazyImage of lazyImages) {\\n  observer.observe(lazyImage);\\n}\\n```  \\n\\n</TabItem>\\n</Tabs>\\n\\n\u6211\u4eec\u5c06\u56fe\u7247\u7684\u94fe\u63a5\u8bbe\u7f6e\u5728\u81ea\u5b9a\u4e49\u5c5e\u6027 `data-src` \u4e0a\uff0c\u800c\u4e0d\u662f `src` \u5c5e\u6027\uff0c\u7136\u540e\u6211\u4eec\u76d1\u542c\u8fd9\u4e9b\u56fe\u50cf\uff0c\u5f53\u56fe\u50cf\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\u65f6\uff0c\u6211\u4eec\u83b7\u53d6\u56fe\u50cf\u7684 `data-src` \u5c5e\u6027\uff0c\u5e76\u8bbe\u7f6e\u5230 `src` \u5c5e\u6027\u4e0a\uff0c\u5e76\u4e14\u53d6\u6d88\u76d1\u542c\u5bf9\u8c61\u3002\\n\\n<video controls src=\\"https://video-obsidian.oss-cn-beijing.aliyuncs.com/IntersectionObserver-%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD.mp4\\"></video>\\n\\n### \u65e0\u9650\u6eda\u52a8\\n\\n\u5047\u8bbe\u6709\u4e00\u4e2a\u5546\u54c1\u5c55\u793a\u9875\uff0c\u56e0\u4e3a\u5546\u54c1\u592a\u591a\uff0c\u6211\u4eec\u4e0d\u4f1a\u4e00\u6b21\u6027\u5168\u90e8\u8bf7\u6c42\uff0c\u800c\u662f\u5f53\u7528\u6237\u5411\u4e0b\u6d4f\u89c8\u67e5\u770b\u5546\u54c1\u65f6\uff0c\u5f53\u5230\u8fbe\u9875\u9762\u5e95\u90e8\u65f6\uff0c\u8bf7\u6c42\u66f4\u591a\u7684\u5546\u54c1\u8fdb\u884c\u5c55\u793a\u3002\u4e00\u822c\u7684\u505a\u6cd5\u662f\u76d1\u542c `scroll` \u4e8b\u4ef6\uff0c\u67e5\u8be2\u6eda\u52a8\u6761\u79bb\u5e95\u90e8\u7684\u8ddd\u79bb\uff0c\u5f53\u5c0f\u4e8e\u4e00\u5b9a\u9608\u503c\u65f6\uff0c\u81ea\u52a8\u7684\u8bf7\u6c42\u6570\u636e\u52a0\u8f7d\u3002\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `IntersectionObserver` \u83b7\u5f97\u66f4\u597d\u7684\u6027\u80fd\u3002\\n\\n\u6211\u4eec\u5728\u5546\u54c1\u7684\u4e0b\u9762\u653e\u7f6e\u4e00\u4e2a\u5143\u7d20\uff0c\u5f53\u6ed1\u5230\u5e95\u90e8\u65f6\uff0c\u8be5\u5143\u7d20\u51fa\u73b0\u5728\u89c6\u53e3\u4e2d\uff0c\u6b64\u65f6\u52a0\u8f7d\u66f4\u591a\u7684\u5546\u54c1\u3002\\n\\n<Tabs>\\n<TabItem value=\'html\' label=\'HTML\' default>\\n\\n```html\\n<div id=\\"goods\\">\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n  <div class=\\"good\\"></div>\\n</div>\\n<div id=\\"footer\\"></div>\\n```\\n\\n</TabItem>\\n<TabItem value=\'css\' label=\'CSS\'>\\n\\n```css\\n#goods {\\n  width: 320px;\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 20px;\\n  margin: 20px auto;\\n}\\n\\n.good {\\n  height: 150px;\\n  background: deeppink;\\n}\\n\\n#footer {\\n  background: transparent;\\n  height: 10px;\\n}\\n```  \\n\\n</TabItem>\\n\\n<TabItem value=\'js\' label=\'JavaScript\'>\\n\\n```js\\nconst observer = new IntersectionObserver(entries => {\\n  entries.forEach(entry => {\\n    if (entry.isIntersecting) {\\n      loadMore(10);\\n    }\\n  });\\n}, {\\n  // \u6269\u5c55\u89c6\u53e3\u7684\u5e95\u90e8\u533a\u57df\uff0c\u63d0\u524d\u52a0\u8f7d\\n  rootMargin: \'0px 0px 100px 0px\'\\n});\\n\\nconst loadMore = (n) => {\\n  let appendedGoods = \'\';\\n  for (let i = 0; i < n; i++) {\\n    appendedGoods += \'<div class=\\"good\\"></div>\'\\n  }\\n  const goods = document.getElementById(\'goods\');\\n  goods.innerHTML = goods.innerHTML + appendedGoods;\\n}\\n\\nconst footer = document.getElementById(\'footer\');\\nobserver.observe(footer);\\n```  \\n\\n</TabItem>\\n\\n</Tabs>\\n\\n\\n<video controls src=\\"https://video-obsidian.oss-cn-beijing.aliyuncs.com/IntersectionObserver-%E6%97%A0%E9%99%90%E5%8A%A0%E8%BD%BD.mp4\\"></video>\\n\\n:::info Info\\nIntersectionObserver API \u662f\u5f02\u6b65\u7684\uff0c\u4e0d\u968f\u7740\u76ee\u6807\u5143\u7d20\u7684\u6eda\u52a8\u540c\u6b65\u89e6\u53d1\u3002\\n:::"},{"id":"selection-and-range","metadata":{"permalink":"/blog/selection-and-range","editUrl":"https://github.com/LastKnightCoder/lastknightcoder/tree/master/blog/2022-09-23-Selection\u4e0eRange.mdx","source":"@site/blog/2022-09-23-Selection\u4e0eRange.mdx","title":"Selection\u4e0eRange","description":"\u672c\u6587\u53c2\u8003//segmentfault.com/a/1190000041457245","date":"2022-09-23T00:00:00.000Z","formattedDate":"2022\u5e749\u670823\u65e5","tags":[{"label":"\u9009\u533a","permalink":"/blog/tags/\u9009\u533a"},{"label":"Selection","permalink":"/blog/tags/selection"},{"label":"Range","permalink":"/blog/tags/range"}],"readingTime":7.485,"hasTruncateMarker":false,"authors":[{"name":"\u718a\u6ed4","title":"\u524d\u7aef\u5de5\u7a0b\u5e08 @ \u963f\u91cc\u5df4\u5df4","url":"https://github.com/LastKnightCoder","imageURL":"https://cdn.staticaly.com/gh/LastKnightCoder/ImgHosting3@master/wallhaven-8opwwy.3cbn7rc981c0.webp","key":"xiongtao"}],"frontMatter":{"slug":"selection-and-range","authors":"xiongtao","date":"2022-09-23T00:00:00.000Z","tags":["\u9009\u533a","Selection","Range"]},"prevItem":{"title":"IntersectionObserver","permalink":"/blog/IntersectionObserver"},"nextItem":{"title":"CSS\u52a8\u753b\u53d6\u4ee3\u5b9a\u65f6\u5668\u7684\u65b9\u6cd5","permalink":"/blog/css-animation-timer"}},"content":":::info\\n\\n\u672c\u6587\u53c2\u8003: https://segmentfault.com/a/1190000041457245\\n\\n:::\\n\\n\\n## \u5149\u6807\u4e0e\u9009\u533a\\n\\n\u5149\u6807\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u9009\u533a\u3002\\n\\n1. `Selection` \u5bf9\u8c61\u8868\u793a\u7528\u6237\u9009\u62e9\u7684\u6587\u672c\u8303\u56f4\u6216\u63d2\u5165\u7b26\u53f7\u7684\u5f53\u524d\u4f4d\u7f6e\u3002\u5b83\u4ee3\u8868\u9875\u9762\u4e2d\u7684\u6587\u672c\u9009\u533a\uff0c\u53ef\u80fd\u6a2a\u8de8\u591a\u4e2a\u5143\u7d20\u3002\u901a\u5e38\u7531\u7528\u6237\u62d6\u62fd\u9f20\u6807\u7ecf\u8fc7\u6587\u5b57\u800c\u4ea7\u751f\u3002\\n2. `Range`\u5bf9\u8c61\u8868\u793a\u5305\u542b\u8282\u70b9\u548c\u90e8\u5206\u6587\u672c\u8282\u70b9\u7684\u6587\u6863\u7247\u6bb5\u3002\u901a\u8fc7 `selection` \u5bf9\u8c61\u83b7\u5f97\u7684 `range` \u5bf9\u8c61\u624d\u662f\u6211\u4eec\u64cd\u4f5c\u5149\u6807\u7684\u91cd\u70b9\u3002\\n\\n```js\\nconst selection = window.getSelection();\\n```\\n\\n\u901a\u5e38\u60c5\u51b5\u4e0b\u6211\u4eec\u4e0d\u4f1a\u76f4\u63a5\u64cd\u4f5c `selection` \u5bf9\u8c61\uff0c\u800c\u662f\u9700\u8981\u64cd\u4f5c\u7528 `seleciton` \u5bf9\u8c61\u6240\u5bf9\u5e94\u7684\u7528\u6237\u9009\u62e9\u7684 `range` \u3002\\n\\n```js\\nconst range = selection.getRangeAt(0);\\n```\\n\\n**\u53ef\u80fd\u5b58\u5728\u591a\u4e2a\u9009\u533a\uff0c\u76ee\u524d\u53ea\u6709 Firefox \u652f\u6301\u591a\u9009\u533a\u3002**\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u4e0d\u9700\u8981\u8003\u8651\u591a\u9009\u533a\u7684\u60c5\u51b5\u3002\\n\\n\\nRange \u5bf9\u8c61\u4e0a\u6709\u4e00\u4e2a\u5c5e\u6027\uff0c`collapsed`\uff0c\u8868\u793a\u8d77\u70b9\u548c\u7ec8\u70b9\u662f\u5426\u91cd\u53e0\uff0c\u5f53 `collapsed` \u4e3a `true` \u65f6\uff0c\u9009\u4e2d\u533a\u57df\u88ab\u538b\u7f29\u6210\u4e00\u4e2a\u70b9\uff0c\u5bf9\u4e8e\u666e\u901a\u7684\u5143\u7d20\uff0c\u53ef\u80fd\u4ec0\u4e48\u90fd\u770b\u4e0d\u5230\uff0c\u5982\u679c\u662f\u5728\u53ef\u7f16\u8f91\u5143\u7d20\u4e0a\uff0c\u90a3\u8fd9\u4e2a\u88ab\u538b\u7f29\u7684\u70b9\u5c31\u53d8\u6210\u4e86\u53ef\u4ee5\u95ea\u70c1\u7684\u5149\u6807\u3002 \\n\\n## \u53ef\u7f16\u8f91\u5143\u7d20\\n\\n\u9009\u533a\u548c\u5143\u7d20\u662f\u5426\u53ef\u7f16\u8f91\u5e76\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\uff0c\u552f\u4e00\u7684\u533a\u522b\u5c31\u662f\uff0c\u5728\u53ef\u7f16\u8f91\u5143\u7d20\u4e0a\u53ef\u4ee5\u770b\u5230\u5149\u6807\u3002\\n\\n```html\\n<input type=\\"text\\">\\n<textarea></textarea>\\n<div contenteditable=\\"true\\"></div>\\n```\\n\\n```css\\ndiv{\\n    -webkit-user-modify: read-write;\\n}\\n```\\n\\n\u8fd9\u4e24\u79cd\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u7b80\u5355\u6765\u8bf4\uff0c\u8868\u5355\u5143\u7d20\u66f4\u5bb9\u6613\u63a7\u5236\uff0c\u6d4f\u89c8\u5668\u63d0\u4f9b\u4e86\u66f4\u76f4\u89c2\u7684 API \u6765\u64cd\u63a7\u9009\u533a\u3002\\n\\n## input \u4e0e textarea\\n\\n```js\\ninputElement.setSelectionRange(selectionStart, selectionEnd [, selectionDirection]);\\n```\\n\\n\u9009\u62e9\u5168\u90e8 \\n\\n```js\\ntxt.select();\\ntxt.focus();\\n```\\n\\n\u66ff\u6362\u5185\u5bb9\\n\\n```js\\ninputElement.setRangeText(replacement);\\ninputElement.setRangeText(replacement, start, end [, selectMode]);\\n```\\n\\n- replacement\uff1a\u66ff\u6362\u7684\u6587\u672c\\n- start\uff1a\u8d77\u59cb\u4f4d\u7f6e\\n- end\uff1a\u7ec8\u6b62\u4f4d\u7f6e\\n- selectMode\uff1a\u66ff\u6362\u540e\u7684\u9009\u53d6\u72b6\u6001\\n  - preserve\uff1a\u9ed8\u8ba4\u503c\uff0c\u4fdd\u7559\u9009\u533a\\n\\n\u5047\u8bbe\u624b\u52a8\u9009\u4e2d\u7684\u533a\u57df\u662f `[9,10]`\uff0c\u5982\u679c\u5728 `[1,2]` \u7684\u4f4d\u7f6e\u66ff\u6362\u65b0\u5185\u5bb9\uff0c\u90a3\u4e48\u9009\u533a\u4ecd\u7136\u5728\u4e4b\u524d\u4f4d\u7f6e\u3002\u5982\u679c\u5728 `[8,11]` \u7684\u4f4d\u7f6e\u66ff\u6362\u65b0\u5185\u5bb9\uff0c\u7531\u4e8e\u65b0\u5185\u5bb9\u7684\u4f4d\u7f6e\u8986\u76d6\u4e86\u4e4b\u524d\u7684\u9009\u533a\uff0c\u539f\u9009\u533a\u4e5f\u5c31\u4e0d\u5b58\u5728\u4e86\uff0c\u90a3\u4e48\u66ff\u6362\u5b8c\u4e4b\u540e\uff0c\u9009\u533a\u4f1a\u9009\u4e2d\u521a\u521a\u63d2\u5165\u7684\u65b0\u5185\u5bb9\u3002\\n\\n## \u666e\u901a\u5143\u7d20\u7684\u9009\u533a\u64cd\u4f5c\\n\\n\u9700\u8981\u7528\u5230\u524d\u9762\u63d0\u5230\u7684 `Selection` \u548c `Range` \u76f8\u5173\u65b9\u6cd5\u3002\\n\\n### \u4e3b\u52a8\u9009\u62e9\u67d0\u533a\u57df\\n\\n\u9700\u521b\u5efa\u4e00\u4e2a Range \u5bf9\u8c61\uff0c\u8bbe\u7f6e\u8303\u56f4\uff0c\u7136\u540e\u6dfb\u52a0\u5230 `Selection` \u5bf9\u8c61\u4e2d\\n\\n```javascript\\nrange.setStart(startNode, startOffset);\\nrange.setEnd(endNode, endOffset);\\n```\\n\\n\u56e0\u4e3a\u666e\u901a\u5143\u7d20\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u5143\u7d20\uff0c\u6240\u4ee5\u9009\u533a\u521b\u5efa\u6bd4\u8868\u5355\u590d\u6742\u3002\\n\\n```js\\n// \u79fb\u9664\u6240\u6709\u9009\u533a\\nselection.removeAllRanges()\\n// \u6dfb\u52a0\u9009\u533a\\nselection.addRange(range)\\n```\\n\\n> \u5982\u679c\u8d77\u59cb\u8282\u70b9\u7c7b\u578b\u662f Text \uff0c Comment , or CDATASection \u4e4b\u4e00, \u90a3\u4e48 startOffset \u6307\u7684\u662f\u4ece\u8d77\u59cb\u8282\u70b9\u7b97\u8d77\u5b57\u7b26\u7684\u504f\u79fb\u91cf\u3002 \u5bf9\u4e8e\u5176\u4ed6 Node \u7c7b\u578b\u8282\u70b9\uff0c startOffset \u662f\u6307\u4ece\u8d77\u59cb\u7ed3\u70b9\u5f00\u59cb\u7b97\u8d77\u5b50\u8282\u70b9\u7684\u504f\u79fb\u91cf\u3002\\n\\n### \u9009\u62e9\u8282\u70b9\\n\\n```javascript\\n// \u9009\u4e2d\u8282\u70b9\u5185\u5bb9\uff0c\u5e76\u9009\u4e2d\u6807\u7b7e\\nrange.selectNode();\\n// \u53ea\u9009\u4e2d\u8282\u70b9\u5185\u7684Text\u5185\u5bb9\uff0c\u4e0d\u9009\u4e2d\u6807\u7b7e\\nrange.selectNodeContents();\\n```\\n\\n```info\\n\u6709\u70b9\u50cf innerHTML \u4e0e outerHTML \u7684\u5173\u7cfb\u3002\\n```\\n\\n### \u76f4\u63a5\u6839\u636e\u7236\u5143\u7d20\u9009\u62e9\u6587\u672c\\n\\n\u5982\u4f55\u901a\u8fc7\u76f8\u5bf9\u5916\u5c42\u7684\u504f\u79fb\u91cf\u83b7\u53d6\u5230\u6700\u91cc\u5c42\u5143\u7d20\u7684\u4fe1\u606f\u5462\uff1f\u6574\u4f53\u601d\u8def\u5c31\u662f**\u6df1\u5ea6\u4f18\u5148\u904d\u5386**\u6807\u7b7e\uff0c\u53d6\u5f97\u6240\u6709\u7684 TextNode\uff0c\u5e76\u5f97\u5230\u6bcf\u4e2a TextNode \u6240\u5728\u7684\u533a\u95f4\u3002\u7136\u540e\u627e\u5230\u8d77\u59cb\u70b9\u548c\u7ec8\u6b62\u70b9\u6240\u5728\u7684\u533a\u95f4\uff0c\u8fd4\u56de\u8be5\u533a\u95f4\u7684 TextNode \u4ee5\u53ca\u76f8\u5e94\u7684\u504f\u79fb\u91cf\u3002\\n\\n```js\\nconst getNodeAndOffset = (ele, start = 0, end = 0) => {\\n  const txtList = [];\\n  const dfs = (childNodes) => {\\n    [...childNodes].forEach(node => {\\n      if (node.nodeName === \'#text\') {\\n        txtList.push(node);\\n      } else {\\n        dfs(node.childNodes);\\n      }\\n    })\\n  }\\n  dfs(ele.childNodes);\\n  const clips = txtList.reduce((arr, el, index) => {\\n    const endPosition = el.textContent.length + (index > 0 ? arr[index - 1][2] : 0);\\n    const startPosition = endPosition - el.textContent.length;\\n    arr.push([el, startPosition, endPosition]);\\n    return arr;\\n  }, []);\\n  \\n  const startNode = clips.find(item => start >= item[1] && start < item[2]);\\n  // \u5982\u679c end \u8d85\u8fc7\u4e86\u957f\u5ea6\u8981\u4e0d\u8981\u76f4\u63a5\u8bbe\u7f6e\u4e3a\u672b\u5c3e\\n  const endNode = clips.find(item => end >= item[1] && end < item[2]);\\n  // startNode \u548c endNode \u6ca1\u6709\u627e\u5230\u600e\u4e48\u529e\\n  return [startNode[0], start - startNode[1], endNode[0], end - endNode[1]];\\n}\\n```\\n\\n### \u8fd8\u539f\u9009\u533a\\n\\n```html\\n<div id=\\"txt\\" contenteditable=\\"true\\">\\n  \u5929\u4e0d\u751f\u592b\u5b50\uff0c\u4e07\u53e4\u5982\u957f\u591c\uff01\\n</div>\\n<button id=\\"restore\\">\u8fd8\u539f\u9009\u533a</button>\\n```\\n\\n\u65b9\u6848\u4e00\uff0c\u4fdd\u5b58 Range \u5bf9\u8c61\uff0c\u7136\u540e\u6062\u590d\uff0c\u4f46\u662f\u5f53\u5185\u5bb9\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u539f\u5148\u7684\u9009\u533a\u5c31\u5931\u6548\u4e86\\n\\n```js\\nlet lastRange = null;\\ntxt.addEventListener(\'mouseup\', () => {\\n  const selection = document.getSelection();\\n  lastRange = selection.getRangeAt(0);\\n})\\nconst restore = document.getElementById(\'restore\');\\nrestore.addEventListener(\'click\', () => {\\n  const selection = document.getSelection();\\n  selection.removeAllRanges();\\n  selection.addRange(lastRange);\\n});\\n```\\n\\n\u65b9\u6848\u4e8c\uff0c\u83b7\u5f97\u7edd\u5bf9\u504f\u79fb\u91cf\uff0c\u5373\u4f7f\u5185\u5bb9\u53d1\u751f\u6539\u53d8\uff0c\u4e5f\u4e0d\u5f71\u54cd\u3002\u83b7\u5f97\u7edd\u5bf9\u504f\u79fb\u91cf\u7684\u601d\u8def\u8fd8\u662f\u5148\u83b7\u5f97\u6240\u6709\u6587\u672c\u5143\u7d20\u7684\u533a\u95f4\uff0c\u7136\u540e\u627e\u5230\u88ab\u9009\u4e2d\u7684\u8d77\u59cb\u8282\u70b9\u548c\u7ed3\u675f\u8282\u70b9\uff0c\u83b7\u5f97\u5176\u8d77\u59cb\u504f\u79fb\u548c\u7ed3\u675f\u504f\u79fb\uff0c\u5206\u522b\u52a0\u4e0a\u8282\u70b9\u6240\u5728\u533a\u95f4\u7684\u8d77\u59cb\u503c\u5373\u53ef\u3002\\n\\n```js\\nconst getRangeOffset = ele => {\\n  const txtList = [];\\n  const dfs = (childNodes) => {\\n    [...childNodes].forEach(node => {\\n      if (node.nodeName === \'#text\') {\\n        txtList.push(node);\\n      } else {\\n        dfs(node.childNodes);\\n      }\\n    })\\n  }\\n  dfs(ele.childNodes);\\n  const clips = txtList.reduce((arr, el, index) => {\\n    const endPosition = el.textContent.length + (index > 0 ? arr[index - 1][2] : 0);\\n    const startPosition = endPosition - el.textContent.length;\\n    arr.push([el, startPosition, endPosition]);\\n    return arr;\\n  }, []);\\n  const selection = document.getSelection();\\n  const range = selection.getRangeAt(0);\\n  const startNode = clips.find(item => range.startContainer === item[0]);\\n  const endNode = clips.find(item => range.endContainer === item[0]);\\n  return [startNode[1] + range.startOffset, endNode[1] + range.endOffset];\\n}\\n```\\n\\n```js\\nlet lastRange = {};\\ntxt.addEventListener(\'mouseup\', () => {\\n  const [startOffset, endOffset] = getRangeOffset(txt);\\n  lastRange = {\\n    start: startOffset,\\n    end: endOffset\\n  }\\n})\\nconst restore = document.getElementById(\'restore\');\\nrestore.addEventListener(\'click\', () => {\\n  const selection = document.getSelection();\\n  const range = document.createRange();\\n  const [startNode, startPosition, endNode, endPosition] = getNodeAndOffset(txt, lastRange.start, lastRange.end);\\n  range.setStart(startNode, startPosition);\\n  range.setEnd(endNode, endPosition);\\n  selection.removeAllRanges();\\n  selection.addRange(range);\\n});\\n```\\n\\n### \u63d2\u5165\u5185\u5bb9\\n\\n`range.insertNode()` \u65e2\u53ef\u4ee5\u63d2\u5165\u6587\u672c\u5185\u5bb9\uff0c\u4e5f\u53ef\u4ee5\u63d2\u5165\u6807\u7b7e\u3002\u5b83\u4e0d\u4f1a\u66ff\u6362\u5df2\u9009\u62e9\u7684\u5185\u5bb9\uff0c\u800c\u662f\u5728\u8d77\u70b9\u5904\u63d2\u5165\u4e00\u4e2a\u8282\u70b9\u3002\u5982\u679c\u8981\u66ff\u6362\uff0c\u53ef\u4ee5\u5148\u5220\u9664\u5728\u6dfb\u52a0\uff0c\u901a\u8fc7 `range.deleteContents` \u8fdb\u884c\u5220\u9664\u3002\\n\\n```js\\nconst textNode = document.createTextNode(\'\u65b0\u5185\u5bb9\');\\nrange.deleteContents();\\nrange.insertNode(textNode);\\n```\\n\\n```js\\nconst mark = document.createElement(\'mark\');\\nmark.textContent = \'\u65b0\u5185\u5bb9\';\\nrange.insertNode(mark);\\n```\\n\\n### \u7ed9\u9009\u4e2d\u5185\u5bb9\u5305\u88f9\u6807\u7b7e\\n\\n`range.surroundContents` \u7ed9\u9009\u533a\u5305\u88f9\u4e00\u5c42\u6807\u7b7e\\n\\n```js\\nconst mark = document.createElement(\'mark\');\\nrange.surroundContents(mark);\\n```\\n\\n\u4f46\u662f\u5f53\u9009\u533a\u6a2a\u8de8\u591a\u4e2a\u6807\u7b7e\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u9519\u8bef\u3002\u53e6\u4e00\u79cd\u65b9\u6848\uff0c\u901a\u8fc7 `range.extractContents` \u63d0\u53d6\u9009\u533a\u5185\u5bb9\uff0c\u662f\u4e00\u4e2a `DocumentFragment`\uff0c\u7136\u540e\u63d2\u5165\u65b0\u5185\u5bb9\\n\\n```js\\nconst mark = document.createElement(\'mark\');\\nmark.append(range.extractContents());\\nrange.insertNode(mark);\\n```"},{"id":"css-animation-timer","metadata":{"permalink":"/blog/css-animation-timer","editUrl":"https://github.com/LastKnightCoder/lastknightcoder/tree/master/blog/2022-09-15-CSS\u52a8\u753b\u53d6\u4ee3\u5b9a\u65f6\u5668\u7684\u65b9\u6cd5.mdx","source":"@site/blog/2022-09-15-CSS\u52a8\u753b\u53d6\u4ee3\u5b9a\u65f6\u5668\u7684\u65b9\u6cd5.mdx","title":"CSS\u52a8\u753b\u53d6\u4ee3\u5b9a\u65f6\u5668\u7684\u65b9\u6cd5","description":"\u8be5\u7b14\u8bb0\u662f\u6765\u6e90\u4e8e\u516c\u4f17\u53f7\u6587\u7ae0\u8fd8\u5728\u7528\u5b9a\u65f6\u5668\u5417\uff1f\u501f\u52a9 CSS \u6765\u76d1\u542c\u4e8b\u4ef6\u3002","date":"2022-09-15T00:00:00.000Z","formattedDate":"2022\u5e749\u670815\u65e5","tags":[{"label":"CSS","permalink":"/blog/tags/css"},{"label":"\u52a8\u753b","permalink":"/blog/tags/\u52a8\u753b"},{"label":"\u5b9a\u65f6\u5668","permalink":"/blog/tags/\u5b9a\u65f6\u5668"},{"label":"\u795e\u6765\u4e4b\u7b14","permalink":"/blog/tags/\u795e\u6765\u4e4b\u7b14"}],"readingTime":2.3,"hasTruncateMarker":false,"authors":[],"frontMatter":{"slug":"css-animation-timer","athors":"xiongtao","date":"2022-09-15T00:00:00.000Z","tags":["CSS","\u52a8\u753b","\u5b9a\u65f6\u5668","\u795e\u6765\u4e4b\u7b14"]},"prevItem":{"title":"Selection\u4e0eRange","permalink":"/blog/selection-and-range"}},"content":":::info\\n\\n\u8be5\u7b14\u8bb0\u662f\u6765\u6e90\u4e8e\u516c\u4f17\u53f7\u6587\u7ae0[\u8fd8\u5728\u7528\u5b9a\u65f6\u5668\u5417\uff1f\u501f\u52a9 CSS \u6765\u76d1\u542c\u4e8b\u4ef6](https://mp.weixin.qq.com/s/N25KcGneKPgvBa8zBownlw)\u3002\\n\\n:::\\n\\n## hover\u5ef6\u65f6\u89e6\u53d1\\n\\n### \u4e00\u822c\u65b9\u6cd5\\n\\n\u9f20\u6807\u8fdb\u5165\u65f6\u5f00\u59cb\u5b9a\u65f6\u5668\\n\\n```js\\nvar timer = null\\nel.addEventListener(\'mouseover\', () => {\\n  timer && clearTimeout(timer)\\n  timer = setTimeout(() => {\\n    // \u5177\u4f53\u903b\u8f91\\n  }, 1000)\\n})\\n```\\n\\n\u9f20\u6807\u79bb\u5f00\u65f6\u53d6\u6d88\u5b9a\u65f6\u5668\\n\\n```js\\nel.addEventListener(\'mouseout\', () => {\\n  timer && clearTimeout(timer)\\n})\\n```\\n\\n### \u5229\u7528\u52a8\u753b\u7ed3\u675f\u4e8b\u4ef6\\n\\n\u4e3a\u5143\u7d20\u6dfb\u52a0\u5ef6\u65f6\u52a8\u753b\\n\\n```css\\nbutton:hover{\\n  opacity: 0.999; /*\u65e0\u5173\u7d27\u8981\u7684\u6837\u5f0f*/\\n  transition: 0s 1s opacity; /*\u5ef6\u65f6 1s */\\n}\\n```\\n\\n\u76d1\u542c\u52a8\u753b\u7ed3\u675f\u4e8b\u4ef6\\n\\n```js\\nel.addEventListener(\'transitionend\', () => {\\n  // \u5177\u4f53\u903b\u8f91\\n})\\n```\\n\\n\u65e0\u9700\u5b9a\u65f6\u5668\uff0c\u4e5f\u65e0\u9700\u53d6\u6d88\uff0c\u66f4\u65e0\u9700\u8003\u8651 dom \u7ed3\u6784\uff0c\u5b8c\u7f8e\u5b9e\u73b0\u3002\\n\\n## \u957f\u6309\u89e6\u53d1\\n\\n### \u4e00\u822c\u65b9\u6cd5\\n\\n\u501f\u52a9\u5b9a\u65f6\u5668\uff0c\u6309\u4e0b\u65f6\u5f00\u542f\u5b9a\u65f6\u5668\uff0c\u79bb\u5f00\u65f6\u53d6\u6d88\u5b9a\u65f6\u5668\\n\\n```js\\n\\nel.onmousedown = function(){\\n    this.timer && clearTimeout(this.timer);\\n    this.timer = settimeout(function(){\\n        //\u4e1a\u52a1\u4ee3\u7801\\n    },1000)\\n}\\nel.onmouseup = function(){\\n    this.timer && clearTimeout(this.timer);\\n}\\n```\\n\\n### \u5229\u7528\u52a8\u753b\u7ed3\u675f\u4e8b\u4ef6\\n\\n\u4e3a `:active` \u4f2a\u7c7b\u6dfb\u52a0\u5ef6\u65f6\u52a8\u753b\\n\\n```css\\nbutton:hover:active{\\n  opacity: .999; /*\u65e0\u5173\u7d27\u8981\u7684\u6837\u5f0f*/\\n  transition: opacity 1s; /*\u5ef6\u65f6 1s */\\n}\\n```\\n\\n\u7136\u540e\u518d\u76d1\u542c `transitionend` \u4e8b\u4ef6\\n\\n```js\\nel.addEventListener(\'transitionend\', () => {\\n  // \u5177\u4f53\u903b\u8f91\\n})\\n```\\n\\n## \u8f6e\u64ad\u548c\u6682\u505c\\n\\n### \u4e00\u822c\u65b9\u6cd5\\n\\n\u9f20\u6807\u653e\u4e0a\u53bb\u65f6\u6682\u505c\uff0c\u9f20\u6807\u79bb\u5f00\u65f6\u81ea\u52a8\u6eda\u52a8\uff0c\u501f\u52a9\u5b9a\u65f6\u5668 `setInterveal` \u8fdb\u884c\u8f6e\u64ad\uff0c\u9f20\u6807\u653e\u4e0a\u53bb\u65f6\u6e05\u9664\u5b9a\u65f6\u5668\uff0c\u9f20\u6807\u79bb\u5f00\u65f6\u65b0\u5efa\u5b9a\u65f6\u5668\\n\\n```js\\nfunction autoPlay(){\\n  timer && clearInterval(timer)\\n  timer = setInterval(function(){\\n    // \u8f6e\u64ad\u903b\u8f91\\n  }, 1000)\\n}\\nautoPlay()\\nview.onmouseover = function(){\\n    timer && clearInterval(timer)\\n}\\nel.onmouseout = function(){\\n    autoPlay()\\n}\\n```\\n\\n## animationiteration \u4e8b\u4ef6\\n\\n\u8bbe\u7f6e\u52a8\u753b\u4e3a\u65e0\u9650\u6b21\u6570\uff0c\u6bcf\u6b21\u52a8\u753b\u5f00\u59cb\u65f6\u90fd\u4f1a\u89e6\u53d1 animationiteration \u4e8b\u4ef6\uff0c\u9f20\u6807\u653e\u4e0a\u53bb\u65f6\u52a8\u753b\u6682\u505c\\n\\n```css\\n.view {\\n  animation: scroll 1s infinite; /*\u6bcf1s\u52a8\u753b\uff0c\u65e0\u9650\u5faa\u73af*/\\n}\\n.view:hover{\\n  animation-play-state: paused; /*hover\u6682\u505c*/\\n}\\n@keyframes scroll {\\n  to {\\n    transform: translateZ(.1px); /*\u65e0\u5173\u7d27\u8981\u7684\u6837\u5f0f*/\\n  }\\n}\\n```\\n\\n```js\\n\\nview.addEventListener(\\"animationiteration\\", () => {\\n  // \u8f6e\u64ad\u903b\u8f91\\n})\\n```"}]}')}}]);